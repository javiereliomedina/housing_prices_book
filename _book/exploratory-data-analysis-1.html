<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Exploratory Data Analysis | Housing prices Copenhagen</title>
  <meta name="description" content="Housing prices BBR data" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Exploratory Data Analysis | Housing prices Copenhagen" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Housing prices BBR data" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Exploratory Data Analysis | Housing prices Copenhagen" />
  
  <meta name="twitter:description" content="Housing prices BBR data" />
  

<meta name="author" content="Javier Elío, Henning S. Hansen, Carsten Keßler" />


<meta name="date" content="2021-04-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exploratory-data-analysis.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Housing prices in Copenhagen region</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#create-data-and-results-folders"><i class="fa fa-check"></i>Create data and results folders</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#ggplot-themes"><i class="fa fa-check"></i>Ggplot themes</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#download-data-from-kortforsyningen"><i class="fa fa-check"></i>Download data from kortforsyningen</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-session"><i class="fa fa-check"></i>R session</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#part-introduction"><i class="fa fa-check"></i>(PART) Introduction</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#house-characteristics"><i class="fa fa-check"></i><b>0.1</b> House characteristics</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#location-characteristics"><i class="fa fa-check"></i><b>0.2</b> Location characteristics</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#neighbourhood-characteristics"><i class="fa fa-check"></i><b>0.3</b> Neighbourhood characteristics</a></li>
</ul></li>
<li class="part"><span><b>I Load data</b></span></li>
<li class="chapter" data-level="1" data-path="administrative-units.html"><a href="administrative-units.html"><i class="fa fa-check"></i><b>1</b> Administrative units</a></li>
<li class="part"><span><b>II Data analysis</b></span></li>
<li class="chapter" data-level="2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>2</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#residential-units"><i class="fa fa-check"></i><b>2.1</b> Residential units</a></li>
<li class="chapter" data-level="2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#spatial-distribution-of-residential-units"><i class="fa fa-check"></i><b>2.2</b> Spatial distribution of residential units</a></li>
<li class="chapter" data-level="2.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#population-density"><i class="fa fa-check"></i><b>2.3</b> Population density</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#choropleth-by-ancestry"><i class="fa fa-check"></i><b>2.3.1</b> Choropleth by ancestry</a></li>
<li class="chapter" data-level="2.3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#disaggregating-population-data"><i class="fa fa-check"></i><b>2.3.2</b> Disaggregating population data</a></li>
<li class="chapter" data-level="2.3.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#population-density-worldpop"><i class="fa fa-check"></i><b>2.3.3</b> Population density WorldPop</a></li>
<li class="chapter" data-level="2.3.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#land-use-and-residential-units-corine"><i class="fa fa-check"></i><b>2.3.4</b> Land use and residential units (CORINE)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Data analysis</b></span></li>
<li class="chapter" data-level="3" data-path="exploratory-data-analysis-1.html"><a href="exploratory-data-analysis-1.html"><i class="fa fa-check"></i><b>3</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="exploratory-data-analysis-1.html"><a href="exploratory-data-analysis-1.html#residential-units-1"><i class="fa fa-check"></i><b>3.1</b> Residential units</a></li>
<li class="chapter" data-level="3.2" data-path="exploratory-data-analysis-1.html"><a href="exploratory-data-analysis-1.html#spatial-distribution-of-residential-units-1"><i class="fa fa-check"></i><b>3.2</b> Spatial distribution of residential units</a></li>
<li class="chapter" data-level="3.3" data-path="exploratory-data-analysis-1.html"><a href="exploratory-data-analysis-1.html#population-density-1"><i class="fa fa-check"></i><b>3.3</b> Population density</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="exploratory-data-analysis-1.html"><a href="exploratory-data-analysis-1.html#choropleth-by-ancestry-1"><i class="fa fa-check"></i><b>3.3.1</b> Choropleth by ancestry</a></li>
<li class="chapter" data-level="3.3.2" data-path="exploratory-data-analysis-1.html"><a href="exploratory-data-analysis-1.html#disaggregating-population-data-1"><i class="fa fa-check"></i><b>3.3.2</b> Disaggregating population data</a></li>
<li class="chapter" data-level="3.3.3" data-path="exploratory-data-analysis-1.html"><a href="exploratory-data-analysis-1.html#population-density-worldpop-1"><i class="fa fa-check"></i><b>3.3.3</b> Population density WorldPop</a></li>
<li class="chapter" data-level="3.3.4" data-path="exploratory-data-analysis-1.html"><a href="exploratory-data-analysis-1.html#land-use-and-residential-units-corine-1"><i class="fa fa-check"></i><b>3.3.4</b> Land use and residential units (CORINE)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Housing prices Copenhagen</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exploratory-data-analysis-1" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Exploratory Data Analysis</h1>
<div id="residential-units-1" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Residential units</h2>
<p>We focused our study in residential dwellings and thus we selected the following building types from the BBS dataset (i.e. <em>BYG_ANVEND_KODE</em>):</p>
<ul>
<li>120 - Fritliggende enfamiliehus <em>(Detached single-family house)</em>;</li>
<li>121 - Sammenbygget enfamiliehus <em>(Combined single-family house)</em>;</li>
<li>122 - Fritliggende enfamiliehus i tæt-lav bebyggelse (<em>Detached single-family house in dense-low-rise buildings</em>);</li>
<li>130 - (UDFASES) Række-, kæde-, eller dobbelthus (lodret adskillelse mellem enhederne) <em>((PHASE OUT) Row, chain, or semi-detached house (vertical separation between the units))</em>;</li>
<li>131 - Række-, kæde- og klyngehus <em>(Row, chain and cluster housing)</em>;</li>
<li>132 - Dobbelthus <em>(Semi-detached house)</em>;</li>
<li>140 - Etagebolig-bygning, flerfamiliehus eller to-familiehus <em>(Multi-storey residential building, multi-family house or two-family house)</em>;</li>
<li>190 - Anden bygning til helårsbeboelse <em>(Second building for year-round living)</em>.</li>
</ul>
<p>Estimate the number of residential units in the study area.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="exploratory-data-analysis-1.html#cb1-1" aria-hidden="true" tabindex="-1"></a>  res_units <span class="sc">%&gt;%</span></span>
<span id="cb1-2"><a href="exploratory-data-analysis-1.html#cb1-2" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Convert to tibble</span></span>
<span id="cb1-3"><a href="exploratory-data-analysis-1.html#cb1-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="exploratory-data-analysis-1.html#cb1-4" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Summarize by type or residency and year</span></span>
<span id="cb1-5"><a href="exploratory-data-analysis-1.html#cb1-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(type, BBR_year) <span class="sc">%&gt;%</span> </span>
<span id="cb1-6"><a href="exploratory-data-analysis-1.html#cb1-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1-7"><a href="exploratory-data-analysis-1.html#cb1-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="exploratory-data-analysis-1.html#cb1-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Arrange and add row with totals</span></span>
<span id="cb1-9"><a href="exploratory-data-analysis-1.html#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(BBR_year, <span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb1-10"><a href="exploratory-data-analysis-1.html#cb1-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Pivot</span></span>
<span id="cb1-11"><a href="exploratory-data-analysis-1.html#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> BBR_year, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb1-12"><a href="exploratory-data-analysis-1.html#cb1-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">adorn_totals</span>(<span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-13"><a href="exploratory-data-analysis-1.html#cb1-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">kbl</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-14"><a href="exploratory-data-analysis-1.html#cb1-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">kable_paper</span>(<span class="st">&quot;hover&quot;</span>, <span class="at">full_width =</span> F)</span></code></pre></div>
<table class=" lightable-paper lightable-hover" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
type
</th>
<th style="text-align:right;">
2004
</th>
<th style="text-align:right;">
2005
</th>
<th style="text-align:right;">
2006
</th>
<th style="text-align:right;">
2007
</th>
<th style="text-align:right;">
2008
</th>
<th style="text-align:right;">
2009
</th>
<th style="text-align:right;">
2010
</th>
<th style="text-align:right;">
2011
</th>
<th style="text-align:right;">
2012
</th>
<th style="text-align:right;">
2013
</th>
<th style="text-align:right;">
2014
</th>
<th style="text-align:right;">
2015
</th>
<th style="text-align:right;">
2016
</th>
<th style="text-align:right;">
2017
</th>
<th style="text-align:right;">
2018
</th>
<th style="text-align:right;">
2019
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Multi-storey
</td>
<td style="text-align:right;">
330678
</td>
<td style="text-align:right;">
321176
</td>
<td style="text-align:right;">
342039
</td>
<td style="text-align:right;">
331504
</td>
<td style="text-align:right;">
339414
</td>
<td style="text-align:right;">
339026
</td>
<td style="text-align:right;">
346921
</td>
<td style="text-align:right;">
337604
</td>
<td style="text-align:right;">
348503
</td>
<td style="text-align:right;">
366397
</td>
<td style="text-align:right;">
346650
</td>
<td style="text-align:right;">
345710
</td>
<td style="text-align:right;">
345296
</td>
<td style="text-align:right;">
342844
</td>
<td style="text-align:right;">
347799
</td>
<td style="text-align:right;">
353472
</td>
</tr>
<tr>
<td style="text-align:left;">
Single-family house
</td>
<td style="text-align:right;">
15343
</td>
<td style="text-align:right;">
15328
</td>
<td style="text-align:right;">
15403
</td>
<td style="text-align:right;">
15627
</td>
<td style="text-align:right;">
15469
</td>
<td style="text-align:right;">
15480
</td>
<td style="text-align:right;">
15646
</td>
<td style="text-align:right;">
15771
</td>
<td style="text-align:right;">
15989
</td>
<td style="text-align:right;">
16064
</td>
<td style="text-align:right;">
15943
</td>
<td style="text-align:right;">
15842
</td>
<td style="text-align:right;">
15897
</td>
<td style="text-align:right;">
15914
</td>
<td style="text-align:right;">
15978
</td>
<td style="text-align:right;">
16042
</td>
</tr>
<tr>
<td style="text-align:left;">
College
</td>
<td style="text-align:right;">
10002
</td>
<td style="text-align:right;">
9858
</td>
<td style="text-align:right;">
12026
</td>
<td style="text-align:right;">
10607
</td>
<td style="text-align:right;">
11388
</td>
<td style="text-align:right;">
11383
</td>
<td style="text-align:right;">
11306
</td>
<td style="text-align:right;">
11360
</td>
<td style="text-align:right;">
12977
</td>
<td style="text-align:right;">
12038
</td>
<td style="text-align:right;">
11921
</td>
<td style="text-align:right;">
11152
</td>
<td style="text-align:right;">
11175
</td>
<td style="text-align:right;">
11443
</td>
<td style="text-align:right;">
11446
</td>
<td style="text-align:right;">
11918
</td>
</tr>
<tr>
<td style="text-align:left;">
Semi-detached house
</td>
<td style="text-align:right;">
8647
</td>
<td style="text-align:right;">
7907
</td>
<td style="text-align:right;">
8625
</td>
<td style="text-align:right;">
8346
</td>
<td style="text-align:right;">
8782
</td>
<td style="text-align:right;">
8612
</td>
<td style="text-align:right;">
8418
</td>
<td style="text-align:right;">
8959
</td>
<td style="text-align:right;">
8811
</td>
<td style="text-align:right;">
9771
</td>
<td style="text-align:right;">
9433
</td>
<td style="text-align:right;">
9649
</td>
<td style="text-align:right;">
10495
</td>
<td style="text-align:right;">
10531
</td>
<td style="text-align:right;">
10996
</td>
<td style="text-align:right;">
10440
</td>
</tr>
<tr>
<td style="text-align:left;">
Residential institution
</td>
<td style="text-align:right;">
401
</td>
<td style="text-align:right;">
397
</td>
<td style="text-align:right;">
404
</td>
<td style="text-align:right;">
397
</td>
<td style="text-align:right;">
517
</td>
<td style="text-align:right;">
405
</td>
<td style="text-align:right;">
397
</td>
<td style="text-align:right;">
551
</td>
<td style="text-align:right;">
451
</td>
<td style="text-align:right;">
455
</td>
<td style="text-align:right;">
482
</td>
<td style="text-align:right;">
453
</td>
<td style="text-align:right;">
479
</td>
<td style="text-align:right;">
415
</td>
<td style="text-align:right;">
435
</td>
<td style="text-align:right;">
458
</td>
</tr>
<tr>
<td style="text-align:left;">
Second building
</td>
<td style="text-align:right;">
352
</td>
<td style="text-align:right;">
326
</td>
<td style="text-align:right;">
334
</td>
<td style="text-align:right;">
329
</td>
<td style="text-align:right;">
376
</td>
<td style="text-align:right;">
337
</td>
<td style="text-align:right;">
382
</td>
<td style="text-align:right;">
342
</td>
<td style="text-align:right;">
409
</td>
<td style="text-align:right;">
339
</td>
<td style="text-align:right;">
335
</td>
<td style="text-align:right;">
340
</td>
<td style="text-align:right;">
333
</td>
<td style="text-align:right;">
329
</td>
<td style="text-align:right;">
329
</td>
<td style="text-align:right;">
326
</td>
</tr>
<tr>
<td style="text-align:left;">
Farmhouse
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Total
</td>
<td style="text-align:right;">
365424
</td>
<td style="text-align:right;">
354993
</td>
<td style="text-align:right;">
378832
</td>
<td style="text-align:right;">
366811
</td>
<td style="text-align:right;">
375947
</td>
<td style="text-align:right;">
375244
</td>
<td style="text-align:right;">
383071
</td>
<td style="text-align:right;">
374588
</td>
<td style="text-align:right;">
387141
</td>
<td style="text-align:right;">
405065
</td>
<td style="text-align:right;">
384765
</td>
<td style="text-align:right;">
383147
</td>
<td style="text-align:right;">
383676
</td>
<td style="text-align:right;">
381477
</td>
<td style="text-align:right;">
386984
</td>
<td style="text-align:right;">
392657
</td>
</tr>
</tbody>
</table>
<p>Residential units by floor level</p>
<ul>
<li>KL - basement</li>
<li>ST - groundfloor</li>
<li>1 - 1st floor</li>
<li>2 - 2nd floor</li>
<li>3 - 3rd floor</li>
<li>4 - 4th floor</li>
<li>5 or more = etc.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="exploratory-data-analysis-1.html#cb2-1" aria-hidden="true" tabindex="-1"></a>  res_units <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="exploratory-data-analysis-1.html#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="exploratory-data-analysis-1.html#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(floor_level, type) <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="exploratory-data-analysis-1.html#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="exploratory-data-analysis-1.html#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="exploratory-data-analysis-1.html#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># in percentage [%]   </span></span>
<span id="cb2-7"><a href="exploratory-data-analysis-1.html#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">perc =</span> <span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-8"><a href="exploratory-data-analysis-1.html#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reorder type levels for plotting multi-storey first</span></span>
<span id="cb2-9"><a href="exploratory-data-analysis-1.html#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">factor</span>(type)) <span class="sc">%&gt;%</span></span>
<span id="cb2-10"><a href="exploratory-data-analysis-1.html#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2-11"><a href="exploratory-data-analysis-1.html#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> floor_level, <span class="at">x =</span> perc, <span class="at">fill =</span> type), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb2-12"><a href="exploratory-data-analysis-1.html#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Residential units distribution by floor level&quot;</span>,</span>
<span id="cb2-13"><a href="exploratory-data-analysis-1.html#cb2-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb2-14"><a href="exploratory-data-analysis-1.html#cb2-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;Percentage [%]&quot;</span>) <span class="sc">+</span></span>
<span id="cb2-15"><a href="exploratory-data-analysis-1.html#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2-16"><a href="exploratory-data-analysis-1.html#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb2-17"><a href="exploratory-data-analysis-1.html#cb2-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb2-18"><a href="exploratory-data-analysis-1.html#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb2-19"><a href="exploratory-data-analysis-1.html#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb2-20"><a href="exploratory-data-analysis-1.html#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>, <span class="st">&quot;#009E73&quot;</span>, <span class="st">&quot;#F0E442&quot;</span>, <span class="st">&quot;#0072B2&quot;</span>, <span class="st">&quot;#D55E00&quot;</span>, <span class="st">&quot;#CC79A7&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="exploratory-data-analysis-1.html#cb3-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">&quot;results/floor_levels_res_units.png&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="exploratory-data-analysis-1.html#cb4-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;results/floor_levels_res_units.png&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-floor-level"></span>
<img src="results/floor_levels_res_units.png" alt="Residential units by floor levels" width="100%" />
<p class="caption">
Figure 3.1: Residential units by floor levels
</p>
</div>
<p>Dwelling type codes</p>
<ul>
<li><ol style="list-style-type: decimal">
<li>Egentlig beboelse = Actual residence</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>Blandet erhverv og beboelse = Mixed occupations and housing</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>Enkeltværelse = Single room</li>
</ol></li>
<li>E. Andet (bl.a. institutioner og erhverv) = Other (including institutions and professions)</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="exploratory-data-analysis-1.html#cb5-1" aria-hidden="true" tabindex="-1"></a>  res_units <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="exploratory-data-analysis-1.html#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="exploratory-data-analysis-1.html#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(BOLIGTYPE_KODE, type) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="exploratory-data-analysis-1.html#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code># # A tibble: 24 x 3
# # Groups:   BOLIGTYPE_KODE [6]
#   BOLIGTYPE_KODE type                          n
#   &lt;chr&gt;          &lt;fct&gt;                     &lt;int&gt;
# 1 &quot;&quot;             Multi-storey                  7
# 2 &quot;1&quot;            College                   80371
# 3 &quot;1&quot;            Farmhouse                    16
# 4 &quot;1&quot;            Multi-storey            5372380
# 5 &quot;1&quot;            Residential institution      58
# 6 &quot;1&quot;            Second building            3102
# # ... with 18 more rows</code></pre>
<p>Unit area</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="exploratory-data-analysis-1.html#cb7-1" aria-hidden="true" tabindex="-1"></a>  res_units <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="exploratory-data-analysis-1.html#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="exploratory-data-analysis-1.html#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(BEBO_ARL <span class="sc">&lt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code># # A tibble: 161 x 42
#   VEJ_NAVN  HUS_NR Etagebetegn SIDE_DOERNR PostNr KomKode ESREjdNr Landsejerlavkode KomEjerlavKode MatrNr BYG_ANVEND_KODE
#   &lt;chr&gt;     &lt;chr&gt;  &lt;ord&gt;       &lt;chr&gt;        &lt;int&gt;   &lt;int&gt;    &lt;int&gt;            &lt;int&gt;          &lt;int&gt; &lt;chr&gt;            &lt;int&gt;
# 1 Haregade  1      st          &quot;&quot;            1320     101     8983          2000166             16 0                    0
# 2 Ã…lekist~ 221    st          &quot;&quot;            2720     101   686264          2000177             27 2114               320
# 3 Ã˜ster V~ 12     3           &quot;&quot;            1350     101   671909          2000166             16 664                320
# 4 Humlehav~ 64     st          &quot;&quot;            2500     101   243540          2000180             30 2160               140
# 5 SÃ¦byhol~ 23     st          &quot;&quot;            2500     101   553027          2000180             30 1642               120
# 6 SolvÃ¦ng~ 10     st          &quot;&quot;            2100     101   514862          2000173             23 5552               120
# # ... with 155 more rows, and 31 more variables: OPFOERELSE_AAR &lt;int&gt;, OMBYG_AAR &lt;int&gt;, YDERVAEG_KODE &lt;int&gt;,
# #   TAG_KODE &lt;int&gt;, BYG_ARL_SAML &lt;int&gt;, BYG_BOLIG_ARL_SAML &lt;int&gt;, ERHV_ARL_SAML &lt;int&gt;, BYG_BEBYG_ARL &lt;int&gt;,
# #   ETAGER_ANT &lt;int&gt;, ENH_ANVEND_KODE &lt;dbl&gt;, BOLIGTYPE_KODE &lt;chr&gt;, ENH_ARL_SAML &lt;int&gt;, BEBO_ARL &lt;int&gt;,
# #   ENH_ERHV_ARL &lt;int&gt;, VAERELSE_ANT &lt;int&gt;, ENERGI_KODE &lt;int&gt;, VAER_ERHV_ANT &lt;int&gt;, VARMEINSTAL_KODE &lt;int&gt;,
# #   OPVARMNING_KODE &lt;dbl&gt;, VARME_SUPPL_KODE &lt;int&gt;, EJD_VAERDI &lt;int64&gt;, GRUND_VAERDI &lt;int64&gt;, STUEHUS_VAERDI &lt;int&gt;,
# #   KONTANT_KOEBESUM &lt;int64&gt;, OVERDRAGELSES_KODE &lt;int&gt;, SKOEDE_DATO &lt;date&gt;, geometry &lt;POINT [m]&gt;, floor_level &lt;ord&gt;,
# #   type &lt;fct&gt;, int &lt;lgl&gt;, BBR_year &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="exploratory-data-analysis-1.html#cb9-1" aria-hidden="true" tabindex="-1"></a>  res_units <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="exploratory-data-analysis-1.html#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="exploratory-data-analysis-1.html#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(BEBO_ARL <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code># # A tibble: 285 x 42
#   VEJ_NAVN  HUS_NR Etagebetegn SIDE_DOERNR PostNr KomKode ESREjdNr Landsejerlavkode KomEjerlavKode MatrNr BYG_ANVEND_KODE
#   &lt;chr&gt;     &lt;chr&gt;  &lt;ord&gt;       &lt;chr&gt;        &lt;int&gt;   &lt;int&gt;    &lt;int&gt;            &lt;int&gt;          &lt;int&gt; &lt;chr&gt;            &lt;int&gt;
# 1 Olufsvej  6B     1           &quot;th&quot;          2100     101   420132          2000173             23 592                220
# 2 Betty Na~ 53     6           &quot;613&quot;         2000     147   241801            10051              1 49f                160
# 3 Betty Na~ 53     7           &quot;713&quot;         2000     147   241801            10051              1 49f                160
# 4 George M~ 13     st          &quot;&quot;            2450     101    19878          2000174             24 1493b              140
# 5 H.C. And~ 13     3           &quot;tv&quot;          1553     101    24474          2000179             29 254                320
# 6 Falkoner~ 114A   st          &quot;th&quot;          2000     147    31076            10051              1 58a                140
# # ... with 279 more rows, and 31 more variables: OPFOERELSE_AAR &lt;int&gt;, OMBYG_AAR &lt;int&gt;, YDERVAEG_KODE &lt;int&gt;,
# #   TAG_KODE &lt;int&gt;, BYG_ARL_SAML &lt;int&gt;, BYG_BOLIG_ARL_SAML &lt;int&gt;, ERHV_ARL_SAML &lt;int&gt;, BYG_BEBYG_ARL &lt;int&gt;,
# #   ETAGER_ANT &lt;int&gt;, ENH_ANVEND_KODE &lt;dbl&gt;, BOLIGTYPE_KODE &lt;chr&gt;, ENH_ARL_SAML &lt;int&gt;, BEBO_ARL &lt;int&gt;,
# #   ENH_ERHV_ARL &lt;int&gt;, VAERELSE_ANT &lt;int&gt;, ENERGI_KODE &lt;int&gt;, VAER_ERHV_ANT &lt;int&gt;, VARMEINSTAL_KODE &lt;int&gt;,
# #   OPVARMNING_KODE &lt;dbl&gt;, VARME_SUPPL_KODE &lt;int&gt;, EJD_VAERDI &lt;int64&gt;, GRUND_VAERDI &lt;int64&gt;, STUEHUS_VAERDI &lt;int&gt;,
# #   KONTANT_KOEBESUM &lt;int64&gt;, OVERDRAGELSES_KODE &lt;int&gt;, SKOEDE_DATO &lt;date&gt;, geometry &lt;POINT [m]&gt;, floor_level &lt;ord&gt;,
# #   type &lt;fct&gt;, int &lt;lgl&gt;, BBR_year &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="exploratory-data-analysis-1.html#cb11-1" aria-hidden="true" tabindex="-1"></a>  res_units <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="exploratory-data-analysis-1.html#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="exploratory-data-analysis-1.html#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(BEBO_ARL <span class="sc">&gt;</span> <span class="dv">1000</span>) </span></code></pre></div>
<pre><code># # A tibble: 402 x 42
#   VEJ_NAVN  HUS_NR Etagebetegn SIDE_DOERNR PostNr KomKode ESREjdNr Landsejerlavkode KomEjerlavKode MatrNr BYG_ANVEND_KODE
#   &lt;chr&gt;     &lt;chr&gt;  &lt;ord&gt;       &lt;chr&gt;        &lt;int&gt;   &lt;int&gt;    &lt;int&gt;            &lt;int&gt;          &lt;int&gt; &lt;chr&gt;            &lt;int&gt;
# 1 Amalienb~ 7      st          &quot;&quot;            1257     101    23028          2000167             17 148                140
# 2 Amalienb~ 7      st          &quot;&quot;            1257     101    23028          2000167             17 148                140
# 3 Ottiliav~ 3      1           &quot;&quot;            2500     101   173666          2000176             26 2093               320
# 4 Rymarksv~ 1      st          &quot;&quot;            2900     101   474402          2000173             23 5929               420
# 5 Ottiliav~ 1      1           &quot;&quot;            2500     101   173666          2000176             26 2093               320
# 6 HillerÃ¸~ 64     st          &quot;&quot;            2200     101   390594          2000175             25 1348               160
# # ... with 396 more rows, and 31 more variables: OPFOERELSE_AAR &lt;int&gt;, OMBYG_AAR &lt;int&gt;, YDERVAEG_KODE &lt;int&gt;,
# #   TAG_KODE &lt;int&gt;, BYG_ARL_SAML &lt;int&gt;, BYG_BOLIG_ARL_SAML &lt;int&gt;, ERHV_ARL_SAML &lt;int&gt;, BYG_BEBYG_ARL &lt;int&gt;,
# #   ETAGER_ANT &lt;int&gt;, ENH_ANVEND_KODE &lt;dbl&gt;, BOLIGTYPE_KODE &lt;chr&gt;, ENH_ARL_SAML &lt;int&gt;, BEBO_ARL &lt;int&gt;,
# #   ENH_ERHV_ARL &lt;int&gt;, VAERELSE_ANT &lt;int&gt;, ENERGI_KODE &lt;int&gt;, VAER_ERHV_ANT &lt;int&gt;, VARMEINSTAL_KODE &lt;int&gt;,
# #   OPVARMNING_KODE &lt;dbl&gt;, VARME_SUPPL_KODE &lt;int&gt;, EJD_VAERDI &lt;int64&gt;, GRUND_VAERDI &lt;int64&gt;, STUEHUS_VAERDI &lt;int&gt;,
# #   KONTANT_KOEBESUM &lt;int64&gt;, OVERDRAGELSES_KODE &lt;int&gt;, SKOEDE_DATO &lt;date&gt;, geometry &lt;POINT [m]&gt;, floor_level &lt;ord&gt;,
# #   type &lt;fct&gt;, int &lt;lgl&gt;, BBR_year &lt;dbl&gt;</code></pre>
</div>
<div id="spatial-distribution-of-residential-units-1" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Spatial distribution of residential units</h2>
<p>Create a function for ploting 2D kernel density maps:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="exploratory-data-analysis-1.html#cb13-1" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="cf">function</span>(.data) {</span>
<span id="cb13-2"><a href="exploratory-data-analysis-1.html#cb13-2" aria-hidden="true" tabindex="-1"></a>    .data <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="exploratory-data-analysis-1.html#cb13-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">st_coordinates</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="exploratory-data-analysis-1.html#cb13-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="exploratory-data-analysis-1.html#cb13-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb13-6"><a href="exploratory-data-analysis-1.html#cb13-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> cph_parish, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="exploratory-data-analysis-1.html#cb13-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(X, Y), <span class="at">size =</span> <span class="fl">0.02</span>, <span class="at">shape =</span> <span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb13-8"><a href="exploratory-data-analysis-1.html#cb13-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_density_2d</span>(<span class="fu">aes</span>(X, Y, <span class="at">fill =</span> ..level..),</span>
<span id="cb13-9"><a href="exploratory-data-analysis-1.html#cb13-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb13-10"><a href="exploratory-data-analysis-1.html#cb13-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">h =</span> <span class="dv">700</span>,</span>
<span id="cb13-11"><a href="exploratory-data-analysis-1.html#cb13-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">geom =</span> <span class="st">&quot;polygon&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-12"><a href="exploratory-data-analysis-1.html#cb13-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">&quot;Spectral&quot;</span>)  <span class="sc">+</span></span>
<span id="cb13-13"><a href="exploratory-data-analysis-1.html#cb13-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb13-14"><a href="exploratory-data-analysis-1.html#cb13-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-15"><a href="exploratory-data-analysis-1.html#cb13-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> .data<span class="sc">$</span>type,</span>
<span id="cb13-16"><a href="exploratory-data-analysis-1.html#cb13-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb13-17"><a href="exploratory-data-analysis-1.html#cb13-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) </span>
<span id="cb13-18"><a href="exploratory-data-analysis-1.html#cb13-18" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<p>Plot of spatial distribution of residential units by type of use in 2019:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="exploratory-data-analysis-1.html#cb14-1" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> res_units <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="exploratory-data-analysis-1.html#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(BBR_year <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb14-3"><a href="exploratory-data-analysis-1.html#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_split</span>(type) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="exploratory-data-analysis-1.html#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>( <span class="sc">~</span> <span class="fu">f</span>(.))</span>
<span id="cb14-5"><a href="exploratory-data-analysis-1.html#cb14-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-6"><a href="exploratory-data-analysis-1.html#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wrap_plots</span>(p) <span class="sc">+</span></span>
<span id="cb14-7"><a href="exploratory-data-analysis-1.html#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">&quot;br&quot;</span>, <span class="at">text_cex =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-8"><a href="exploratory-data-analysis-1.html#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">&quot;br&quot;</span>,</span>
<span id="cb14-9"><a href="exploratory-data-analysis-1.html#cb14-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">1.00</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb14-10"><a href="exploratory-data-analysis-1.html#cb14-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.65</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb14-11"><a href="exploratory-data-analysis-1.html#cb14-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">which_north =</span> <span class="st">&quot;true&quot;</span>,</span>
<span id="cb14-12"><a href="exploratory-data-analysis-1.html#cb14-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb14-13"><a href="exploratory-data-analysis-1.html#cb14-13" aria-hidden="true" tabindex="-1"></a>                           <span class="at">width =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb14-14"><a href="exploratory-data-analysis-1.html#cb14-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">style =</span> <span class="fu">north_arrow_orienteering</span>(<span class="at">text_col =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb14-15"><a href="exploratory-data-analysis-1.html#cb14-15" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">text_size =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb14-16"><a href="exploratory-data-analysis-1.html#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Residential units in 2019&quot;</span>,</span>
<span id="cb14-17"><a href="exploratory-data-analysis-1.html#cb14-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>,</span>
<span id="cb14-18"><a href="exploratory-data-analysis-1.html#cb14-18" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">colour =</span> <span class="st">&quot;darkblue&quot;</span>,</span>
<span id="cb14-19"><a href="exploratory-data-analysis-1.html#cb14-19" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb14-20"><a href="exploratory-data-analysis-1.html#cb14-20" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>,</span>
<span id="cb14-21"><a href="exploratory-data-analysis-1.html#cb14-21" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">colour =</span> <span class="st">&quot;grey25&quot;</span>)</span>
<span id="cb14-22"><a href="exploratory-data-analysis-1.html#cb14-22" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb14-23"><a href="exploratory-data-analysis-1.html#cb14-23" aria-hidden="true" tabindex="-1"></a>    ) </span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="exploratory-data-analysis-1.html#cb15-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">&quot;results/Kernel_maps_builds_type_2021.png&quot;</span>,</span>
<span id="cb15-2"><a href="exploratory-data-analysis-1.html#cb15-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> <span class="dv">25</span>,</span>
<span id="cb15-3"><a href="exploratory-data-analysis-1.html#cb15-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">20</span>,</span>
<span id="cb15-4"><a href="exploratory-data-analysis-1.html#cb15-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="exploratory-data-analysis-1.html#cb16-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;results/Kernel_maps_builds_type_2021.png&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-sp-res-builds"></span>
<img src="results/Kernel_maps_builds_type_2021.png" alt="2D kernel density map" width="100%" />
<p class="caption">
Figure 3.2: 2D kernel density map
</p>
</div>
</div>
<div id="population-density-1" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Population density</h2>
<p>BBR data represent the situation at the begining of the given year. Therefore, when we link the BBR data with the population data, which also represent the situation at the first day of the year, we use the population of the same year (e.g. BBR data from 2019 and population data from 2019).</p>
<div id="choropleth-by-ancestry-1" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Choropleth by ancestry</h3>
<p>Plot population density at the last day of 2019 (first of 2010) by parish and ancestry.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="exploratory-data-analysis-1.html#cb17-1" aria-hidden="true" tabindex="-1"></a>  col <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&quot;YlGnBu&quot;</span>)</span>
<span id="cb17-2"><a href="exploratory-data-analysis-1.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  pal <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(col)</span>
<span id="cb17-3"><a href="exploratory-data-analysis-1.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  my_pallette <span class="ot">&lt;-</span> <span class="fu">pal</span>(<span class="dv">10</span>)</span>
<span id="cb17-4"><a href="exploratory-data-analysis-1.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-5"><a href="exploratory-data-analysis-1.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  pop_dens_choropleth <span class="ot">&lt;-</span>  prsh_pop_sf <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="exploratory-data-analysis-1.html#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(prsh_id, prsh_name, prsh_area_km2, date, </span>
<span id="cb17-7"><a href="exploratory-data-analysis-1.html#cb17-7" aria-hidden="true" tabindex="-1"></a>           pop_total, pop_dan, pop_frgn_wst, pop_frgn_nwst) <span class="sc">%&gt;%</span> </span>
<span id="cb17-8"><a href="exploratory-data-analysis-1.html#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(date <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-9"><a href="exploratory-data-analysis-1.html#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calulate population density (pop/area)</span></span>
<span id="cb17-10"><a href="exploratory-data-analysis-1.html#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;pop_&quot;</span>), <span class="sc">~</span> . <span class="sc">/</span> (<span class="dv">1000</span> <span class="sc">*</span> prsh_area_km2))) <span class="sc">%&gt;%</span> </span>
<span id="cb17-11"><a href="exploratory-data-analysis-1.html#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">paste</span>(.x, <span class="st">&quot;km2&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>), <span class="fu">starts_with</span>(<span class="st">&quot;pop&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-12"><a href="exploratory-data-analysis-1.html#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-13"><a href="exploratory-data-analysis-1.html#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;pop_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-14"><a href="exploratory-data-analysis-1.html#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-15"><a href="exploratory-data-analysis-1.html#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, </span>
<span id="cb17-16"><a href="exploratory-data-analysis-1.html#cb17-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;pop_total_km2&quot;</span>, </span>
<span id="cb17-17"><a href="exploratory-data-analysis-1.html#cb17-17" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;pop_dan_km2&quot;</span>,</span>
<span id="cb17-18"><a href="exploratory-data-analysis-1.html#cb17-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;pop_frgn_wst_km2&quot;</span>,</span>
<span id="cb17-19"><a href="exploratory-data-analysis-1.html#cb17-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;pop_frgn_nwst_km2&quot;</span>),</span>
<span id="cb17-20"><a href="exploratory-data-analysis-1.html#cb17-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Total&quot;</span>,</span>
<span id="cb17-21"><a href="exploratory-data-analysis-1.html#cb17-21" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Danish origin&quot;</span>,</span>
<span id="cb17-22"><a href="exploratory-data-analysis-1.html#cb17-22" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Immigrants and their descendants from western countries&quot;</span>,</span>
<span id="cb17-23"><a href="exploratory-data-analysis-1.html#cb17-23" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Immigrants and their descendants from non-western countries&quot;</span>)))</span>
<span id="cb17-24"><a href="exploratory-data-analysis-1.html#cb17-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-25"><a href="exploratory-data-analysis-1.html#cb17-25" aria-hidden="true" tabindex="-1"></a>  brks_c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(pop_dens_choropleth<span class="sc">$</span>value),</span>
<span id="cb17-26"><a href="exploratory-data-analysis-1.html#cb17-26" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>,</span>
<span id="cb17-27"><a href="exploratory-data-analysis-1.html#cb17-27" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ceiling</span>(<span class="fu">max</span>(pop_dens_choropleth<span class="sc">$</span>value)))</span>
<span id="cb17-28"><a href="exploratory-data-analysis-1.html#cb17-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-29"><a href="exploratory-data-analysis-1.html#cb17-29" aria-hidden="true" tabindex="-1"></a>  pop_dens_choropleth  <span class="sc">%&gt;%</span> </span>
<span id="cb17-30"><a href="exploratory-data-analysis-1.html#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-31"><a href="exploratory-data-analysis-1.html#cb17-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">cut</span>(value, <span class="at">breaks =</span> brks_c, <span class="at">include.lowest =</span> T)),</span>
<span id="cb17-32"><a href="exploratory-data-analysis-1.html#cb17-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>,</span>
<span id="cb17-33"><a href="exploratory-data-analysis-1.html#cb17-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb17-34"><a href="exploratory-data-analysis-1.html#cb17-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="fu">TeX</span>(<span class="st">&quot;$</span><span class="sc">\\</span><span class="st">overset{</span><span class="sc">\\</span><span class="st">textbf{Population}}{(x1000/km^2)}$&quot;</span>),</span>
<span id="cb17-35"><a href="exploratory-data-analysis-1.html#cb17-35" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> my_pallette,</span>
<span id="cb17-36"><a href="exploratory-data-analysis-1.html#cb17-36" aria-hidden="true" tabindex="-1"></a>                      <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-37"><a href="exploratory-data-analysis-1.html#cb17-37" aria-hidden="true" tabindex="-1"></a>                      <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse=</span><span class="cn">TRUE</span>))  <span class="sc">+</span></span>
<span id="cb17-38"><a href="exploratory-data-analysis-1.html#cb17-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">my_theme_map</span>() <span class="sc">+</span> </span>
<span id="cb17-39"><a href="exploratory-data-analysis-1.html#cb17-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">colour =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb17-40"><a href="exploratory-data-analysis-1.html#cb17-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>)) <span class="sc">+</span></span>
<span id="cb17-41"><a href="exploratory-data-analysis-1.html#cb17-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Population density at the first dat of 2019&quot;</span>,</span>
<span id="cb17-42"><a href="exploratory-data-analysis-1.html#cb17-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb17-43"><a href="exploratory-data-analysis-1.html#cb17-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-44"><a href="exploratory-data-analysis-1.html#cb17-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>( <span class="sc">~</span> name)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="exploratory-data-analysis-1.html#cb18-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">&quot;results/pop_density_2019_choropleth.png&quot;</span>,</span>
<span id="cb18-2"><a href="exploratory-data-analysis-1.html#cb18-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> <span class="dv">25</span>,</span>
<span id="cb18-3"><a href="exploratory-data-analysis-1.html#cb18-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">20</span>,</span>
<span id="cb18-4"><a href="exploratory-data-analysis-1.html#cb18-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="exploratory-data-analysis-1.html#cb19-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;results/pop_density_2019_choropleth.png&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-pop-map-chor"></span>
<img src="results/pop_density_2019_choropleth.png" alt="Population density by parish (choropleth)" width="100%" />
<p class="caption">
Figure 3.3: Population density by parish (choropleth)
</p>
</div>
</div>
<div id="disaggregating-population-data-1" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Disaggregating population data</h3>
<p>We disaggregate the population data at Parish level to grid cells of 100m x 100m using residential buildings as ancillary data. The procedure is as follow:</p>
<ol style="list-style-type: decimal">
<li><p>We calculate the occupancy rate (<em>OR</em>) for the residential units of each parish (<em>j</em>): <span class="math display">\[OR_{j} = \frac{pop_{j}}{N_{j}}\]</span></p></li>
<li><p>We make grid cells of 100m x 100m over the study area</p></li>
<li><p>We select only the grids with residential units</p></li>
<li><p>Detect to what parish (<em>j</em>) belong each grid (<em>i</em>). (Note that one grids may be in more that one parish)</p></li>
<li><p>Calculate the number of dwellings per grid and parish (<span class="math inline">\(N_{ij}\)</span>)</p></li>
<li><p>Estimate the population in each grid (<em>i</em>) base the occupancy rate by parish (<em>j</em>): <span class="math display">\[pop_{gi} = \sum_{j = 1}^{n}(OR_{j} \cdot N_{ij})\]</span></p></li>
<li><p>Population density: <span class="math display">\[PD_{i} = \frac{pop_{i}}{A_{i}}\]</span></p></li>
</ol>
<p>Therefore we create the following function:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="exploratory-data-analysis-1.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate the population density in the grids created by f_grids </span></span>
<span id="cb20-2"><a href="exploratory-data-analysis-1.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param .pop        POLYGONS with the population data (i.e. prsh_pop_sf)</span></span>
<span id="cb20-3"><a href="exploratory-data-analysis-1.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param .parish     POLYGONS where the number of units will be calculated </span></span>
<span id="cb20-4"><a href="exploratory-data-analysis-1.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param .res_points POINTS with the residential units (e.g. res_units) </span></span>
<span id="cb20-5"><a href="exploratory-data-analysis-1.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param .grids      Grid cells generated by f_grids</span></span>
<span id="cb20-6"><a href="exploratory-data-analysis-1.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param .year       Year of the analysis</span></span>
<span id="cb20-7"><a href="exploratory-data-analysis-1.html#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="exploratory-data-analysis-1.html#cb20-8" aria-hidden="true" tabindex="-1"></a>  f_pd_grids <span class="ot">&lt;-</span> <span class="cf">function</span>(.pop, .parish, .res_points, .grids, .year) {</span>
<span id="cb20-9"><a href="exploratory-data-analysis-1.html#cb20-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-10"><a href="exploratory-data-analysis-1.html#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Population at the last day of the year (.year)</span></span>
<span id="cb20-11"><a href="exploratory-data-analysis-1.html#cb20-11" aria-hidden="true" tabindex="-1"></a>    pop_year <span class="ot">&lt;-</span> .pop <span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="exploratory-data-analysis-1.html#cb20-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Select population data at the first day of the quarter </span></span>
<span id="cb20-13"><a href="exploratory-data-analysis-1.html#cb20-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(prsh_id, prsh_name, prsh_area_km2, date, </span>
<span id="cb20-14"><a href="exploratory-data-analysis-1.html#cb20-14" aria-hidden="true" tabindex="-1"></a>             pop_total, pop_dan, pop_frgn_wst, pop_frgn_nwst) <span class="sc">%&gt;%</span> </span>
<span id="cb20-15"><a href="exploratory-data-analysis-1.html#cb20-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># select the data at the end of the year (first dat of the next year) </span></span>
<span id="cb20-16"><a href="exploratory-data-analysis-1.html#cb20-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(date <span class="sc">==</span> (.year))</span>
<span id="cb20-17"><a href="exploratory-data-analysis-1.html#cb20-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-18"><a href="exploratory-data-analysis-1.html#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># BBR of the selected year (represent the last day of the year)</span></span>
<span id="cb20-19"><a href="exploratory-data-analysis-1.html#cb20-19" aria-hidden="true" tabindex="-1"></a>    BBR_year <span class="ot">&lt;-</span> <span class="fu">filter</span>(.res_points, BBR_year <span class="sc">==</span> .year) </span>
<span id="cb20-20"><a href="exploratory-data-analysis-1.html#cb20-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-21"><a href="exploratory-data-analysis-1.html#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate occupancy rate (&quot;OR&quot;) of the residential units in each parish in a year</span></span>
<span id="cb20-22"><a href="exploratory-data-analysis-1.html#cb20-22" aria-hidden="true" tabindex="-1"></a>    OR <span class="ot">&lt;-</span> pop_year <span class="sc">%&gt;%</span>  </span>
<span id="cb20-23"><a href="exploratory-data-analysis-1.html#cb20-23" aria-hidden="true" tabindex="-1"></a>      <span class="co"># number of units per parish</span></span>
<span id="cb20-24"><a href="exploratory-data-analysis-1.html#cb20-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">n_units =</span> <span class="fu">st_intersects</span>(., BBR_year, <span class="at">dist =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-25"><a href="exploratory-data-analysis-1.html#cb20-25" aria-hidden="true" tabindex="-1"></a>               <span class="fu">map</span>(., <span class="sc">~</span><span class="fu">length</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb20-26"><a href="exploratory-data-analysis-1.html#cb20-26" aria-hidden="true" tabindex="-1"></a>               <span class="fu">unlist</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb20-27"><a href="exploratory-data-analysis-1.html#cb20-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># mean population per unit in each parish</span></span>
<span id="cb20-28"><a href="exploratory-data-analysis-1.html#cb20-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;pop&quot;</span>), <span class="sc">~</span> . <span class="sc">/</span> n_units)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-29"><a href="exploratory-data-analysis-1.html#cb20-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">paste</span>(.x, <span class="st">&quot;or&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>), <span class="fu">starts_with</span>(<span class="st">&quot;pop&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-30"><a href="exploratory-data-analysis-1.html#cb20-30" aria-hidden="true" tabindex="-1"></a>      <span class="co"># output as table </span></span>
<span id="cb20-31"><a href="exploratory-data-analysis-1.html#cb20-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-32"><a href="exploratory-data-analysis-1.html#cb20-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>n_units, <span class="sc">-</span>geometry)</span>
<span id="cb20-33"><a href="exploratory-data-analysis-1.html#cb20-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-34"><a href="exploratory-data-analysis-1.html#cb20-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get only the grids with residential units on them</span></span>
<span id="cb20-35"><a href="exploratory-data-analysis-1.html#cb20-35" aria-hidden="true" tabindex="-1"></a>    gru <span class="ot">&lt;-</span> .grids <span class="sc">%&gt;%</span> </span>
<span id="cb20-36"><a href="exploratory-data-analysis-1.html#cb20-36" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Number of residential units per grid</span></span>
<span id="cb20-37"><a href="exploratory-data-analysis-1.html#cb20-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">n_units =</span> <span class="fu">st_intersects</span>(., BBR_year , <span class="at">dist =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-38"><a href="exploratory-data-analysis-1.html#cb20-38" aria-hidden="true" tabindex="-1"></a>               <span class="fu">map</span>(., <span class="sc">~</span><span class="fu">length</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb20-39"><a href="exploratory-data-analysis-1.html#cb20-39" aria-hidden="true" tabindex="-1"></a>               <span class="fu">unlist</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb20-40"><a href="exploratory-data-analysis-1.html#cb20-40" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Get grids with residential buildings</span></span>
<span id="cb20-41"><a href="exploratory-data-analysis-1.html#cb20-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(n_units <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-42"><a href="exploratory-data-analysis-1.html#cb20-42" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Detect to what parish belong the grid</span></span>
<span id="cb20-43"><a href="exploratory-data-analysis-1.html#cb20-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">st_intersection</span>(., .parish ) <span class="sc">%&gt;%</span> </span>
<span id="cb20-44"><a href="exploratory-data-analysis-1.html#cb20-44" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Remove parish area</span></span>
<span id="cb20-45"><a href="exploratory-data-analysis-1.html#cb20-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>prsh_area_km2, <span class="sc">-</span>SOGNENAVN) <span class="sc">%&gt;%</span> </span>
<span id="cb20-46"><a href="exploratory-data-analysis-1.html#cb20-46" aria-hidden="true" tabindex="-1"></a>      <span class="co"># convert to table</span></span>
<span id="cb20-47"><a href="exploratory-data-analysis-1.html#cb20-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>()</span>
<span id="cb20-48"><a href="exploratory-data-analysis-1.html#cb20-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-49"><a href="exploratory-data-analysis-1.html#cb20-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Population density by grids</span></span>
<span id="cb20-50"><a href="exploratory-data-analysis-1.html#cb20-50" aria-hidden="true" tabindex="-1"></a>    gru <span class="sc">%&gt;%</span> </span>
<span id="cb20-51"><a href="exploratory-data-analysis-1.html#cb20-51" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Merge OR per parish  </span></span>
<span id="cb20-52"><a href="exploratory-data-analysis-1.html#cb20-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(OR, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;SOGNEKODE&quot;</span> <span class="ot">=</span> <span class="st">&quot;prsh_id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-53"><a href="exploratory-data-analysis-1.html#cb20-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">st_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-54"><a href="exploratory-data-analysis-1.html#cb20-54" aria-hidden="true" tabindex="-1"></a>      <span class="co"># recalculate population by grid </span></span>
<span id="cb20-55"><a href="exploratory-data-analysis-1.html#cb20-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;pop&quot;</span>), <span class="sc">~</span> . <span class="sc">*</span> n_units)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-56"><a href="exploratory-data-analysis-1.html#cb20-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">&quot;_or&quot;</span>, <span class="st">&quot;&quot;</span>, .), <span class="at">.col =</span> <span class="fu">starts_with</span>(<span class="st">&quot;pop&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-57"><a href="exploratory-data-analysis-1.html#cb20-57" aria-hidden="true" tabindex="-1"></a>      <span class="co"># sum population of each parish of the grid</span></span>
<span id="cb20-58"><a href="exploratory-data-analysis-1.html#cb20-58" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(grid_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb20-59"><a href="exploratory-data-analysis-1.html#cb20-59" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">pop_total =</span> <span class="fu">sum</span>(pop_total),</span>
<span id="cb20-60"><a href="exploratory-data-analysis-1.html#cb20-60" aria-hidden="true" tabindex="-1"></a>                <span class="at">pop_dan =</span> <span class="fu">sum</span>(pop_dan),</span>
<span id="cb20-61"><a href="exploratory-data-analysis-1.html#cb20-61" aria-hidden="true" tabindex="-1"></a>                <span class="at">pop_frgn_wst =</span> <span class="fu">sum</span>(pop_frgn_wst),</span>
<span id="cb20-62"><a href="exploratory-data-analysis-1.html#cb20-62" aria-hidden="true" tabindex="-1"></a>                <span class="at">pop_frgn_nwst =</span> <span class="fu">sum</span>(pop_frgn_nwst),</span>
<span id="cb20-63"><a href="exploratory-data-analysis-1.html#cb20-63" aria-hidden="true" tabindex="-1"></a>                <span class="at">n_units =</span> <span class="fu">sum</span>(n_units)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-64"><a href="exploratory-data-analysis-1.html#cb20-64" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-65"><a href="exploratory-data-analysis-1.html#cb20-65" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Area of the grid</span></span>
<span id="cb20-66"><a href="exploratory-data-analysis-1.html#cb20-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">area_km2 =</span> <span class="fu">as.numeric</span>(units<span class="sc">::</span><span class="fu">set_units</span>(<span class="fu">st_area</span>(.), km<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb20-67"><a href="exploratory-data-analysis-1.html#cb20-67" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Population density (pop/area)</span></span>
<span id="cb20-68"><a href="exploratory-data-analysis-1.html#cb20-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;pop_&quot;</span>), <span class="sc">~</span> . <span class="sc">/</span> (<span class="dv">1000</span> <span class="sc">*</span> area_km2))) <span class="sc">%&gt;%</span> </span>
<span id="cb20-69"><a href="exploratory-data-analysis-1.html#cb20-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">paste</span>(.x, <span class="st">&quot;km2&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>), <span class="fu">starts_with</span>(<span class="st">&quot;pop&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-70"><a href="exploratory-data-analysis-1.html#cb20-70" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Pivot longer</span></span>
<span id="cb20-71"><a href="exploratory-data-analysis-1.html#cb20-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-72"><a href="exploratory-data-analysis-1.html#cb20-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;pop_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-73"><a href="exploratory-data-analysis-1.html#cb20-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-74"><a href="exploratory-data-analysis-1.html#cb20-74" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Remove polygons with 0 population</span></span>
<span id="cb20-75"><a href="exploratory-data-analysis-1.html#cb20-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb20-76"><a href="exploratory-data-analysis-1.html#cb20-76" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<p>Population in 2019 (at the first dat of the year) by grid cells of 100m x 100m and ancestry.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="exploratory-data-analysis-1.html#cb21-1" aria-hidden="true" tabindex="-1"></a>  pop_2019_g100m <span class="ot">&lt;-</span>  <span class="fu">f_pd_grids</span>(<span class="at">.pop =</span> prsh_pop_sf,</span>
<span id="cb21-2"><a href="exploratory-data-analysis-1.html#cb21-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">.parish =</span> cph_parish,</span>
<span id="cb21-3"><a href="exploratory-data-analysis-1.html#cb21-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">.res_points =</span> res_units,</span>
<span id="cb21-4"><a href="exploratory-data-analysis-1.html#cb21-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">.grids =</span> grids100m,</span>
<span id="cb21-5"><a href="exploratory-data-analysis-1.html#cb21-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">.year =</span> <span class="dv">2019</span>)</span>
<span id="cb21-6"><a href="exploratory-data-analysis-1.html#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="exploratory-data-analysis-1.html#cb21-7" aria-hidden="true" tabindex="-1"></a>  brks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(pop_2019_g100m<span class="sc">$</span>value),</span>
<span id="cb21-8"><a href="exploratory-data-analysis-1.html#cb21-8" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>,</span>
<span id="cb21-9"><a href="exploratory-data-analysis-1.html#cb21-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ceiling</span>(<span class="fu">max</span>(pop_2019_g100m<span class="sc">$</span>value)))</span>
<span id="cb21-10"><a href="exploratory-data-analysis-1.html#cb21-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-11"><a href="exploratory-data-analysis-1.html#cb21-11" aria-hidden="true" tabindex="-1"></a>  pop_2019_g100m <span class="sc">%&gt;%</span></span>
<span id="cb21-12"><a href="exploratory-data-analysis-1.html#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, </span>
<span id="cb21-13"><a href="exploratory-data-analysis-1.html#cb21-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;pop_total_km2&quot;</span>, </span>
<span id="cb21-14"><a href="exploratory-data-analysis-1.html#cb21-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;pop_dan_km2&quot;</span>,</span>
<span id="cb21-15"><a href="exploratory-data-analysis-1.html#cb21-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;pop_frgn_wst_km2&quot;</span>,</span>
<span id="cb21-16"><a href="exploratory-data-analysis-1.html#cb21-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;pop_frgn_nwst_km2&quot;</span>),</span>
<span id="cb21-17"><a href="exploratory-data-analysis-1.html#cb21-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Total&quot;</span>,</span>
<span id="cb21-18"><a href="exploratory-data-analysis-1.html#cb21-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Danish origin&quot;</span>,</span>
<span id="cb21-19"><a href="exploratory-data-analysis-1.html#cb21-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Immigrants and their descendants from western countries&quot;</span>,</span>
<span id="cb21-20"><a href="exploratory-data-analysis-1.html#cb21-20" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Immigrants and their descendants from non-western countries&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb21-21"><a href="exploratory-data-analysis-1.html#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-22"><a href="exploratory-data-analysis-1.html#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> cph_parish, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb21-23"><a href="exploratory-data-analysis-1.html#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">cut</span>(value,</span>
<span id="cb21-24"><a href="exploratory-data-analysis-1.html#cb21-24" aria-hidden="true" tabindex="-1"></a>                           <span class="at">breaks =</span> brks,</span>
<span id="cb21-25"><a href="exploratory-data-analysis-1.html#cb21-25" aria-hidden="true" tabindex="-1"></a>                           <span class="at">include.lowest =</span> T)),</span>
<span id="cb21-26"><a href="exploratory-data-analysis-1.html#cb21-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb21-27"><a href="exploratory-data-analysis-1.html#cb21-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="fu">TeX</span>(<span class="st">&quot;$</span><span class="sc">\\</span><span class="st">overset{</span><span class="sc">\\</span><span class="st">textbf{Population}}{(x1000/km^2)}$&quot;</span>),</span>
<span id="cb21-28"><a href="exploratory-data-analysis-1.html#cb21-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> my_pallette,</span>
<span id="cb21-29"><a href="exploratory-data-analysis-1.html#cb21-29" aria-hidden="true" tabindex="-1"></a>                      <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb21-30"><a href="exploratory-data-analysis-1.html#cb21-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))  <span class="sc">+</span></span>
<span id="cb21-31"><a href="exploratory-data-analysis-1.html#cb21-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">my_theme_map</span>() <span class="sc">+</span> </span>
<span id="cb21-32"><a href="exploratory-data-analysis-1.html#cb21-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">colour =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb21-33"><a href="exploratory-data-analysis-1.html#cb21-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>)) <span class="sc">+</span></span>
<span id="cb21-34"><a href="exploratory-data-analysis-1.html#cb21-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Population density at the first day of 2019&quot;</span>,</span>
<span id="cb21-35"><a href="exploratory-data-analysis-1.html#cb21-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb21-36"><a href="exploratory-data-analysis-1.html#cb21-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb21-37"><a href="exploratory-data-analysis-1.html#cb21-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>( <span class="sc">~</span> name)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="exploratory-data-analysis-1.html#cb22-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">&quot;results/pop_dens_2019_grids_100m.png&quot;</span>,</span>
<span id="cb22-2"><a href="exploratory-data-analysis-1.html#cb22-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> <span class="dv">25</span>,</span>
<span id="cb22-3"><a href="exploratory-data-analysis-1.html#cb22-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">20</span>,</span>
<span id="cb22-4"><a href="exploratory-data-analysis-1.html#cb22-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="exploratory-data-analysis-1.html#cb23-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;results/pop_dens_2019_grids_100m.png&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-pop-map-grid"></span>
<img src="results/pop_dens_2019_grids_100m.png" alt="Population density by grid cells of 100m x 100m" width="100%" />
<p class="caption">
Figure 3.4: Population density by grid cells of 100m x 100m
</p>
</div>
</div>
<div id="population-density-worldpop-1" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Population density WorldPop</h3>
<p>We can compare our results with the WorldPop total population estimation per grid-cell of 3 arc (approx. gri cells of 100m x 100m):</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="exploratory-data-analysis-1.html#cb24-1" aria-hidden="true" tabindex="-1"></a>  dnk_ppp_2019_link <span class="ot">&lt;-</span> <span class="st">&quot;https://data.worldpop.org/GIS/Population/Global_2000_2020/2019/DNK/dnk_ppp_2019.tif&quot;</span></span>
<span id="cb24-2"><a href="exploratory-data-analysis-1.html#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">&quot;data&quot;</span>)</span>
<span id="cb24-3"><a href="exploratory-data-analysis-1.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(dnk_ppp_2019_link, <span class="st">&quot;data/dnk_ppp_2019.tif&quot;</span>, <span class="at">method =</span> <span class="st">&quot;curl&quot;</span>)</span>
<span id="cb24-4"><a href="exploratory-data-analysis-1.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-5"><a href="exploratory-data-analysis-1.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(stars)</span>
<span id="cb24-6"><a href="exploratory-data-analysis-1.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb24-7"><a href="exploratory-data-analysis-1.html#cb24-7" aria-hidden="true" tabindex="-1"></a>  dnk_ppp_2019 <span class="ot">&lt;-</span> <span class="fu">read_stars</span>(<span class="at">.x =</span> <span class="st">&quot;data/dnk_ppp_2019.tif&quot;</span>,  <span class="at">proxy =</span> <span class="cn">TRUE</span>) </span>
<span id="cb24-8"><a href="exploratory-data-analysis-1.html#cb24-8" aria-hidden="true" tabindex="-1"></a>  bbox <span class="ot">&lt;-</span>  study_area <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(dnk_ppp_2019))</span>
<span id="cb24-9"><a href="exploratory-data-analysis-1.html#cb24-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-10"><a href="exploratory-data-analysis-1.html#cb24-10" aria-hidden="true" tabindex="-1"></a>  cph_ppp_2019 <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(dnk_ppp_2019, bbox) <span class="sc">%&gt;%</span></span>
<span id="cb24-11"><a href="exploratory-data-analysis-1.html#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">&quot;EPSG:25832&quot;</span>)</span>
<span id="cb24-12"><a href="exploratory-data-analysis-1.html#cb24-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-13"><a href="exploratory-data-analysis-1.html#cb24-13" aria-hidden="true" tabindex="-1"></a>  col <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&quot;YlGnBu&quot;</span>)</span>
<span id="cb24-14"><a href="exploratory-data-analysis-1.html#cb24-14" aria-hidden="true" tabindex="-1"></a>  pal <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(col)</span>
<span id="cb24-15"><a href="exploratory-data-analysis-1.html#cb24-15" aria-hidden="true" tabindex="-1"></a>  my_pallette <span class="ot">&lt;-</span> <span class="fu">pal</span>(<span class="dv">10</span>)</span>
<span id="cb24-16"><a href="exploratory-data-analysis-1.html#cb24-16" aria-hidden="true" tabindex="-1"></a>  brks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(cph_ppp_2019<span class="sc">$</span>dnk_ppp_2019.tif, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb24-17"><a href="exploratory-data-analysis-1.html#cb24-17" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>,</span>
<span id="cb24-18"><a href="exploratory-data-analysis-1.html#cb24-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">max</span>(cph_ppp_2019<span class="sc">$</span>dnk_ppp_2019.tif, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb24-19"><a href="exploratory-data-analysis-1.html#cb24-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-20"><a href="exploratory-data-analysis-1.html#cb24-20" aria-hidden="true" tabindex="-1"></a>  cph_ppp_2019 <span class="ot">&lt;-</span> cph_ppp_2019 <span class="sc">%&gt;%</span> </span>
<span id="cb24-21"><a href="exploratory-data-analysis-1.html#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="at">pop_cuts =</span> <span class="fu">cut</span>(dnk_ppp_2019.tif, <span class="at">breaks =</span> brks, <span class="at">include.lowest =</span> T))  </span>
<span id="cb24-22"><a href="exploratory-data-analysis-1.html#cb24-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-23"><a href="exploratory-data-analysis-1.html#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb24-24"><a href="exploratory-data-analysis-1.html#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> cph_parish, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb24-25"><a href="exploratory-data-analysis-1.html#cb24-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_stars</span>(<span class="at">data =</span> cph_ppp_2019, <span class="fu">aes</span>(<span class="at">fill =</span> pop_cuts)) <span class="sc">+</span></span>
<span id="cb24-26"><a href="exploratory-data-analysis-1.html#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="fu">TeX</span>(<span class="st">&quot;$</span><span class="sc">\\</span><span class="st">overset{</span><span class="sc">\\</span><span class="st">textbf{Population}}{(x1000/km^2)}$&quot;</span>),</span>
<span id="cb24-27"><a href="exploratory-data-analysis-1.html#cb24-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> my_pallette,</span>
<span id="cb24-28"><a href="exploratory-data-analysis-1.html#cb24-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb24-29"><a href="exploratory-data-analysis-1.html#cb24-29" aria-hidden="true" tabindex="-1"></a>                      <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse=</span><span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb24-30"><a href="exploratory-data-analysis-1.html#cb24-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Estimated total number of people per grid-cell of 3 arc&quot;</span>,</span>
<span id="cb24-31"><a href="exploratory-data-analysis-1.html#cb24-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">&quot;Source: WorlpPop (https://data.worldpop.org)&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-32"><a href="exploratory-data-analysis-1.html#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">my_theme_map</span>()</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="exploratory-data-analysis-1.html#cb25-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">&quot;results/pop_dens_2019_worldpop_100m.png&quot;</span>,</span>
<span id="cb25-2"><a href="exploratory-data-analysis-1.html#cb25-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> <span class="dv">20</span>,</span>
<span id="cb25-3"><a href="exploratory-data-analysis-1.html#cb25-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">15</span>,</span>
<span id="cb25-4"><a href="exploratory-data-analysis-1.html#cb25-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="exploratory-data-analysis-1.html#cb26-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;results/pop_dens_2019_worldpop_100m.png&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-pop-map-worldpop"></span>
<img src="results/pop_dens_2019_worldpop_100m.png" alt="worldpop total population density estimations in 2019" width="100%" />
<p class="caption">
Figure 3.5: worldpop total population density estimations in 2019
</p>
</div>
</div>
<div id="land-use-and-residential-units-corine-1" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Land use and residential units (CORINE)</h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="exploratory-data-analysis-1.html#cb27-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-2"><a href="exploratory-data-analysis-1.html#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> cph_corine,</span>
<span id="cb27-3"><a href="exploratory-data-analysis-1.html#cb27-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">fill =</span> label3),</span>
<span id="cb27-4"><a href="exploratory-data-analysis-1.html#cb27-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>,</span>
<span id="cb27-5"><a href="exploratory-data-analysis-1.html#cb27-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb27-6"><a href="exploratory-data-analysis-1.html#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> res_units, <span class="at">size =</span> <span class="fl">0.02</span>, <span class="at">shape =</span> <span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb27-7"><a href="exploratory-data-analysis-1.html#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;Land use&quot;</span>,</span>
<span id="cb27-8"><a href="exploratory-data-analysis-1.html#cb27-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">levels</span>(cph_corine<span class="sc">$</span>hex_col),</span>
<span id="cb27-9"><a href="exploratory-data-analysis-1.html#cb27-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">drop =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb27-10"><a href="exploratory-data-analysis-1.html#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">my_theme_map</span>() <span class="sc">+</span></span>
<span id="cb27-11"><a href="exploratory-data-analysis-1.html#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Residential units and land use&quot;</span>,</span>
<span id="cb27-12"><a href="exploratory-data-analysis-1.html#cb27-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb27-13"><a href="exploratory-data-analysis-1.html#cb27-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-14"><a href="exploratory-data-analysis-1.html#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">&quot;br&quot;</span>, <span class="at">text_cex =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb27-15"><a href="exploratory-data-analysis-1.html#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">&quot;br&quot;</span>,</span>
<span id="cb27-16"><a href="exploratory-data-analysis-1.html#cb27-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">1.80</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb27-17"><a href="exploratory-data-analysis-1.html#cb27-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.65</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb27-18"><a href="exploratory-data-analysis-1.html#cb27-18" aria-hidden="true" tabindex="-1"></a>                           <span class="at">which_north =</span> <span class="st">&quot;true&quot;</span>,</span>
<span id="cb27-19"><a href="exploratory-data-analysis-1.html#cb27-19" aria-hidden="true" tabindex="-1"></a>                           <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb27-20"><a href="exploratory-data-analysis-1.html#cb27-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">width =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb27-21"><a href="exploratory-data-analysis-1.html#cb27-21" aria-hidden="true" tabindex="-1"></a>                           <span class="at">style =</span> <span class="fu">north_arrow_orienteering</span>(<span class="at">text_col =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb27-22"><a href="exploratory-data-analysis-1.html#cb27-22" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">text_size =</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="exploratory-data-analysis-1.html#cb28-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">&quot;results/land_use_corine.png&quot;</span>,</span>
<span id="cb28-2"><a href="exploratory-data-analysis-1.html#cb28-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> <span class="dv">25</span>,</span>
<span id="cb28-3"><a href="exploratory-data-analysis-1.html#cb28-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">15</span>,</span>
<span id="cb28-4"><a href="exploratory-data-analysis-1.html#cb28-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="exploratory-data-analysis-1.html#cb29-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;results/land_use_corine.png&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-land-use"></span>
<img src="results/land_use_corine.png" alt="CORINE land use and residential units" width="100%" />
<p class="caption">
Figure 3.6: CORINE land use and residential units
</p>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exploratory-data-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/javiereliomedina/housing_prices_book/edit/master/05-EDA.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/javiereliomedina/housing_prices_book/blob/master/05-EDA.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
