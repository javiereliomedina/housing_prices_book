<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Capital region | Housing prices Copenhagen</title>
  <meta name="description" content="Housing prices BBR data" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Capital region | Housing prices Copenhagen" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Housing prices BBR data" />
  <meta name="github-repo" content="javiereliomedina/housing_prices_book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Capital region | Housing prices Copenhagen" />
  
  <meta name="twitter:description" content="Housing prices BBR data" />
  

<meta name="author" content="Javier Elío, Marina Georgati, Henning S. Hansen, Frederik S. Hass, Carsten Keßler" />


<meta name="date" content="2021-07-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="level-muni.html"/>
<link rel="next" href="level-CPH.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    // close the dropdown menu when an option is clicked
    $("#allCodeButton").dropdown("toggle");
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    // close the dropdown menu when an option is clicked
    $("#allCodeButton").dropdown("toggle");
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // if code block has been labeled with class `fold-show`, show the code on init!
    var classList = $(this).attr('class').split(/\s+/);
    for (var i = 0; i < classList.length; i++) {
    if (classList[i] === 'fold-show') {
        show = true;
      }
    }

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // hack: return show to false, otherwise all next codeBlocks will be shown!
    show = false;

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<style type="text/css">
.code-folding-btn {
  margin-bottom: 4px;
}

.row { display: flex; }
.collapse { display: none; }
.in { display:block }
.pull-right > .dropdown-menu {
    right: 0;
    left: auto;
}

.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    float: left;
    min-width: 160px;
    padding: 5px 0;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    list-style: none;
    background-color: #fff;
    -webkit-background-clip: padding-box;
    background-clip: padding-box;
    border: 1px solid #ccc;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 4px;
    -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
    box-shadow: 0 6px 12px rgba(0,0,0,.175);
}

.open > .dropdown-menu {
    display: block;
    color: #ffffff;
    background-color: #ffffff;
    background-image: none;
    border-color: #92897e;
}

.dropdown-menu > li > a {
  display: block;
  padding: 3px 20px;
  clear: both;
  font-weight: 400;
  line-height: 1.42857143;
  color: #000000;
  white-space: nowrap;
}

.dropdown-menu > li > a:hover,
.dropdown-menu > li > a:focus {
  color: #ffffff;
  text-decoration: none;
  background-color: #e95420;
}

.dropdown-menu > .active > a,
.dropdown-menu > .active > a:hover,
.dropdown-menu > .active > a:focus {
  color: #ffffff;
  text-decoration: none;
  background-color: #e95420;
  outline: 0;
}
.dropdown-menu > .disabled > a,
.dropdown-menu > .disabled > a:hover,
.dropdown-menu > .disabled > a:focus {
  color: #aea79f;
}

.dropdown-menu > .disabled > a:hover,
.dropdown-menu > .disabled > a:focus {
  text-decoration: none;
  cursor: not-allowed;
  background-color: transparent;
  background-image: none;
  filter: progid:DXImageTransform.Microsoft.gradient(enabled = false);
}

.btn {
  display: inline-block;
  margin-bottom: 1;
  font-weight: normal;
  text-align: center;
  white-space: nowrap;
  vertical-align: middle;
  -ms-touch-action: manipulation;
      touch-action: manipulation;
  cursor: pointer;
  background-image: none;
  border: 1px solid transparent;
  padding: 4px 8px;
  font-size: 14px;
  line-height: 1.42857143;
  border-radius: 4px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.btn:focus,
.btn:active:focus,
.btn.active:focus,
.btn.focus,
.btn:active.focus,
.btn.active.focus {
  outline: 5px auto -webkit-focus-ring-color;
  outline-offset: -2px;
}
.btn:hover,
.btn:focus,
.btn.focus {
  color: #ffffff;
  text-decoration: none;
}
.btn:active,
.btn.active {
  background-image: none;
  outline: 0;
  box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}
.btn.disabled,
.btn[disabled],
fieldset[disabled] .btn {
  cursor: not-allowed;
  filter: alpha(opacity=65);
  opacity: 0.65;
  box-shadow: none;
}
a.btn.disabled,
fieldset[disabled] a.btn {
  pointer-events: none;
}
.btn-default {
  color: #ffffff;
  background-color: #aea79f; #important
  border-color: #aea79f;
}

.btn-default:focus,
.btn-default.focus {
  color: #ffffff;
  background-color: #978e83;
  border-color: #6f675e;
}

.btn-default:hover {
  color: #ffffff;
  background-color: #978e83;
  border-color: #92897e;
}
.btn-default:active,
.btn-default.active,
.btn-group > .btn:not(:first-child):not(:last-child):not(.dropdown-toggle) {
  border-radius: 0;
}
.btn-group > .btn:first-child {
  margin-left: 0;
}
.btn-group > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}
.btn-group > .btn:last-child:not(:first-child),
.btn-group > .dropdown-toggle:not(:first-child) {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}
.btn-group > .btn-group {
  float: left;
}
.btn-group > .btn-group:not(:first-child):not(:last-child) > .btn {
  border-radius: 0;
}
.btn-group > .btn-group:first-child:not(:last-child) > .btn:last-child,
.btn-group > .btn-group:first-child:not(:last-child) > .dropdown-toggle {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}
.btn-group > .btn-group:last-child:not(:first-child) > .btn:first-child {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}
.btn-group .dropdown-toggle:active,
.btn-group.open .dropdown-toggle {
  outline: 0;
}
.btn-group > .btn + .dropdown-toggle {
  padding-right: 8px;
  padding-left: 8px;
}
.btn-group > .btn-lg + .dropdown-toggle {
  padding-right: 12px;
  padding-left: 12px;
}
.btn-group.open .dropdown-toggle {
  box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}
.btn-group.open .dropdown-toggle.btn-link {
  box-shadow: none;
}

</style>
<script>
var str = '<div class="btn-group pull-right" style="position: fixed; right: 50px; top: 10px; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" id="allCodeButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>';
document.write(str);
</script>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Housing prices in Copenhagen region</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisite</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-session"><i class="fa fa-check"></i>R session</a></li>
</ul></li>
<li class="part"><span><b>I Population growth in Denmark and housing prices</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Population growth, migration and house prices</a></li>
<li class="chapter" data-level="2" data-path="level-muni.html"><a href="level-muni.html"><i class="fa fa-check"></i><b>2</b> Analysis at national level (municipalities)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="level-muni.html"><a href="level-muni.html#pop-growth-muni"><i class="fa fa-check"></i><b>2.1</b> Population growth</a></li>
<li class="chapter" data-level="2.2" data-path="level-muni.html"><a href="level-muni.html#house-prices-muni"><i class="fa fa-check"></i><b>2.2</b> Housing prices level</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="level-parish.html"><a href="level-parish.html"><i class="fa fa-check"></i><b>3</b> Capital region</a>
<ul>
<li class="chapter" data-level="3.1" data-path="level-parish.html"><a href="level-parish.html#population-data"><i class="fa fa-check"></i><b>3.1</b> Population data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="level-parish.html"><a href="level-parish.html#spatial-distribution"><i class="fa fa-check"></i><b>3.1.1</b> Spatial distribution</a></li>
<li class="chapter" data-level="3.1.2" data-path="level-parish.html"><a href="level-parish.html#autocorrelation-moran-i"><i class="fa fa-check"></i><b>3.1.2</b> Autocorrelation (Moran I)</a></li>
<li class="chapter" data-level="3.1.3" data-path="level-parish.html"><a href="level-parish.html#ternary-plots"><i class="fa fa-check"></i><b>3.1.3</b> Ternary plots</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="level-parish.html"><a href="level-parish.html#house-prices-at-parish-level"><i class="fa fa-check"></i><b>3.2</b> House prices at parish level</a></li>
<li class="chapter" data-level="3.3" data-path="level-parish.html"><a href="level-parish.html#compositional-data-analysis"><i class="fa fa-check"></i><b>3.3</b> Compositional data analysis</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="level-CPH.html"><a href="level-CPH.html"><i class="fa fa-check"></i><b>4</b> Copenhagen city</a>
<ul>
<li class="chapter" data-level="4.1" data-path="level-CPH.html"><a href="level-CPH.html#population-density-by-grid-cells-of-100m-x-100m"><i class="fa fa-check"></i><b>4.1</b> Population density by grid cells of 100m x 100m</a></li>
<li class="chapter" data-level="4.2" data-path="level-CPH.html"><a href="level-CPH.html#house-prices-by-grid-cells-of-100m-x-100m"><i class="fa fa-check"></i><b>4.2</b> House prices by grid cells of 100m x 100m</a></li>
<li class="chapter" data-level="4.3" data-path="level-CPH.html"><a href="level-CPH.html#population-density-and-house-prices"><i class="fa fa-check"></i><b>4.3</b> Population density and house prices</a></li>
</ul></li>
<li class="part"><span><b>II Hedonic price model</b></span></li>
<li class="chapter" data-level="5" data-path="hedonic-price-model.html"><a href="hedonic-price-model.html"><i class="fa fa-check"></i><b>5</b> Hedonic model</a>
<ul>
<li class="chapter" data-level="5.1" data-path="hedonic-price-model.html"><a href="hedonic-price-model.html#house-characteristics"><i class="fa fa-check"></i><b>5.1</b> House characteristics</a></li>
<li class="chapter" data-level="5.2" data-path="hedonic-price-model.html"><a href="hedonic-price-model.html#location-characteristics"><i class="fa fa-check"></i><b>5.2</b> Location characteristics</a></li>
<li class="chapter" data-level="5.3" data-path="hedonic-price-model.html"><a href="hedonic-price-model.html#neighbourhood-characteristics"><i class="fa fa-check"></i><b>5.3</b> Neighbourhood characteristics</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="OSM-features.html"><a href="OSM-features.html"><i class="fa fa-check"></i><b>6</b> Open Street Map</a>
<ul>
<li class="chapter" data-level="6.1" data-path="OSM-features.html"><a href="OSM-features.html#features"><i class="fa fa-check"></i><b>6.1</b> Features</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="OSM-features.html"><a href="OSM-features.html#areal-features"><i class="fa fa-check"></i><b>6.1.1</b> Areal features</a></li>
<li class="chapter" data-level="6.1.2" data-path="OSM-features.html"><a href="OSM-features.html#point-features"><i class="fa fa-check"></i><b>6.1.2</b> Point features</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="OSM-features.html"><a href="OSM-features.html#potential-model"><i class="fa fa-check"></i><b>6.2</b> Potential model</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="dist-CBD.html"><a href="dist-CBD.html"><i class="fa fa-check"></i><b>7</b> Distance to Central Business District</a></li>
<li class="chapter" data-level="8" data-path="noise.html"><a href="noise.html"><i class="fa fa-check"></i><b>8</b> Noise</a></li>
<li class="part"><span><b>III Data analysis</b></span></li>
<li class="chapter" data-level="9" data-path="EDA-house-prices.html"><a href="EDA-house-prices.html"><i class="fa fa-check"></i><b>9</b> Residential units saled as free scale</a>
<ul>
<li class="chapter" data-level="9.1" data-path="EDA-house-prices.html"><a href="EDA-house-prices.html#residential-units-by-floor-level"><i class="fa fa-check"></i><b>9.1</b> Residential units by floor level</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Housing prices Copenhagen</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="level-parish" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Capital region</h1>
<p>Migration in the capital region. Spatial patterns (<span class="citation"><a href="#ref-Georgati2021" role="doc-biblioref">Georgati and Keßler</a> (<a href="#ref-Georgati2021" role="doc-biblioref">2021</a>)</span>) and links with house prices.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="level-parish.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Communes polygons of Denmark, and select those in the study area</span></span>
<span id="cb31-2"><a href="level-parish.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  dk_country <span class="ot">&lt;-</span> <span class="fu">st_union</span>(dk_muni)</span>
<span id="cb31-3"><a href="level-parish.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-4"><a href="level-parish.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Codes of the communes under study</span></span>
<span id="cb31-5"><a href="level-parish.html#cb31-5" aria-hidden="true" tabindex="-1"></a>  capital_region_muni <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;København&quot;</span>,</span>
<span id="cb31-6"><a href="level-parish.html#cb31-6" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Frederiksberg&quot;</span>,</span>
<span id="cb31-7"><a href="level-parish.html#cb31-7" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Albertslund&quot;</span>,</span>
<span id="cb31-8"><a href="level-parish.html#cb31-8" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Ballerup&quot;</span>,</span>
<span id="cb31-9"><a href="level-parish.html#cb31-9" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Brøndby&quot;</span>,</span>
<span id="cb31-10"><a href="level-parish.html#cb31-10" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Dragør&quot;</span>,</span>
<span id="cb31-11"><a href="level-parish.html#cb31-11" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Gentofte&quot;</span>,</span>
<span id="cb31-12"><a href="level-parish.html#cb31-12" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Gladsaxe&quot;</span>,</span>
<span id="cb31-13"><a href="level-parish.html#cb31-13" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Glostrup&quot;</span>,</span>
<span id="cb31-14"><a href="level-parish.html#cb31-14" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Herlev&quot;</span>,</span>
<span id="cb31-15"><a href="level-parish.html#cb31-15" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Høje-Taastrup&quot;</span>,</span>
<span id="cb31-16"><a href="level-parish.html#cb31-16" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Hvidovre&quot;</span>,</span>
<span id="cb31-17"><a href="level-parish.html#cb31-17" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Ishøj&quot;</span>,</span>
<span id="cb31-18"><a href="level-parish.html#cb31-18" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Lyngby-Taarbæk&quot;</span>,</span>
<span id="cb31-19"><a href="level-parish.html#cb31-19" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Rødovre&quot;</span>,</span>
<span id="cb31-20"><a href="level-parish.html#cb31-20" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Tårnby&quot;</span>,</span>
<span id="cb31-21"><a href="level-parish.html#cb31-21" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Vallensbæk&quot;</span>)</span>
<span id="cb31-22"><a href="level-parish.html#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="level-parish.html#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Select municipalities under study  </span></span>
<span id="cb31-24"><a href="level-parish.html#cb31-24" aria-hidden="true" tabindex="-1"></a> capital_muni <span class="ot">&lt;-</span> dk_muni <span class="sc">%&gt;%</span> <span class="fu">filter</span>(muni_name <span class="sc">%in%</span> capital_region_muni) </span>
<span id="cb31-25"><a href="level-parish.html#cb31-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-26"><a href="level-parish.html#cb31-26" aria-hidden="true" tabindex="-1"></a> dk_country_crop <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(dk_country, capital_muni)</span>
<span id="cb31-27"><a href="level-parish.html#cb31-27" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb31-28"><a href="level-parish.html#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Parishes polygons of Denmark, and select those in the study area </span></span>
<span id="cb31-29"><a href="level-parish.html#cb31-29" aria-hidden="true" tabindex="-1"></a>  prsh_link <span class="ot">&lt;-</span> <span class="fu">paste</span>(loc_dir,</span>
<span id="cb31-30"><a href="level-parish.html#cb31-30" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;DAGIREF_SHAPE_UTM32-EUREF89/ADM&quot;</span>,</span>
<span id="cb31-31"><a href="level-parish.html#cb31-31" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;SOGN.shp&quot;</span>,</span>
<span id="cb31-32"><a href="level-parish.html#cb31-32" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)</span>
<span id="cb31-33"><a href="level-parish.html#cb31-33" aria-hidden="true" tabindex="-1"></a>  dk_prsh  <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(prsh_link) <span class="sc">%&gt;%</span></span>
<span id="cb31-34"><a href="level-parish.html#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_zm</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-35"><a href="level-parish.html#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">&quot;EPSG:25832&quot;</span>)</span>
<span id="cb31-36"><a href="level-parish.html#cb31-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-37"><a href="level-parish.html#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Select those where the centroid is in the capital region</span></span>
<span id="cb31-38"><a href="level-parish.html#cb31-38" aria-hidden="true" tabindex="-1"></a>  dk_prsh_cent <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(dk_prsh)</span>
<span id="cb31-39"><a href="level-parish.html#cb31-39" aria-hidden="true" tabindex="-1"></a>  capital_prsh_cent <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(dk_prsh_cent, capital_muni)</span>
<span id="cb31-40"><a href="level-parish.html#cb31-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-41"><a href="level-parish.html#cb31-41" aria-hidden="true" tabindex="-1"></a>  capital_prsh <span class="ot">&lt;-</span> dk_prsh <span class="sc">%&gt;%</span> </span>
<span id="cb31-42"><a href="level-parish.html#cb31-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get parishes in the capital region</span></span>
<span id="cb31-43"><a href="level-parish.html#cb31-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(SOGNEKODE <span class="sc">%in%</span> capital_prsh_cent<span class="sc">$</span>SOGNEKODE) <span class="sc">%&gt;%</span> </span>
<span id="cb31-44"><a href="level-parish.html#cb31-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine several parish features geometries into one polygon</span></span>
<span id="cb31-45"><a href="level-parish.html#cb31-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(SOGNEKODE, SOGNENAVN) <span class="sc">%&gt;%</span> </span>
<span id="cb31-46"><a href="level-parish.html#cb31-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">geometry =</span> <span class="fu">st_union</span>(geometry)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-47"><a href="level-parish.html#cb31-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-48"><a href="level-parish.html#cb31-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add area of the parish (in km2)</span></span>
<span id="cb31-49"><a href="level-parish.html#cb31-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prsh_area_km2 =</span> <span class="fu">as.numeric</span>(units<span class="sc">::</span><span class="fu">set_units</span>(<span class="fu">st_area</span>(.), km<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb31-50"><a href="level-parish.html#cb31-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Translate column names</span></span>
<span id="cb31-51"><a href="level-parish.html#cb31-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">prsh_id =</span> SOGNEKODE,</span>
<span id="cb31-52"><a href="level-parish.html#cb31-52" aria-hidden="true" tabindex="-1"></a>           <span class="at">prsh_name =</span> SOGNENAVN) </span>
<span id="cb31-53"><a href="level-parish.html#cb31-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-54"><a href="level-parish.html#cb31-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Contour of the capital region (merge the parishes in one polygon):</span></span>
<span id="cb31-55"><a href="level-parish.html#cb31-55" aria-hidden="true" tabindex="-1"></a>  capital_area <span class="ot">&lt;-</span> capital_prsh <span class="sc">%&gt;%</span></span>
<span id="cb31-56"><a href="level-parish.html#cb31-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_union</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-57"><a href="level-parish.html#cb31-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-58"><a href="level-parish.html#cb31-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">&quot;EPSG:25832&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="level-parish.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb32-2"><a href="level-parish.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> capital_prsh, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb32-3"><a href="level-parish.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> capital_muni, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb32-4"><a href="level-parish.html#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">my_theme_map</span>() <span class="sc">+</span></span>
<span id="cb32-5"><a href="level-parish.html#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">&quot;br&quot;</span>, <span class="at">text_cex =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb32-6"><a href="level-parish.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">&quot;br&quot;</span>,</span>
<span id="cb32-7"><a href="level-parish.html#cb32-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb32-8"><a href="level-parish.html#cb32-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.65</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb32-9"><a href="level-parish.html#cb32-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">which_north =</span> <span class="st">&quot;true&quot;</span>,</span>
<span id="cb32-10"><a href="level-parish.html#cb32-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb32-11"><a href="level-parish.html#cb32-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">width =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb32-12"><a href="level-parish.html#cb32-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">style =</span> <span class="fu">north_arrow_orienteering</span>(<span class="at">text_col =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb32-13"><a href="level-parish.html#cb32-13" aria-hidden="true" tabindex="-1"></a>                                                          <span class="at">text_size =</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-capital-region"></span>
<img src="Housing_prices_book_files/figure-html/fig-capital-region-1.png" alt="Parishes in the Capital region" width="672" />
<p class="caption">
Figure 3.1: Parishes in the Capital region
</p>
</div>
<div id="population-data" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Population data</h2>
<p>Population data at parish level was uploaded from Denmark Statistics: Tables:</p>
<ul>
<li><a href="https://www.statbank.dk/statbank5a/SelectVarVal/Define.asp?MainTable=KMSTA001&amp;PLanguage=1&amp;PXSId=0&amp;wsid=cftree">KMSTA001: Population 1. January by parish, ancestry and National Church</a>.</li>
<li><a href="https://www.statbank.dk/statbank5a/SelectVarVal/Define.asp?MainTable=KMSTA003&amp;PLanguage=1&amp;PXSId=0&amp;wsid=cftree">KMSTA003: Summary vital statistics by parish and movements</a>.</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="level-parish.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Auxiliary functions for reading the data with the package *danstat*</span></span>
<span id="cb33-2"><a href="level-parish.html#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="level-parish.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop by year for getting DST data </span></span>
<span id="cb33-4"><a href="level-parish.html#cb33-4" aria-hidden="true" tabindex="-1"></a>  steps <span class="ot">&lt;-</span> <span class="cf">function</span>(year){</span>
<span id="cb33-5"><a href="level-parish.html#cb33-5" aria-hidden="true" tabindex="-1"></a>    var_values <span class="ot">&lt;-</span> <span class="fu">list</span>(id_region, id_ancestry, year)</span>
<span id="cb33-6"><a href="level-parish.html#cb33-6" aria-hidden="true" tabindex="-1"></a>    var_input <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map2</span>(<span class="at">.x =</span> var_codes,</span>
<span id="cb33-7"><a href="level-parish.html#cb33-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">.y =</span> var_values,</span>
<span id="cb33-8"><a href="level-parish.html#cb33-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">.f =</span> <span class="sc">~</span><span class="fu">list</span>(<span class="at">code =</span> .x, <span class="at">values =</span> .y))</span>
<span id="cb33-9"><a href="level-parish.html#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_data</span>(id_table, <span class="at">variables =</span> var_input)</span>
<span id="cb33-10"><a href="level-parish.html#cb33-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-11"><a href="level-parish.html#cb33-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb33-12"><a href="level-parish.html#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for removing punctuation, lowercase, stem, stopwords, and collapse strings</span></span>
<span id="cb33-13"><a href="level-parish.html#cb33-13" aria-hidden="true" tabindex="-1"></a>  rm_words <span class="ot">&lt;-</span> <span class="cf">function</span>(x, stopwords) { x <span class="sc">%&gt;%</span> </span>
<span id="cb33-14"><a href="level-parish.html#cb33-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">strsplit</span>(<span class="st">&quot; &quot;</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-15"><a href="level-parish.html#cb33-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lapply</span>(tm<span class="sc">::</span>removePunctuation) <span class="sc">%&gt;%</span> </span>
<span id="cb33-16"><a href="level-parish.html#cb33-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lapply</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb33-17"><a href="level-parish.html#cb33-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lapply</span>(SnowballC<span class="sc">::</span>wordStem) <span class="sc">%&gt;%</span> </span>
<span id="cb33-18"><a href="level-parish.html#cb33-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lapply</span>(<span class="cf">function</span>(x) x[<span class="sc">!</span>x <span class="sc">%in%</span> stopwords]) <span class="sc">%&gt;%</span> </span>
<span id="cb33-19"><a href="level-parish.html#cb33-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">vapply</span>(<span class="cf">function</span>(x) <span class="fu">paste</span>(x , <span class="at">collapse =</span> <span class="st">&quot;_&quot;</span>), <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb33-20"><a href="level-parish.html#cb33-20" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="level-parish.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Read and clean table KMSTA001</span></span>
<span id="cb34-2"><a href="level-parish.html#cb34-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb34-3"><a href="level-parish.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Table </span></span>
<span id="cb34-4"><a href="level-parish.html#cb34-4" aria-hidden="true" tabindex="-1"></a>  id_table <span class="ot">&lt;-</span> <span class="st">&quot;KMSTA001&quot;</span></span>
<span id="cb34-5"><a href="level-parish.html#cb34-5" aria-hidden="true" tabindex="-1"></a>  var_pop <span class="ot">&lt;-</span> <span class="fu">get_table_metadata</span>(<span class="at">table_id =</span> id_table, <span class="at">variables_only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-6"><a href="level-parish.html#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="level-parish.html#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Codes for var_input</span></span>
<span id="cb34-8"><a href="level-parish.html#cb34-8" aria-hidden="true" tabindex="-1"></a>  var_codes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;SOGN&quot;</span>, <span class="st">&quot;HERKOMST&quot;</span>, <span class="st">&quot;Tid&quot;</span>)</span>
<span id="cb34-9"><a href="level-parish.html#cb34-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-10"><a href="level-parish.html#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Values for var_input</span></span>
<span id="cb34-11"><a href="level-parish.html#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Region: parishes of the study area (i.e. capital_parish)</span></span>
<span id="cb34-12"><a href="level-parish.html#cb34-12" aria-hidden="true" tabindex="-1"></a>  id_region <span class="ot">&lt;-</span> capital_prsh<span class="sc">$</span>prsh_id </span>
<span id="cb34-13"><a href="level-parish.html#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ancestry</span></span>
<span id="cb34-14"><a href="level-parish.html#cb34-14" aria-hidden="true" tabindex="-1"></a>  id_ancestry <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb34-15"><a href="level-parish.html#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Quarters</span></span>
<span id="cb34-16"><a href="level-parish.html#cb34-16" aria-hidden="true" tabindex="-1"></a>  id_year <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2008</span>, end_year, <span class="dv">1</span>)   <span class="co"># Select 2008-2020 </span></span>
<span id="cb34-17"><a href="level-parish.html#cb34-17" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb34-18"><a href="level-parish.html#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data (n parallel) </span></span>
<span id="cb34-19"><a href="level-parish.html#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">7</span>)</span>
<span id="cb34-20"><a href="level-parish.html#cb34-20" aria-hidden="true" tabindex="-1"></a>  capital_prsh_ancestry_read <span class="ot">&lt;-</span> id_year <span class="sc">%&gt;%</span></span>
<span id="cb34-21"><a href="level-parish.html#cb34-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">future_map_dfr</span>(steps)  </span>
<span id="cb34-22"><a href="level-parish.html#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plan</span>(<span class="st">&quot;default&quot;</span>)</span>
<span id="cb34-23"><a href="level-parish.html#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="level-parish.html#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean data </span></span>
<span id="cb34-25"><a href="level-parish.html#cb34-25" aria-hidden="true" tabindex="-1"></a>  capital_prsh_ancestry <span class="ot">&lt;-</span> capital_prsh_ancestry_read <span class="sc">%&gt;%</span> </span>
<span id="cb34-26"><a href="level-parish.html#cb34-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Translate column names into English</span></span>
<span id="cb34-27"><a href="level-parish.html#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">parish =</span> SOGN,</span>
<span id="cb34-28"><a href="level-parish.html#cb34-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">ancestry =</span> HERKOMST,</span>
<span id="cb34-29"><a href="level-parish.html#cb34-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">year =</span> TID, </span>
<span id="cb34-30"><a href="level-parish.html#cb34-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">value =</span> INDHOLD) <span class="sc">%&gt;%</span></span>
<span id="cb34-31"><a href="level-parish.html#cb34-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get parish codes, names, and municipality names</span></span>
<span id="cb34-32"><a href="level-parish.html#cb34-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(parish,</span>
<span id="cb34-33"><a href="level-parish.html#cb34-33" aria-hidden="true" tabindex="-1"></a>             <span class="fu">c</span>(<span class="st">&quot;prsh_id&quot;</span>, <span class="st">&quot;prsh_name&quot;</span>, <span class="st">&quot;muni_name&quot;</span>),</span>
<span id="cb34-34"><a href="level-parish.html#cb34-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">sep =</span> <span class="st">&quot; &quot;</span>,</span>
<span id="cb34-35"><a href="level-parish.html#cb34-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">extra =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-36"><a href="level-parish.html#cb34-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">muni_name =</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">(&quot;</span>, <span class="st">&quot;&quot;</span>, muni_name)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-37"><a href="level-parish.html#cb34-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make shorter names in ancestry</span></span>
<span id="cb34-38"><a href="level-parish.html#cb34-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ancestry =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-39"><a href="level-parish.html#cb34-39" aria-hidden="true" tabindex="-1"></a>      ancestry <span class="sc">==</span> <span class="st">&quot;Persons of Danish origin&quot;</span> <span class="sc">~</span> <span class="st">&quot;pop_dan&quot;</span>,</span>
<span id="cb34-40"><a href="level-parish.html#cb34-40" aria-hidden="true" tabindex="-1"></a>      ancestry <span class="sc">==</span> <span class="st">&quot;Immigrants from western countries&quot;</span> <span class="sc">~</span> <span class="st">&quot;pop_mi_wst&quot;</span>,</span>
<span id="cb34-41"><a href="level-parish.html#cb34-41" aria-hidden="true" tabindex="-1"></a>      ancestry <span class="sc">==</span> <span class="st">&quot;Immigrants from non-western countries&quot;</span> <span class="sc">~</span> <span class="st">&quot;pop_mi_nwst&quot;</span>,</span>
<span id="cb34-42"><a href="level-parish.html#cb34-42" aria-hidden="true" tabindex="-1"></a>      ancestry <span class="sc">==</span> <span class="st">&quot;Descendants from western countries&quot;</span> <span class="sc">~</span> <span class="st">&quot;pop_de_wst&quot;</span>,</span>
<span id="cb34-43"><a href="level-parish.html#cb34-43" aria-hidden="true" tabindex="-1"></a>      ancestry <span class="sc">==</span> <span class="st">&quot;Descendants from non-western countries&quot;</span> <span class="sc">~</span> <span class="st">&quot;pop_de_nwst&quot;</span>), </span>
<span id="cb34-44"><a href="level-parish.html#cb34-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">ancestry =</span> <span class="fu">factor</span>(ancestry)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-45"><a href="level-parish.html#cb34-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pivot (one row for peach parish and year)</span></span>
<span id="cb34-46"><a href="level-parish.html#cb34-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> ancestry, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb34-47"><a href="level-parish.html#cb34-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge immigrants and their descendants (i.e. foreigners) </span></span>
<span id="cb34-48"><a href="level-parish.html#cb34-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pop_frgn_wst =</span> pop_mi_wst <span class="sc">+</span> pop_de_wst, </span>
<span id="cb34-49"><a href="level-parish.html#cb34-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">pop_frgn_nwst =</span> pop_mi_nwst <span class="sc">+</span> pop_de_nwst) <span class="sc">%&gt;%</span> </span>
<span id="cb34-50"><a href="level-parish.html#cb34-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(pop_mi_wst, pop_de_wst, pop_mi_nwst, pop_de_nwst)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-51"><a href="level-parish.html#cb34-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add column with total population</span></span>
<span id="cb34-52"><a href="level-parish.html#cb34-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pop_total =</span> <span class="fu">select</span>(., <span class="fu">starts_with</span>(<span class="st">&quot;pop_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">rowSums</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb34-53"><a href="level-parish.html#cb34-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Put NA when pop_* is 0</span></span>
<span id="cb34-54"><a href="level-parish.html#cb34-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;pop&quot;</span>), <span class="sc">~</span><span class="fu">ifelse</span>(.x <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, .x)))</span>
<span id="cb34-55"><a href="level-parish.html#cb34-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-56"><a href="level-parish.html#cb34-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the spatial information:</span></span>
<span id="cb34-57"><a href="level-parish.html#cb34-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-58"><a href="level-parish.html#cb34-58" aria-hidden="true" tabindex="-1"></a>capital_prsh_ancestry_sf <span class="ot">&lt;-</span> capital_prsh <span class="sc">%&gt;%</span></span>
<span id="cb34-59"><a href="level-parish.html#cb34-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(prsh_id, prsh_area_km2) <span class="sc">%&gt;%</span> </span>
<span id="cb34-60"><a href="level-parish.html#cb34-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(capital_prsh_ancestry, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;prsh_id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-61"><a href="level-parish.html#cb34-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Population density</span></span>
<span id="cb34-62"><a href="level-parish.html#cb34-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;pop&quot;</span>), <span class="sc">~</span>.x<span class="sc">/</span>prsh_area_km2, <span class="at">.names =</span> <span class="st">&quot;{.col}_km2&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="level-parish.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Read and clean table KMSTA003</span></span>
<span id="cb35-2"><a href="level-parish.html#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="level-parish.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Table </span></span>
<span id="cb35-4"><a href="level-parish.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  id_table <span class="ot">&lt;-</span> <span class="st">&quot;KMSTA003&quot;</span></span>
<span id="cb35-5"><a href="level-parish.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  var_pop <span class="ot">&lt;-</span> <span class="fu">get_table_metadata</span>(<span class="at">table_id =</span> id_table, <span class="at">variables_only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-6"><a href="level-parish.html#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="level-parish.html#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Codes for var_input</span></span>
<span id="cb35-8"><a href="level-parish.html#cb35-8" aria-hidden="true" tabindex="-1"></a>  var_codes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;SOGN&quot;</span>, <span class="st">&quot;KIRKEBEV&quot;</span>, <span class="st">&quot;Tid&quot;</span>)</span>
<span id="cb35-9"><a href="level-parish.html#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="level-parish.html#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Values for var_input</span></span>
<span id="cb35-11"><a href="level-parish.html#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Region: all parish</span></span>
<span id="cb35-12"><a href="level-parish.html#cb35-12" aria-hidden="true" tabindex="-1"></a>  id_region <span class="ot">&lt;-</span> capital_prsh<span class="sc">$</span>prsh_id </span>
<span id="cb35-13"><a href="level-parish.html#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ancestry</span></span>
<span id="cb35-14"><a href="level-parish.html#cb35-14" aria-hidden="true" tabindex="-1"></a>  id_movements <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb35-15"><a href="level-parish.html#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Quarters</span></span>
<span id="cb35-16"><a href="level-parish.html#cb35-16" aria-hidden="true" tabindex="-1"></a>  id_year <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2015</span>, end_year, <span class="dv">1</span>) <span class="co"># data from 2015   </span></span>
<span id="cb35-17"><a href="level-parish.html#cb35-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-18"><a href="level-parish.html#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data</span></span>
<span id="cb35-19"><a href="level-parish.html#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">7</span>) </span>
<span id="cb35-20"><a href="level-parish.html#cb35-20" aria-hidden="true" tabindex="-1"></a>  capital_prsh_stats_read <span class="ot">&lt;-</span> id_year <span class="sc">%&gt;%</span></span>
<span id="cb35-21"><a href="level-parish.html#cb35-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">future_map_dfr</span>(steps)</span>
<span id="cb35-22"><a href="level-parish.html#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plan</span>(<span class="st">&quot;default&quot;</span>)</span>
<span id="cb35-23"><a href="level-parish.html#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="level-parish.html#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean data </span></span>
<span id="cb35-25"><a href="level-parish.html#cb35-25" aria-hidden="true" tabindex="-1"></a>  capital_prsh_stats <span class="ot">&lt;-</span> capital_prsh_stats_read <span class="sc">%&gt;%</span></span>
<span id="cb35-26"><a href="level-parish.html#cb35-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Translate column names into English</span></span>
<span id="cb35-27"><a href="level-parish.html#cb35-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">parish =</span> SOGN,</span>
<span id="cb35-28"><a href="level-parish.html#cb35-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">movements =</span> KIRKEBEV,</span>
<span id="cb35-29"><a href="level-parish.html#cb35-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">year =</span> TID, </span>
<span id="cb35-30"><a href="level-parish.html#cb35-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">value =</span> INDHOLD) <span class="sc">%&gt;%</span> </span>
<span id="cb35-31"><a href="level-parish.html#cb35-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get parish codes, names, and municipality names</span></span>
<span id="cb35-32"><a href="level-parish.html#cb35-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(parish,</span>
<span id="cb35-33"><a href="level-parish.html#cb35-33" aria-hidden="true" tabindex="-1"></a>             <span class="fu">c</span>(<span class="st">&quot;prsh_id&quot;</span>, <span class="st">&quot;prsh_name&quot;</span>, <span class="st">&quot;muni_name&quot;</span>),</span>
<span id="cb35-34"><a href="level-parish.html#cb35-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">sep =</span> <span class="st">&quot; &quot;</span>,</span>
<span id="cb35-35"><a href="level-parish.html#cb35-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">extra =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-36"><a href="level-parish.html#cb35-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">muni_name =</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">(&quot;</span>, <span class="st">&quot;&quot;</span>, muni_name)) <span class="sc">%&gt;%</span></span>
<span id="cb35-37"><a href="level-parish.html#cb35-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean arguments in movements (remove punctuation, stop-words, stem, and collapse)</span></span>
<span id="cb35-38"><a href="level-parish.html#cb35-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">movements =</span> <span class="fu">rm_words</span>(movements, <span class="fu">c</span>(<span class="st">&quot;in&quot;</span>, <span class="st">&quot;the&quot;</span>, <span class="st">&quot;of&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb35-39"><a href="level-parish.html#cb35-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pivot (one row for each parish and year) </span></span>
<span id="cb35-40"><a href="level-parish.html#cb35-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> movements, <span class="at">values_from =</span> value)</span>
<span id="cb35-41"><a href="level-parish.html#cb35-41" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-42"><a href="level-parish.html#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="do">## Merge both datasets in one</span></span>
<span id="cb35-43"><a href="level-parish.html#cb35-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-44"><a href="level-parish.html#cb35-44" aria-hidden="true" tabindex="-1"></a>capital_prsh_pop <span class="ot">&lt;-</span> capital_prsh_ancestry <span class="sc">%&gt;%</span>  </span>
<span id="cb35-45"><a href="level-parish.html#cb35-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(capital_prsh_stats) <span class="sc">%&gt;%</span> </span>
<span id="cb35-46"><a href="level-parish.html#cb35-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove rows with NAs</span></span>
<span id="cb35-47"><a href="level-parish.html#cb35-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb35-48"><a href="level-parish.html#cb35-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-49"><a href="level-parish.html#cb35-49" aria-hidden="true" tabindex="-1"></a><span class="do">## Add the spatial information:</span></span>
<span id="cb35-50"><a href="level-parish.html#cb35-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-51"><a href="level-parish.html#cb35-51" aria-hidden="true" tabindex="-1"></a>capital_prsh_pop_sf <span class="ot">&lt;-</span> capital_prsh <span class="sc">%&gt;%</span></span>
<span id="cb35-52"><a href="level-parish.html#cb35-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(prsh_id, prsh_area_km2) <span class="sc">%&gt;%</span> </span>
<span id="cb35-53"><a href="level-parish.html#cb35-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(capital_prsh_pop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;prsh_id&quot;</span>)) </span></code></pre></div>
<div id="spatial-distribution" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Spatial distribution</h3>
<p>Where people live in the capital region (by parish), and their change from 2008 to 2020:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="level-parish.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate population in percentage   </span></span>
<span id="cb36-2"><a href="level-parish.html#cb36-2" aria-hidden="true" tabindex="-1"></a>capital_prsh_ancestry_sf <span class="ot">&lt;-</span> capital_prsh_ancestry_sf <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="level-parish.html#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb36-4"><a href="level-parish.html#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(pop_dan, pop_frgn_wst, pop_frgn_nwst, pop_total),</span>
<span id="cb36-5"><a href="level-parish.html#cb36-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">.fns =</span> <span class="sc">~</span> <span class="dv">100</span> <span class="sc">*</span> .x <span class="sc">/</span> pop_total,</span>
<span id="cb36-6"><a href="level-parish.html#cb36-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{.col}_pct&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-7"><a href="level-parish.html#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="level-parish.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aux. function for plotting</span></span>
<span id="cb37-2"><a href="level-parish.html#cb37-2" aria-hidden="true" tabindex="-1"></a>plot_ppl_pct <span class="ot">&lt;-</span> <span class="cf">function</span>(pop) { </span>
<span id="cb37-3"><a href="level-parish.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  capital_prsh_ancestry_sf <span class="sc">%&gt;%</span> </span>
<span id="cb37-4"><a href="level-parish.html#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-5"><a href="level-parish.html#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> dk_country_crop, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb37-6"><a href="level-parish.html#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> {{ pop }} ), <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb37-7"><a href="level-parish.html#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis</span>(<span class="at">name =</span> <span class="st">&quot;Percentage&quot;</span>,</span>
<span id="cb37-8"><a href="level-parish.html#cb37-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">option =</span> <span class="st">&quot;magma&quot;</span>,</span>
<span id="cb37-9"><a href="level-parish.html#cb37-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb37-10"><a href="level-parish.html#cb37-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb37-11"><a href="level-parish.html#cb37-11" aria-hidden="true" tabindex="-1"></a>                       ) <span class="sc">+</span></span>
<span id="cb37-12"><a href="level-parish.html#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> capital_muni, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb37-13"><a href="level-parish.html#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">my_theme_map</span>() <span class="sc">+</span></span>
<span id="cb37-14"><a href="level-parish.html#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>( <span class="sc">~</span>year, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb37-15"><a href="level-parish.html#cb37-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="level-parish.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ppl_pct</span>(pop_dan_pct)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-pop-parish-dan"></span>
<img src="Housing_prices_book_files/figure-html/fig-pop-parish-dan-1.png" alt="Population distribution of Danes" width="960" />
<p class="caption">
Figure 3.2: Population distribution of Danes
</p>
</div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="level-parish.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ppl_pct</span>(pop_frgn_nwst_pct)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-pop-parish-nw"></span>
<img src="Housing_prices_book_files/figure-html/fig-pop-parish-nw-1.png" alt="Population distribution of non-Western residents" width="960" />
<p class="caption">
Figure 3.3: Population distribution of non-Western residents
</p>
</div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="level-parish.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ppl_pct</span>(pop_frgn_wst_pct)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-pop-parish-w"></span>
<img src="Housing_prices_book_files/figure-html/fig-pop-parish-w-1.png" alt="Population distribution of Western residents" width="960" />
<p class="caption">
Figure 3.4: Population distribution of Western residents
</p>
</div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="level-parish.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create classes</span></span>
<span id="cb41-2"><a href="level-parish.html#cb41-2" aria-hidden="true" tabindex="-1"></a>bi_data <span class="ot">&lt;-</span> capital_prsh_ancestry_sf <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="level-parish.html#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-4"><a href="level-parish.html#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb41-5"><a href="level-parish.html#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bi_class</span>(<span class="at">x =</span> pop_dan_pct,</span>
<span id="cb41-6"><a href="level-parish.html#cb41-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> pop_frgn_nwst_pct,</span>
<span id="cb41-7"><a href="level-parish.html#cb41-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">style =</span> <span class="st">&quot;quantile&quot;</span>,</span>
<span id="cb41-8"><a href="level-parish.html#cb41-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">dim =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-9"><a href="level-parish.html#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-10"><a href="level-parish.html#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>()</span>
<span id="cb41-11"><a href="level-parish.html#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="level-parish.html#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map</span></span>
<span id="cb41-13"><a href="level-parish.html#cb41-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-14"><a href="level-parish.html#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> dk_country_crop, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb41-15"><a href="level-parish.html#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bi_data,</span>
<span id="cb41-16"><a href="level-parish.html#cb41-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> bi_class),</span>
<span id="cb41-17"><a href="level-parish.html#cb41-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.05</span>, </span>
<span id="cb41-18"><a href="level-parish.html#cb41-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb41-19"><a href="level-parish.html#cb41-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> capital_muni, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb41-20"><a href="level-parish.html#cb41-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bi_scale_fill</span>(<span class="at">pal =</span> <span class="st">&quot;DkBlue&quot;</span>, <span class="at">dim =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb41-21"><a href="level-parish.html#cb41-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">my_theme_map</span>() <span class="sc">+</span></span>
<span id="cb41-22"><a href="level-parish.html#cb41-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year, <span class="at">ncol=</span> <span class="dv">3</span>) </span>
<span id="cb41-23"><a href="level-parish.html#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="level-parish.html#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create legend</span></span>
<span id="cb41-25"><a href="level-parish.html#cb41-25" aria-hidden="true" tabindex="-1"></a>p_legend <span class="ot">&lt;-</span> <span class="fu">bi_legend</span>(<span class="at">pal =</span> <span class="st">&quot;DkBlue&quot;</span>,</span>
<span id="cb41-26"><a href="level-parish.html#cb41-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">dim =</span> <span class="dv">3</span>,</span>
<span id="cb41-27"><a href="level-parish.html#cb41-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xlab =</span> <span class="st">&quot;Danes</span><span class="sc">\n</span><span class="st">(%)&quot;</span>,</span>
<span id="cb41-28"><a href="level-parish.html#cb41-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ylab =</span> <span class="st">&quot;Non-wst</span><span class="sc">\n</span><span class="st">(%)&quot;</span>,</span>
<span id="cb41-29"><a href="level-parish.html#cb41-29" aria-hidden="true" tabindex="-1"></a>                      <span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb41-30"><a href="level-parish.html#cb41-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-31"><a href="level-parish.html#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb41-32"><a href="level-parish.html#cb41-32" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb41-33"><a href="level-parish.html#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAA#</span></span>
<span id="cb41-34"><a href="level-parish.html#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAA#</span></span>
<span id="cb41-35"><a href="level-parish.html#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAA#</span></span>
<span id="cb41-36"><a href="level-parish.html#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAA#</span></span>
<span id="cb41-37"><a href="level-parish.html#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAAB</span></span>
<span id="cb41-38"><a href="level-parish.html#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb41-39"><a href="level-parish.html#cb41-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-40"><a href="level-parish.html#cb41-40" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p_legend <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> layout)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:bivariate-map-migr-danes-nwst"></span>
<img src="Housing_prices_book_files/figure-html/bivariate-map-migr-danes-nwst-1.png" alt="Population distribution of Danes vs. Non-western residents" width="960" />
<p class="caption">
Figure 3.5: Population distribution of Danes vs. Non-western residents
</p>
</div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="level-parish.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create classes</span></span>
<span id="cb42-2"><a href="level-parish.html#cb42-2" aria-hidden="true" tabindex="-1"></a>bi_data <span class="ot">&lt;-</span> capital_prsh_ancestry_sf <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="level-parish.html#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="level-parish.html#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb42-5"><a href="level-parish.html#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bi_class</span>(<span class="at">x =</span> pop_dan_pct,</span>
<span id="cb42-6"><a href="level-parish.html#cb42-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> pop_frgn_wst_pct,</span>
<span id="cb42-7"><a href="level-parish.html#cb42-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">style =</span> <span class="st">&quot;quantile&quot;</span>,</span>
<span id="cb42-8"><a href="level-parish.html#cb42-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">dim =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-9"><a href="level-parish.html#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-10"><a href="level-parish.html#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>()</span>
<span id="cb42-11"><a href="level-parish.html#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="level-parish.html#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map</span></span>
<span id="cb42-13"><a href="level-parish.html#cb42-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb42-14"><a href="level-parish.html#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> dk_country_crop, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb42-15"><a href="level-parish.html#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bi_data,</span>
<span id="cb42-16"><a href="level-parish.html#cb42-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> bi_class),</span>
<span id="cb42-17"><a href="level-parish.html#cb42-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.05</span>, </span>
<span id="cb42-18"><a href="level-parish.html#cb42-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb42-19"><a href="level-parish.html#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> capital_muni, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb42-20"><a href="level-parish.html#cb42-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bi_scale_fill</span>(<span class="at">pal =</span> <span class="st">&quot;DkBlue&quot;</span>, <span class="at">dim =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb42-21"><a href="level-parish.html#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">my_theme_map</span>() <span class="sc">+</span></span>
<span id="cb42-22"><a href="level-parish.html#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year, <span class="at">ncol=</span> <span class="dv">3</span>) </span>
<span id="cb42-23"><a href="level-parish.html#cb42-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-24"><a href="level-parish.html#cb42-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create legend</span></span>
<span id="cb42-25"><a href="level-parish.html#cb42-25" aria-hidden="true" tabindex="-1"></a>p_legend <span class="ot">&lt;-</span> <span class="fu">bi_legend</span>(<span class="at">pal =</span> <span class="st">&quot;DkBlue&quot;</span>,</span>
<span id="cb42-26"><a href="level-parish.html#cb42-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">dim =</span> <span class="dv">3</span>,</span>
<span id="cb42-27"><a href="level-parish.html#cb42-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xlab =</span> <span class="st">&quot;Danes</span><span class="sc">\n</span><span class="st">(%)&quot;</span>,</span>
<span id="cb42-28"><a href="level-parish.html#cb42-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ylab =</span> <span class="st">&quot;Wst</span><span class="sc">\n</span><span class="st">(%)&quot;</span>,</span>
<span id="cb42-29"><a href="level-parish.html#cb42-29" aria-hidden="true" tabindex="-1"></a>                      <span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb42-30"><a href="level-parish.html#cb42-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-31"><a href="level-parish.html#cb42-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb42-32"><a href="level-parish.html#cb42-32" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb42-33"><a href="level-parish.html#cb42-33" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAA#</span></span>
<span id="cb42-34"><a href="level-parish.html#cb42-34" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAA#</span></span>
<span id="cb42-35"><a href="level-parish.html#cb42-35" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAA#</span></span>
<span id="cb42-36"><a href="level-parish.html#cb42-36" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAA#</span></span>
<span id="cb42-37"><a href="level-parish.html#cb42-37" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAAB</span></span>
<span id="cb42-38"><a href="level-parish.html#cb42-38" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb42-39"><a href="level-parish.html#cb42-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-40"><a href="level-parish.html#cb42-40" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p_legend <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> layout)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:bivariate-map-migr-danes-wst"></span>
<img src="Housing_prices_book_files/figure-html/bivariate-map-migr-danes-wst-1.png" alt="Population distribution of Danes vs. Western residents" width="960" />
<p class="caption">
Figure 3.6: Population distribution of Danes vs. Western residents
</p>
</div>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="level-parish.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create classes</span></span>
<span id="cb43-2"><a href="level-parish.html#cb43-2" aria-hidden="true" tabindex="-1"></a>bi_data <span class="ot">&lt;-</span> capital_prsh_ancestry_sf <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="level-parish.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href="level-parish.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb43-5"><a href="level-parish.html#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bi_class</span>(<span class="at">x =</span> pop_frgn_nwst_pct,</span>
<span id="cb43-6"><a href="level-parish.html#cb43-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> pop_frgn_wst_pct,</span>
<span id="cb43-7"><a href="level-parish.html#cb43-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">style =</span> <span class="st">&quot;quantile&quot;</span>,</span>
<span id="cb43-8"><a href="level-parish.html#cb43-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">dim =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-9"><a href="level-parish.html#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-10"><a href="level-parish.html#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>()</span>
<span id="cb43-11"><a href="level-parish.html#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="level-parish.html#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map</span></span>
<span id="cb43-13"><a href="level-parish.html#cb43-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb43-14"><a href="level-parish.html#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> dk_country_crop, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb43-15"><a href="level-parish.html#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bi_data,</span>
<span id="cb43-16"><a href="level-parish.html#cb43-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> bi_class),</span>
<span id="cb43-17"><a href="level-parish.html#cb43-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.05</span>, </span>
<span id="cb43-18"><a href="level-parish.html#cb43-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb43-19"><a href="level-parish.html#cb43-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> capital_muni, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb43-20"><a href="level-parish.html#cb43-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bi_scale_fill</span>(<span class="at">pal =</span> <span class="st">&quot;DkBlue&quot;</span>, <span class="at">dim =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb43-21"><a href="level-parish.html#cb43-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">my_theme_map</span>() <span class="sc">+</span></span>
<span id="cb43-22"><a href="level-parish.html#cb43-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year, <span class="at">ncol=</span> <span class="dv">3</span>) </span>
<span id="cb43-23"><a href="level-parish.html#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="level-parish.html#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create legend</span></span>
<span id="cb43-25"><a href="level-parish.html#cb43-25" aria-hidden="true" tabindex="-1"></a>p_legend <span class="ot">&lt;-</span> <span class="fu">bi_legend</span>(<span class="at">pal =</span> <span class="st">&quot;DkBlue&quot;</span>,</span>
<span id="cb43-26"><a href="level-parish.html#cb43-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">dim =</span> <span class="dv">3</span>,</span>
<span id="cb43-27"><a href="level-parish.html#cb43-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xlab =</span> <span class="st">&quot;Non-wst</span><span class="sc">\n</span><span class="st">(%)&quot;</span>,</span>
<span id="cb43-28"><a href="level-parish.html#cb43-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ylab =</span> <span class="st">&quot;Wst</span><span class="sc">\n</span><span class="st">(%)&quot;</span>,</span>
<span id="cb43-29"><a href="level-parish.html#cb43-29" aria-hidden="true" tabindex="-1"></a>                      <span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb43-30"><a href="level-parish.html#cb43-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-31"><a href="level-parish.html#cb43-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb43-32"><a href="level-parish.html#cb43-32" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb43-33"><a href="level-parish.html#cb43-33" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAA#</span></span>
<span id="cb43-34"><a href="level-parish.html#cb43-34" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAA#</span></span>
<span id="cb43-35"><a href="level-parish.html#cb43-35" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAA#</span></span>
<span id="cb43-36"><a href="level-parish.html#cb43-36" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAA#</span></span>
<span id="cb43-37"><a href="level-parish.html#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="st">AAAAAAB</span></span>
<span id="cb43-38"><a href="level-parish.html#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb43-39"><a href="level-parish.html#cb43-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-40"><a href="level-parish.html#cb43-40" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p_legend <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> layout)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:bivariate-map-migr-wst-nwst"></span>
<img src="Housing_prices_book_files/figure-html/bivariate-map-migr-wst-nwst-1.png" alt="Population distribution of Non-Western vs. Western residents" width="960" />
<p class="caption">
Figure 3.7: Population distribution of Non-Western vs. Western residents
</p>
</div>
<p>There are missing data form some parishes (i.e. mainly in Copenhagen City and from 2011-2015; Figure <a href="#fig:fig-pop-parish"><strong>??</strong></a>). (TRYE to estimate values in this parishes?? e.g. base on the population at municipality and the total number of residential dwellings in each parish…..??)</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="level-parish.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># population at municipality level (at the first day of the year)</span></span>
<span id="cb44-2"><a href="level-parish.html#cb44-2" aria-hidden="true" tabindex="-1"></a>capital_muni_pop_sf <span class="ot">&lt;-</span> dk_muni_pop <span class="sc">%&gt;%</span>  </span>
<span id="cb44-3"><a href="level-parish.html#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get population at the first day of the year</span></span>
<span id="cb44-4"><a href="level-parish.html#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(muni_name <span class="sc">%in%</span> capital_region_muni) <span class="sc">%&gt;%</span> </span>
<span id="cb44-5"><a href="level-parish.html#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(date, <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-6"><a href="level-parish.html#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="st">&quot;01&quot;</span>)</span>
<span id="cb44-7"><a href="level-parish.html#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="level-parish.html#cb44-8" aria-hidden="true" tabindex="-1"></a>capital_muni_pop_sf <span class="sc">%&gt;%</span> </span>
<span id="cb44-9"><a href="level-parish.html#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ancestry <span class="sc">==</span> <span class="st">&quot;Total&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-10"><a href="level-parish.html#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb44-11"><a href="level-parish.html#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> dk_country_crop,</span>
<span id="cb44-12"><a href="level-parish.html#cb44-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb44-13"><a href="level-parish.html#cb44-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pop_km2)) <span class="sc">+</span></span>
<span id="cb44-14"><a href="level-parish.html#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">name =</span> <span class="st">&quot;ppl/km2&quot;</span>,</span>
<span id="cb44-15"><a href="level-parish.html#cb44-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">option =</span> <span class="st">&quot;magma&quot;</span>,</span>
<span id="cb44-16"><a href="level-parish.html#cb44-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb44-17"><a href="level-parish.html#cb44-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">trans =</span> <span class="st">&quot;log10&quot;</span>) <span class="sc">+</span></span>
<span id="cb44-18"><a href="level-parish.html#cb44-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> capital_muni, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb44-19"><a href="level-parish.html#cb44-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">my_theme_map</span>() <span class="sc">+</span></span>
<span id="cb44-20"><a href="level-parish.html#cb44-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span>year, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-pop-muni"></span>
<img src="Housing_prices_book_files/figure-html/fig-pop-muni-1.png" alt="Population density at municipality level" width="960" />
<p class="caption">
Figure 3.8: Population density at municipality level
</p>
</div>
</div>
<div id="autocorrelation-moran-i" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Autocorrelation (Moran I)</h3>
<p>Local spatial autocorrelation. Define neighbours polygons and weights:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="level-parish.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on:</span></span>
<span id="cb45-2"><a href="level-parish.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://mgimond.github.io/simple_moransI_example/</span></span>
<span id="cb45-3"><a href="level-parish.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># https://rpubs.com/quarcs-lab/spatial-autocorrelation</span></span>
<span id="cb45-4"><a href="level-parish.html#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="level-parish.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb45-6"><a href="level-parish.html#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="level-parish.html#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Local Moran index</span></span>
<span id="cb45-8"><a href="level-parish.html#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="level-parish.html#cb45-9" aria-hidden="true" tabindex="-1"></a>f_local_moran <span class="ot">&lt;-</span> <span class="cf">function</span>(year, </span>
<span id="cb45-10"><a href="level-parish.html#cb45-10" aria-hidden="true" tabindex="-1"></a>                          variable, </span>
<span id="cb45-11"><a href="level-parish.html#cb45-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">df =</span> capital_prsh_ancestry_sf, </span>
<span id="cb45-12"><a href="level-parish.html#cb45-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">signif =</span> <span class="fl">0.15</span>) { </span>
<span id="cb45-13"><a href="level-parish.html#cb45-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-14"><a href="level-parish.html#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Polygons</span></span>
<span id="cb45-15"><a href="level-parish.html#cb45-15" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb45-16"><a href="level-parish.html#cb45-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select</span></span>
<span id="cb45-17"><a href="level-parish.html#cb45-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> {{ year }}) <span class="sc">%&gt;%</span> </span>
<span id="cb45-18"><a href="level-parish.html#cb45-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb45-19"><a href="level-parish.html#cb45-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_sf</span>() </span>
<span id="cb45-20"><a href="level-parish.html#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="level-parish.html#cb45-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Variable</span></span>
<span id="cb45-22"><a href="level-parish.html#cb45-22" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> s <span class="sc">%&gt;%</span> </span>
<span id="cb45-23"><a href="level-parish.html#cb45-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Variable</span></span>
<span id="cb45-24"><a href="level-parish.html#cb45-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>( {{ variable }}) </span>
<span id="cb45-25"><a href="level-parish.html#cb45-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-26"><a href="level-parish.html#cb45-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot MI</span></span>
<span id="cb45-27"><a href="level-parish.html#cb45-27" aria-hidden="true" tabindex="-1"></a>  xp <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> </span>
<span id="cb45-28"><a href="level-parish.html#cb45-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Local Index</span></span>
<span id="cb45-29"><a href="level-parish.html#cb45-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">localmoran_perm</span>(<span class="at">listw =</span> <span class="fu">nb2listw</span>(<span class="fu">poly2nb</span>(s, <span class="at">queen =</span> <span class="cn">TRUE</span>),</span>
<span id="cb45-30"><a href="level-parish.html#cb45-30" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">style =</span> <span class="st">&quot;W&quot;</span>,</span>
<span id="cb45-31"><a href="level-parish.html#cb45-31" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">zero.policy =</span> <span class="cn">TRUE</span>),</span>
<span id="cb45-32"><a href="level-parish.html#cb45-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nsim =</span> <span class="dv">999</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-33"><a href="level-parish.html#cb45-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb45-34"><a href="level-parish.html#cb45-34" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">p.value =</span> <span class="st">`</span><span class="at">Pr(z &gt; 0)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-35"><a href="level-parish.html#cb45-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># binds results to our polygon shapefile</span></span>
<span id="cb45-36"><a href="level-parish.html#cb45-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(s) <span class="sc">%&gt;%</span> </span>
<span id="cb45-37"><a href="level-parish.html#cb45-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb45-38"><a href="level-parish.html#cb45-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># center the variable of interest around its mean</span></span>
<span id="cb45-39"><a href="level-parish.html#cb45-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">m_qualification =</span> x <span class="sc">-</span> <span class="fu">mean</span>( x ),</span>
<span id="cb45-40"><a href="level-parish.html#cb45-40" aria-hidden="true" tabindex="-1"></a>           <span class="at">m_local =</span> Ii <span class="sc">-</span> <span class="fu">mean</span>(Ii)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-41"><a href="level-parish.html#cb45-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build quadrant</span></span>
<span id="cb45-42"><a href="level-parish.html#cb45-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">quadrant =</span> <span class="fu">case_when</span>(m_qualification <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> m_local <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb45-43"><a href="level-parish.html#cb45-43" aria-hidden="true" tabindex="-1"></a>                                m_qualification <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> m_local <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb45-44"><a href="level-parish.html#cb45-44" aria-hidden="true" tabindex="-1"></a>                                m_qualification <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> m_local <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb45-45"><a href="level-parish.html#cb45-45" aria-hidden="true" tabindex="-1"></a>                                m_qualification <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> m_local <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">3</span>),</span>
<span id="cb45-46"><a href="level-parish.html#cb45-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">quadrant =</span> <span class="fu">ifelse</span>(p.value <span class="sc">&gt;</span> signif, <span class="dv">0</span>, quadrant)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-47"><a href="level-parish.html#cb45-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">quadrant =</span> <span class="fu">factor</span>(quadrant,</span>
<span id="cb45-48"><a href="level-parish.html#cb45-48" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), </span>
<span id="cb45-49"><a href="level-parish.html#cb45-49" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span>  <span class="fu">c</span>(<span class="st">&quot;Insignificant&quot;</span>,</span>
<span id="cb45-50"><a href="level-parish.html#cb45-50" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;Low-Low&quot;</span>,</span>
<span id="cb45-51"><a href="level-parish.html#cb45-51" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;Low-High&quot;</span>,</span>
<span id="cb45-52"><a href="level-parish.html#cb45-52" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;High-Low&quot;</span>,</span>
<span id="cb45-53"><a href="level-parish.html#cb45-53" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;High-High&quot;</span>))) </span>
<span id="cb45-54"><a href="level-parish.html#cb45-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-55"><a href="level-parish.html#cb45-55" aria-hidden="true" tabindex="-1"></a>  xp <span class="sc">%&gt;%</span> </span>
<span id="cb45-56"><a href="level-parish.html#cb45-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot quadrants (LISA)</span></span>
<span id="cb45-57"><a href="level-parish.html#cb45-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb45-58"><a href="level-parish.html#cb45-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> capital_prsh, <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span> </span>
<span id="cb45-59"><a href="level-parish.html#cb45-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> quadrant), <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb45-60"><a href="level-parish.html#cb45-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;Quadrant&quot;</span> ,</span>
<span id="cb45-61"><a href="level-parish.html#cb45-61" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightgrey&quot;</span>,</span>
<span id="cb45-62"><a href="level-parish.html#cb45-62" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;#0000FF&quot;</span>,</span>
<span id="cb45-63"><a href="level-parish.html#cb45-63" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;#A2A2FF&quot;</span>,</span>
<span id="cb45-64"><a href="level-parish.html#cb45-64" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;#FFA2A2&quot;</span>,</span>
<span id="cb45-65"><a href="level-parish.html#cb45-65" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;#FF0000&quot;</span>),</span>
<span id="cb45-66"><a href="level-parish.html#cb45-66" aria-hidden="true" tabindex="-1"></a>                      <span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb45-67"><a href="level-parish.html#cb45-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> {{ year }},</span>
<span id="cb45-68"><a href="level-parish.html#cb45-68" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> {{ variable }}) <span class="sc">+</span></span>
<span id="cb45-69"><a href="level-parish.html#cb45-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">my_theme_map</span>()</span>
<span id="cb45-70"><a href="level-parish.html#cb45-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-71"><a href="level-parish.html#cb45-71" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-72"><a href="level-parish.html#cb45-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-73"><a href="level-parish.html#cb45-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot maps </span></span>
<span id="cb45-74"><a href="level-parish.html#cb45-74" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">map2</span>(<span class="at">.x =</span> <span class="fu">rep</span>(<span class="dv">2008</span><span class="sc">:</span>end_year, <span class="at">times =</span> <span class="dv">1</span>, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb45-75"><a href="level-parish.html#cb45-75" aria-hidden="true" tabindex="-1"></a>          <span class="at">.y =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;pop_dan_pct&quot;</span>, <span class="st">&quot;pop_frgn_wst_pct&quot;</span>, <span class="st">&quot;pop_frgn_nwst_pct&quot;</span>), </span>
<span id="cb45-76"><a href="level-parish.html#cb45-76" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">length</span>(<span class="fu">rep</span>(<span class="dv">2008</span><span class="sc">:</span>end_year, <span class="at">times =</span> <span class="dv">1</span>, <span class="at">each =</span> <span class="dv">3</span>))<span class="sc">/</span><span class="dv">3</span>),</span>
<span id="cb45-77"><a href="level-parish.html#cb45-77" aria-hidden="true" tabindex="-1"></a>          <span class="sc">~</span><span class="fu">f_local_moran</span>(.x, .y))</span>
<span id="cb45-78"><a href="level-parish.html#cb45-78" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(p, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-MI-local"></span>
<img src="Housing_prices_book_files/figure-html/fig-MI-local-1.png" alt="Local Moran index (p-value &lt; 0.15)" width="960" />
<p class="caption">
Figure 3.9: Local Moran index (p-value &lt; 0.15)
</p>
</div>
</div>
<div id="ternary-plots" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Ternary plots</h3>
<p>There are some issues with <em>ggtern</em> and the new version of <em>ggplot2</em> (v. 3.3.5). Therefore, we have made the ternary plots with older versions in a separate project (<a href="https://javiereliomedina.github.io/ternary_maps_DK/">here</a>), and here we have plotted the results.</p>
<p>Population structure by year, with all the data together in the same diagram.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="level-parish.html#cb46-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;https://github.com/javiereliomedina/ternary_maps_DK/raw/main/_bookdown_files/ternary_maps_DK_files/figure-html/fig-cap-reg-tern-pop-year-1.png&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-cap-reg-tern-pop-year"></span>
<img src="https://github.com/javiereliomedina/ternary_maps_DK/raw/main/_bookdown_files/ternary_maps_DK_files/figure-html/fig-cap-reg-tern-pop-year-1.png" alt="Ternary plot by year"  />
<p class="caption">
Figure 3.10: Ternary plot by year
</p>
</div>
<p>Separate plots by year and add the parishes in the legend.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="level-parish.html#cb47-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;https://github.com/javiereliomedina/ternary_maps_DK/raw/main/_bookdown_files/ternary_maps_DK_files/figure-html/fig-cap-reg-tern-pop-year-prsh-1.png&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-cap-reg-tern-pop-year-prsh"></span>
<img src="https://github.com/javiereliomedina/ternary_maps_DK/raw/main/_bookdown_files/ternary_maps_DK_files/figure-html/fig-cap-reg-tern-pop-year-prsh-1.png" alt="Ternary plots by parish"  />
<p class="caption">
Figure 3.11: Ternary plots by parish
</p>
</div>
<p>maps</p>
<p>Center over the compositional mean of 2019 (i.e. Danes ~ 80.3%; non-wst ~ 12.3; and wst ~ 7.4%).</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="level-parish.html#cb48-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;https://github.com/javiereliomedina/ternary_maps_DK/raw/main/_bookdown_files/ternary_maps_DK_files/figure-html/fig-cap-reg-tern-map-1.png&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-cap-reg-tern-map"></span>
<img src="https://github.com/javiereliomedina/ternary_maps_DK/raw/main/_bookdown_files/ternary_maps_DK_files/figure-html/fig-cap-reg-tern-map-1.png" alt="Population distribution"  />
<p class="caption">
Figure 3.12: Population distribution
</p>
</div>
<p>Only for 2020.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="level-parish.html#cb49-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;https://github.com/javiereliomedina/ternary_maps_DK/raw/main/_bookdown_files/ternary_maps_DK_files/figure-html/fig-cap-reg-tern-map-2020-1.png&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-cap-reg-tern-map-2020"></span>
<img src="https://github.com/javiereliomedina/ternary_maps_DK/raw/main/_bookdown_files/ternary_maps_DK_files/figure-html/fig-cap-reg-tern-map-2020-1.png" alt="Population distribution in 2020"  />
<p class="caption">
Figure 3.13: Population distribution in 2020
</p>
</div>
</div>
</div>
<div id="house-prices-at-parish-level" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> House prices at parish level</h2>
<p>W have used all residences for year-round living (<em>ENH_ANVEND_KODE</em>) (i.e. from the Building and Dwelling Register - <a href="https://teknik.bbr.dk/forside">BBR</a>. We remove from the dataset, however, those dwellings that are not actually used for residential purpose (i.e. <em>BOLIGTYPE_KODE</em> <span class="math inline">\(\neq\)</span> E - Andet (bl.a. institutioner og erhverv) or <em>BOLIGTYPE_KODE</em> <span class="math inline">\(\neq\)</span> 5 - Sommer-/fritidsbolig) and dwellings with a size lower than that 10 <span class="math inline">\(m^2\)</span>. We also focus our analysis to the main building types in the City of Copenhagen, which are in this order: i) multi-storey residential buildings (code 140), ii) detached single-family houses (codes 120, 121, 122), and iii) semi-detached houses (codes 130, 131, 132). Colleges were excluded from the data analysis since they are a special type of buildings dedicated to students residences mainly outside of the free marked.</p>
<p>We also select from the main residential buildings those that are on the ordinary free trade (<em>OVERDRAGELSES_KODE == 1 - Almindelig frit salg</em>) or public sales (<em>OVERDRAGELSES_KODE == 3 - Auktion</em>), since these values represent what people are willing to pay for own a property. Finally, we adjusted the housing prices to 2019 prices and estimated the price per square meter (<span class="math inline">\(kDDK/m^2\)</span>) by dividing the 2020 adjusted prices and the size of the dwelling (<em>BEBO_ARL</em>). Inconsistent values have been removed; i.e. 2019 adjusted prices = 0 kDKK.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="level-parish.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Buildings for year round living</span></span>
<span id="cb50-2"><a href="level-parish.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  res_codes <span class="ot">&lt;-</span> <span class="fu">tribble</span> (<span class="sc">~</span>ENH_ANVEND_KODE, <span class="sc">~</span>type,</span>
<span id="cb50-3"><a href="level-parish.html#cb50-3" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">120</span>, <span class="st">&quot;Single-family house&quot;</span>,</span>
<span id="cb50-4"><a href="level-parish.html#cb50-4" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">121</span>, <span class="st">&quot;Single-family house&quot;</span>,</span>
<span id="cb50-5"><a href="level-parish.html#cb50-5" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">122</span>, <span class="st">&quot;Single-family house&quot;</span>,</span>
<span id="cb50-6"><a href="level-parish.html#cb50-6" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">130</span>, <span class="st">&quot;Semi-detached house&quot;</span>,</span>
<span id="cb50-7"><a href="level-parish.html#cb50-7" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">131</span>, <span class="st">&quot;Semi-detached house&quot;</span>,</span>
<span id="cb50-8"><a href="level-parish.html#cb50-8" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">132</span>, <span class="st">&quot;Semi-detached house&quot;</span>,</span>
<span id="cb50-9"><a href="level-parish.html#cb50-9" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">140</span>, <span class="st">&quot;Multi-storey&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-10"><a href="level-parish.html#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert type to factor</span></span>
<span id="cb50-11"><a href="level-parish.html#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">factor</span>(type)) <span class="sc">%&gt;%</span></span>
<span id="cb50-12"><a href="level-parish.html#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to data.table</span></span>
<span id="cb50-13"><a href="level-parish.html#cb50-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.table</span>()</span>
<span id="cb50-14"><a href="level-parish.html#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="level-parish.html#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for reading residential units in the study area from a BBR files (.csv):</span></span>
<span id="cb50-16"><a href="level-parish.html#cb50-16" aria-hidden="true" tabindex="-1"></a>f_runits_oft_capital <span class="ot">&lt;-</span> <span class="cf">function</span>(.file, <span class="at">.muni =</span> study_area_codes) {</span>
<span id="cb50-17"><a href="level-parish.html#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fread</span>(.file) <span class="sc">%&gt;%</span> </span>
<span id="cb50-18"><a href="level-parish.html#cb50-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select only Residential houses - Buildings for year-round living</span></span>
<span id="cb50-19"><a href="level-parish.html#cb50-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter.</span>(ENH_ANVEND_KODE <span class="sc">%in%</span> res_codes<span class="sc">$</span>ENH_ANVEND_KODE) <span class="sc">%&gt;%</span></span>
<span id="cb50-20"><a href="level-parish.html#cb50-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format KomKode and select municipalities of the study area</span></span>
<span id="cb50-21"><a href="level-parish.html#cb50-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate.</span>(<span class="at">KomKode =</span> <span class="fu">paste0</span>(<span class="st">&quot;0&quot;</span>, KomKode)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-22"><a href="level-parish.html#cb50-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter.</span>(KomKode <span class="sc">%in%</span> .muni) <span class="sc">%&gt;%</span> </span>
<span id="cb50-23"><a href="level-parish.html#cb50-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove residential units not used for residential purpose</span></span>
<span id="cb50-24"><a href="level-parish.html#cb50-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter.</span>(BOLIGTYPE_KODE <span class="sc">!=</span> <span class="st">&quot;E&quot;</span> <span class="sc">|</span> BOLIGTYPE_KODE <span class="sc">!=</span> <span class="st">&quot;5&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-25"><a href="level-parish.html#cb50-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove tiny dwellings (area &lt; 10 m2)</span></span>
<span id="cb50-26"><a href="level-parish.html#cb50-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter.</span>(BEBO_ARL <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-27"><a href="level-parish.html#cb50-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add year of the BBR dataset </span></span>
<span id="cb50-28"><a href="level-parish.html#cb50-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate.</span>(<span class="at">year =</span> <span class="fu">parse_number</span>(stringr<span class="sc">::</span><span class="fu">str_extract</span>(.file, <span class="st">&quot;_[0-9]+_&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb50-29"><a href="level-parish.html#cb50-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert house price (KONTANT_KOEBESUM) to numeric and kDKK</span></span>
<span id="cb50-30"><a href="level-parish.html#cb50-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate.</span>(<span class="at">price_kDKK =</span> KONTANT_KOEBESUM <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb50-31"><a href="level-parish.html#cb50-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">price_kDKK =</span> <span class="fu">as.numeric</span>(price_kDKK)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-32"><a href="level-parish.html#cb50-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop unused factors levels</span></span>
<span id="cb50-33"><a href="level-parish.html#cb50-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">droplevels</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb50-34"><a href="level-parish.html#cb50-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ordinary free trade or auction</span></span>
<span id="cb50-35"><a href="level-parish.html#cb50-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter.</span>(OVERDRAGELSES_KODE <span class="sc">==</span> <span class="st">&quot;1&quot;</span> <span class="sc">|</span> OVERDRAGELSES_KODE <span class="sc">==</span> <span class="st">&quot;3&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-36"><a href="level-parish.html#cb50-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove prices &gt; 0 kDKK</span></span>
<span id="cb50-37"><a href="level-parish.html#cb50-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter.</span>(price_kDKK <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-38"><a href="level-parish.html#cb50-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2020 adjusted house prices</span></span>
<span id="cb50-39"><a href="level-parish.html#cb50-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join.</span>(price_index, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span> <span class="ot">=</span> <span class="st">&quot;index_year&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb50-40"><a href="level-parish.html#cb50-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate.</span>(<span class="at">index_2020 =</span> price_index_2020<span class="sc">$</span>index_value,</span>
<span id="cb50-41"><a href="level-parish.html#cb50-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">price_2020_kDKK =</span> (price_kDKK <span class="sc">*</span> index_2020 <span class="sc">/</span> index_value),</span>
<span id="cb50-42"><a href="level-parish.html#cb50-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">price_2020_kDKK_m2 =</span> price_2020_kDKK <span class="sc">/</span> BEBO_ARL)</span>
<span id="cb50-43"><a href="level-parish.html#cb50-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-44"><a href="level-parish.html#cb50-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-45"><a href="level-parish.html#cb50-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Load residential units (from .csv files)</span></span>
<span id="cb50-46"><a href="level-parish.html#cb50-46" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: you may need to change the path to your file on &quot;OneDrive - Aalborg Universitet&quot; </span></span>
<span id="cb50-47"><a href="level-parish.html#cb50-47" aria-hidden="true" tabindex="-1"></a>  csv_files_path <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;OneDrive_BBR_path&quot;</span>),</span>
<span id="cb50-48"><a href="level-parish.html#cb50-48" aria-hidden="true" tabindex="-1"></a>                               <span class="at">pattern =</span> <span class="st">&quot;*.csv&quot;</span>,</span>
<span id="cb50-49"><a href="level-parish.html#cb50-49" aria-hidden="true" tabindex="-1"></a>                               <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-50"><a href="level-parish.html#cb50-50" aria-hidden="true" tabindex="-1"></a>  study_area_codes <span class="ot">&lt;-</span> capital_muni<span class="sc">$</span>muni_id</span>
<span id="cb50-51"><a href="level-parish.html#cb50-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb50-52"><a href="level-parish.html#cb50-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">7</span>)</span>
<span id="cb50-53"><a href="level-parish.html#cb50-53" aria-hidden="true" tabindex="-1"></a>  runits_oft_capital_read <span class="ot">&lt;-</span> <span class="fu">future_map_dfr</span>(<span class="at">.x =</span> csv_files_path,</span>
<span id="cb50-54"><a href="level-parish.html#cb50-54" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">.f =</span> f_runits_oft_capital)</span>
<span id="cb50-55"><a href="level-parish.html#cb50-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plan</span>(<span class="st">&quot;default&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="level-parish.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean dataset</span></span>
<span id="cb51-2"><a href="level-parish.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  runits_oft_capital <span class="ot">&lt;-</span> runits_oft_capital_read <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="level-parish.html#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Input empty cells in Etagebetegn (buildings with only one floor) as &quot;st&quot;</span></span>
<span id="cb51-4"><a href="level-parish.html#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate.</span>(<span class="at">Etagebetegn =</span> <span class="fu">fifelse</span>(Etagebetegn <span class="sc">==</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;st&quot;</span>, Etagebetegn)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-5"><a href="level-parish.html#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Etagebetegn as ordered factor</span></span>
<span id="cb51-6"><a href="level-parish.html#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate.</span>(<span class="at">Etagebetegn =</span> <span class="fu">factor</span>(Etagebetegn,</span>
<span id="cb51-7"><a href="level-parish.html#cb51-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">c</span>(<span class="st">&quot;k2&quot;</span>, <span class="st">&quot;kl&quot;</span>, <span class="st">&quot;st&quot;</span>, <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">36</span>, <span class="dv">1</span>)),</span>
<span id="cb51-8"><a href="level-parish.html#cb51-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ordered =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-9"><a href="level-parish.html#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group floor levels with 5 or more</span></span>
<span id="cb51-10"><a href="level-parish.html#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate.</span>(<span class="at">floor_level =</span> <span class="fu">fct_other</span>(Etagebetegn,</span>
<span id="cb51-11"><a href="level-parish.html#cb51-11" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">drop =</span> <span class="fu">factor</span>(<span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">36</span>)),</span>
<span id="cb51-12"><a href="level-parish.html#cb51-12" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">other_level =</span> <span class="st">&quot;5 or more&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-13"><a href="level-parish.html#cb51-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add residential description (type) into the dataset</span></span>
<span id="cb51-14"><a href="level-parish.html#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join.</span>(res_codes, <span class="at">by =</span> <span class="st">&quot;ENH_ANVEND_KODE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-15"><a href="level-parish.html#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert columns with codes (*_KODE) to character</span></span>
<span id="cb51-16"><a href="level-parish.html#cb51-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate.</span>(<span class="fu">across.</span>(<span class="fu">ends_with</span>(<span class="st">&quot;KODE&quot;</span>), <span class="sc">~</span><span class="fu">as.character</span>(.))) </span>
<span id="cb51-17"><a href="level-parish.html#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="level-parish.html#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to sf objects and add population data by ancestry</span></span>
<span id="cb51-19"><a href="level-parish.html#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">7</span>)</span>
<span id="cb51-20"><a href="level-parish.html#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="level-parish.html#cb51-21" aria-hidden="true" tabindex="-1"></a>runits_oft_capital_sf <span class="ot">&lt;-</span> runits_oft_capital <span class="sc">%&gt;%</span> </span>
<span id="cb51-22"><a href="level-parish.html#cb51-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to sf object</span></span>
<span id="cb51-23"><a href="level-parish.html#cb51-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;etrs89koordinat_ost&quot;</span>,</span>
<span id="cb51-24"><a href="level-parish.html#cb51-24" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;etrs89koordinat_nord&quot;</span>),</span>
<span id="cb51-25"><a href="level-parish.html#cb51-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="st">&quot;EPSG:25832&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-26"><a href="level-parish.html#cb51-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Detect to what parish belongs a house</span></span>
<span id="cb51-27"><a href="level-parish.html#cb51-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>(year) <span class="sc">%&gt;%</span>  </span>
<span id="cb51-28"><a href="level-parish.html#cb51-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">future_map_dfr</span>(., <span class="sc">~</span><span class="fu">st_join</span>(., capital_prsh, <span class="at">join =</span> st_nearest_feature),</span>
<span id="cb51-29"><a href="level-parish.html#cb51-29" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.options =</span> <span class="fu">furrr_options</span>(<span class="at">seed =</span> <span class="dv">123</span>))</span>
<span id="cb51-30"><a href="level-parish.html#cb51-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-31"><a href="level-parish.html#cb51-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(<span class="st">&quot;default&quot;</span>)</span></code></pre></div>
<p>The total number of residential units used for the analysis is therefore 342227 (Table <a href="level-parish.html#tab:tbl-runits-oft-capital">3.1</a>).</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="level-parish.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table with Number of residential units</span></span>
<span id="cb52-2"><a href="level-parish.html#cb52-2" aria-hidden="true" tabindex="-1"></a>runits_oft_capital_sf <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="level-parish.html#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb52-4"><a href="level-parish.html#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summarize by type or residency and year</span></span>
<span id="cb52-5"><a href="level-parish.html#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type, year) <span class="sc">%&gt;%</span> </span>
<span id="cb52-6"><a href="level-parish.html#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb52-7"><a href="level-parish.html#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb52-8"><a href="level-parish.html#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arrange and add row with totals</span></span>
<span id="cb52-9"><a href="level-parish.html#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb52-10"><a href="level-parish.html#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot</span></span>
<span id="cb52-11"><a href="level-parish.html#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb52-12"><a href="level-parish.html#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-13"><a href="level-parish.html#cb52-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Number of residential dwellings in the free trade by year&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-14"><a href="level-parish.html#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_paper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb52-15"><a href="level-parish.html#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">4</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-16"><a href="level-parish.html#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;100%&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:tbl-runits-oft-capital">Table 3.1: </span>Number of residential dwellings in the free trade by year
</caption>
<thead>
<tr>
<th style="text-align:left;">
type
</th>
<th style="text-align:right;">
2004
</th>
<th style="text-align:right;">
2005
</th>
<th style="text-align:right;">
2006
</th>
<th style="text-align:right;">
2007
</th>
<th style="text-align:right;">
2008
</th>
<th style="text-align:right;">
2009
</th>
<th style="text-align:right;">
2010
</th>
<th style="text-align:right;">
2011
</th>
<th style="text-align:right;">
2012
</th>
<th style="text-align:right;">
2013
</th>
<th style="text-align:right;">
2014
</th>
<th style="text-align:right;">
2015
</th>
<th style="text-align:right;">
2016
</th>
<th style="text-align:right;">
2017
</th>
<th style="text-align:right;">
2018
</th>
<th style="text-align:right;">
2019
</th>
<th style="text-align:right;">
2020
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Multi-storey
</td>
<td style="text-align:right;">
16314
</td>
<td style="text-align:right;">
19448
</td>
<td style="text-align:right;">
17940
</td>
<td style="text-align:right;">
15528
</td>
<td style="text-align:right;">
9168
</td>
<td style="text-align:right;">
6634
</td>
<td style="text-align:right;">
18887
</td>
<td style="text-align:right;">
11025
</td>
<td style="text-align:right;">
13820
</td>
<td style="text-align:right;">
13146
</td>
<td style="text-align:right;">
15475
</td>
<td style="text-align:right;">
17109
</td>
<td style="text-align:right;">
15330
</td>
<td style="text-align:right;">
16754
</td>
<td style="text-align:right;">
15720
</td>
<td style="text-align:right;">
16328
</td>
<td style="text-align:right;">
12628
</td>
</tr>
<tr>
<td style="text-align:left;">
Single-family house
</td>
<td style="text-align:right;">
3687
</td>
<td style="text-align:right;">
3672
</td>
<td style="text-align:right;">
2758
</td>
<td style="text-align:right;">
2818
</td>
<td style="text-align:right;">
2423
</td>
<td style="text-align:right;">
2138
</td>
<td style="text-align:right;">
3944
</td>
<td style="text-align:right;">
2735
</td>
<td style="text-align:right;">
3240
</td>
<td style="text-align:right;">
3191
</td>
<td style="text-align:right;">
3499
</td>
<td style="text-align:right;">
3958
</td>
<td style="text-align:right;">
3605
</td>
<td style="text-align:right;">
4000
</td>
<td style="text-align:right;">
3700
</td>
<td style="text-align:right;">
3780
</td>
<td style="text-align:right;">
3849
</td>
</tr>
<tr>
<td style="text-align:left;">
Semi-detached house
</td>
<td style="text-align:right;">
1658
</td>
<td style="text-align:right;">
1786
</td>
<td style="text-align:right;">
1957
</td>
<td style="text-align:right;">
1784
</td>
<td style="text-align:right;">
1465
</td>
<td style="text-align:right;">
1019
</td>
<td style="text-align:right;">
2064
</td>
<td style="text-align:right;">
1567
</td>
<td style="text-align:right;">
1672
</td>
<td style="text-align:right;">
1695
</td>
<td style="text-align:right;">
1862
</td>
<td style="text-align:right;">
2318
</td>
<td style="text-align:right;">
2837
</td>
<td style="text-align:right;">
2921
</td>
<td style="text-align:right;">
2944
</td>
<td style="text-align:right;">
2140
</td>
<td style="text-align:right;">
2287
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Total
</td>
<td style="text-align:right;font-weight: bold;">
21659
</td>
<td style="text-align:right;font-weight: bold;">
24906
</td>
<td style="text-align:right;font-weight: bold;">
22655
</td>
<td style="text-align:right;font-weight: bold;">
20130
</td>
<td style="text-align:right;font-weight: bold;">
13056
</td>
<td style="text-align:right;font-weight: bold;">
9791
</td>
<td style="text-align:right;font-weight: bold;">
24895
</td>
<td style="text-align:right;font-weight: bold;">
15327
</td>
<td style="text-align:right;font-weight: bold;">
18732
</td>
<td style="text-align:right;font-weight: bold;">
18032
</td>
<td style="text-align:right;font-weight: bold;">
20836
</td>
<td style="text-align:right;font-weight: bold;">
23385
</td>
<td style="text-align:right;font-weight: bold;">
21772
</td>
<td style="text-align:right;font-weight: bold;">
23675
</td>
<td style="text-align:right;font-weight: bold;">
22364
</td>
<td style="text-align:right;font-weight: bold;">
22248
</td>
<td style="text-align:right;font-weight: bold;">
18764
</td>
</tr>
</tbody>
</table>
</div>
<p>The summary descriptive statistics of the housing prices are:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="level-parish.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create variable labels of the variables to be printed in the table</span></span>
<span id="cb53-2"><a href="level-parish.html#cb53-2" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">var_label</span>(runits_oft_capital_sf<span class="sc">$</span>price_2020_kDKK) <span class="ot">&lt;-</span> <span class="st">&quot;Adjusted prices (kDKK)&quot;</span></span>
<span id="cb53-3"><a href="level-parish.html#cb53-3" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">var_label</span>(runits_oft_capital_sf<span class="sc">$</span>BEBO_ARL)           <span class="ot">&lt;-</span> <span class="st">&quot;Dwelling size (m2)&quot;</span></span>
<span id="cb53-4"><a href="level-parish.html#cb53-4" aria-hidden="true" tabindex="-1"></a>labelled<span class="sc">::</span><span class="fu">var_label</span>(runits_oft_capital_sf<span class="sc">$</span>price_2020_kDKK_m2) <span class="ot">&lt;-</span> <span class="st">&quot;Adjusted prices per square meter (kDKK/m2)&quot;</span></span>
<span id="cb53-5"><a href="level-parish.html#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="level-parish.html#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb53-7"><a href="level-parish.html#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb53-8"><a href="level-parish.html#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="level-parish.html#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary table</span></span>
<span id="cb53-10"><a href="level-parish.html#cb53-10" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span>  <span class="fu">as_tibble</span>(runits_oft_capital_sf)</span>
<span id="cb53-11"><a href="level-parish.html#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="level-parish.html#cb53-12" aria-hidden="true" tabindex="-1"></a>temp  <span class="sc">%&gt;%</span> </span>
<span id="cb53-13"><a href="level-parish.html#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select variables of interest</span></span>
<span id="cb53-14"><a href="level-parish.html#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(type, price_2020_kDKK,  BEBO_ARL, price_2020_kDKK_m2) <span class="sc">%&gt;%</span></span>
<span id="cb53-15"><a href="level-parish.html#cb53-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summary values</span></span>
<span id="cb53-16"><a href="level-parish.html#cb53-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_summary</span>(<span class="at">by =</span> type,</span>
<span id="cb53-17"><a href="level-parish.html#cb53-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">type =</span> <span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">&quot;continuous2&quot;</span>,</span>
<span id="cb53-18"><a href="level-parish.html#cb53-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">statistic =</span> <span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="fu">c</span>(<span class="st">&quot;{mean}&quot;</span>,</span>
<span id="cb53-19"><a href="level-parish.html#cb53-19" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">&quot;{median}&quot;</span>,</span>
<span id="cb53-20"><a href="level-parish.html#cb53-20" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">&quot;{p25} - {p75}&quot;</span>, </span>
<span id="cb53-21"><a href="level-parish.html#cb53-21" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">&quot;{min} - {max}&quot;</span>),</span>
<span id="cb53-22"><a href="level-parish.html#cb53-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">missing =</span> <span class="st">&quot;no&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-23"><a href="level-parish.html#cb53-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_overall</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb53-24"><a href="level-parish.html#cb53-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_spanning_header</span>(<span class="fu">c</span>(<span class="st">&quot;stat_1&quot;</span>, <span class="st">&quot;stat_2&quot;</span>, <span class="st">&quot;stat_3&quot;</span>) <span class="sc">~</span> <span class="st">&quot;**House type**&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-25"><a href="level-parish.html#cb53-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_footnote</span>(<span class="at">update =</span> <span class="fu">everything</span>() <span class="sc">~</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-26"><a href="level-parish.html#cb53-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bold_labels</span>() </span></code></pre></div>
<div id="nufwpmaoon" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#nufwpmaoon .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nufwpmaoon .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nufwpmaoon .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nufwpmaoon .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nufwpmaoon .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nufwpmaoon .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nufwpmaoon .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nufwpmaoon .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nufwpmaoon .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nufwpmaoon .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nufwpmaoon .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nufwpmaoon .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#nufwpmaoon .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nufwpmaoon .gt_from_md > :first-child {
  margin-top: 0;
}

#nufwpmaoon .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nufwpmaoon .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nufwpmaoon .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#nufwpmaoon .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nufwpmaoon .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#nufwpmaoon .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nufwpmaoon .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nufwpmaoon .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nufwpmaoon .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nufwpmaoon .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nufwpmaoon .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#nufwpmaoon .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nufwpmaoon .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#nufwpmaoon .gt_left {
  text-align: left;
}

#nufwpmaoon .gt_center {
  text-align: center;
}

#nufwpmaoon .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nufwpmaoon .gt_font_normal {
  font-weight: normal;
}

#nufwpmaoon .gt_font_bold {
  font-weight: bold;
}

#nufwpmaoon .gt_font_italic {
  font-style: italic;
}

#nufwpmaoon .gt_super {
  font-size: 65%;
}

#nufwpmaoon .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="2" colspan="1"><strong>Overall</strong>, N = 342,227</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner"><strong>House type</strong></span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Multi-storey</strong>, N = 251,254</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Semi-detached house</strong>, N = 33,976</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Single-family house</strong>, N = 56,997</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="font-weight: bold;">Adjusted prices (kDKK)</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Mean</td>
<td class="gt_row gt_center">27,772</td>
<td class="gt_row gt_center">35,883</td>
<td class="gt_row gt_center">5,628</td>
<td class="gt_row gt_center">5,219</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Median</td>
<td class="gt_row gt_center">3,515</td>
<td class="gt_row gt_center">3,309</td>
<td class="gt_row gt_center">3,458</td>
<td class="gt_row gt_center">3,950</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">IQR</td>
<td class="gt_row gt_center">2,183 - 6,703</td>
<td class="gt_row gt_center">1,937 - 10,228</td>
<td class="gt_row gt_center">2,680 - 4,589</td>
<td class="gt_row gt_center">3,111 - 5,437</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Range</td>
<td class="gt_row gt_center">0 - 1,893,909</td>
<td class="gt_row gt_center">0 - 1,893,909</td>
<td class="gt_row gt_center">0 - 339,878</td>
<td class="gt_row gt_center">0 - 251,743</td></tr>
    <tr><td class="gt_row gt_left" style="font-weight: bold;">Dwelling size (m2)</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Mean</td>
<td class="gt_row gt_center">96</td>
<td class="gt_row gt_center">83</td>
<td class="gt_row gt_center">116</td>
<td class="gt_row gt_center">144</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Median</td>
<td class="gt_row gt_center">88</td>
<td class="gt_row gt_center">76</td>
<td class="gt_row gt_center">112</td>
<td class="gt_row gt_center">137</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">IQR</td>
<td class="gt_row gt_center">64 - 118</td>
<td class="gt_row gt_center">58 - 99</td>
<td class="gt_row gt_center">96 - 130</td>
<td class="gt_row gt_center">112 - 165</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Range</td>
<td class="gt_row gt_center">10 - 6,100</td>
<td class="gt_row gt_center">10 - 6,100</td>
<td class="gt_row gt_center">12 - 442</td>
<td class="gt_row gt_center">10 - 1,205</td></tr>
    <tr><td class="gt_row gt_left" style="font-weight: bold;">Adjusted prices per square meter (kDKK/m2)</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Mean</td>
<td class="gt_row gt_center">376</td>
<td class="gt_row gt_center">495</td>
<td class="gt_row gt_center">50</td>
<td class="gt_row gt_center">43</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Median</td>
<td class="gt_row gt_center">36</td>
<td class="gt_row gt_center">39</td>
<td class="gt_row gt_center">31</td>
<td class="gt_row gt_center">31</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">IQR</td>
<td class="gt_row gt_center">27 - 55</td>
<td class="gt_row gt_center">28 - 125</td>
<td class="gt_row gt_center">25 - 40</td>
<td class="gt_row gt_center">24 - 40</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Range</td>
<td class="gt_row gt_center">0 - 39,456</td>
<td class="gt_row gt_center">0 - 39,456</td>
<td class="gt_row gt_center">0 - 12,613</td>
<td class="gt_row gt_center">0 - 15,136</td></tr>
  </tbody>
  
  
</table>
</div>
<p>House prices by type (removing very low prices; i.e. &lt;1 kDKK/m2, n = 1450).</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="level-parish.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">filter</span>(runits_oft_capital_sf, price_2020_kDKK_m2 <span class="sc">&gt;</span> <span class="dv">1</span>),</span>
<span id="cb54-2"><a href="level-parish.html#cb54-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">y =</span> price_2020_kDKK_m2,</span>
<span id="cb54-3"><a href="level-parish.html#cb54-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">factor</span>(year),</span>
<span id="cb54-4"><a href="level-parish.html#cb54-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb54-5"><a href="level-parish.html#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb54-6"><a href="level-parish.html#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb54-7"><a href="level-parish.html#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb54-8"><a href="level-parish.html#cb54-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;kDKK/m2&quot;</span>) <span class="sc">+</span></span>
<span id="cb54-9"><a href="level-parish.html#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> type) <span class="sc">+</span> </span>
<span id="cb54-10"><a href="level-parish.html#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb54-11"><a href="level-parish.html#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-runits-oft-type"></span>
<img src="Housing_prices_book_files/figure-html/fig-runits-oft-type-1.png" alt="Boxplot of residential units in the open free trade by house typr (values have been truncated with house prices &gt;1 kDkk/m2)" width="960" />
<p class="caption">
Figure 3.14: Boxplot of residential units in the open free trade by house typr (values have been truncated with house prices &gt;1 kDkk/m2)
</p>
</div>
<p>House prices parish (spatial distribution)</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="level-parish.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary house prices by parish</span></span>
<span id="cb55-2"><a href="level-parish.html#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="level-parish.html#cb55-3" aria-hidden="true" tabindex="-1"></a>sum_runits_oft_prices <span class="ot">&lt;-</span> runits_oft_capital_sf <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="level-parish.html#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.table</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb55-5"><a href="level-parish.html#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise.</span>(<span class="at">n_runits_oft =</span> <span class="fu">n</span>(), </span>
<span id="cb55-6"><a href="level-parish.html#cb55-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_2020_kDKK_m2   =</span> <span class="fu">mean</span>(price_2020_kDKK_m2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb55-7"><a href="level-parish.html#cb55-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_2020_kDKK_m2 =</span> <span class="fu">median</span>(price_2020_kDKK_m2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb55-8"><a href="level-parish.html#cb55-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">.by =</span> <span class="fu">c</span>(year, prsh_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-9"><a href="level-parish.html#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Link with population data by ancestry </span></span>
<span id="cb55-10"><a href="level-parish.html#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join.</span>(capital_prsh_ancestry_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb55-11"><a href="level-parish.html#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb55-12"><a href="level-parish.html#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data from 2008</span></span>
<span id="cb55-13"><a href="level-parish.html#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2008</span>)</span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="level-parish.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aux. function for plotting</span></span>
<span id="cb56-2"><a href="level-parish.html#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="level-parish.html#cb56-3" aria-hidden="true" tabindex="-1"></a>f_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb56-4"><a href="level-parish.html#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb56-5"><a href="level-parish.html#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> dk_country_crop, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb56-6"><a href="level-parish.html#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> df, </span>
<span id="cb56-7"><a href="level-parish.html#cb56-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">cut</span>(median_2020_kDKK_m2,</span>
<span id="cb56-8"><a href="level-parish.html#cb56-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">breaks =</span> <span class="fu">quantile</span>(sum_runits_oft_prices<span class="sc">$</span>median_2020_kDKK_m2,</span>
<span id="cb56-9"><a href="level-parish.html#cb56-9" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>),</span>
<span id="cb56-10"><a href="level-parish.html#cb56-10" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb56-11"><a href="level-parish.html#cb56-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, </span>
<span id="cb56-12"><a href="level-parish.html#cb56-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">right =</span> <span class="cn">TRUE</span>, </span>
<span id="cb56-13"><a href="level-parish.html#cb56-13" aria-hidden="true" tabindex="-1"></a>                           <span class="at">dig.lab =</span> <span class="dv">0</span>,</span>
<span id="cb56-14"><a href="level-parish.html#cb56-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ordered_result =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb56-15"><a href="level-parish.html#cb56-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb56-16"><a href="level-parish.html#cb56-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> capital_muni, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb56-17"><a href="level-parish.html#cb56-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_d</span>(<span class="at">name =</span> <span class="fu">TeX</span>(<span class="st">&quot;$</span><span class="sc">\\</span><span class="st">overset{</span><span class="sc">\\</span><span class="st">textbf{Percentiles}}{(kDKK/m^2)}$&quot;</span>),</span>
<span id="cb56-18"><a href="level-parish.html#cb56-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">option =</span> <span class="st">&quot;magma&quot;</span>,</span>
<span id="cb56-19"><a href="level-parish.html#cb56-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb56-20"><a href="level-parish.html#cb56-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">my_theme_map</span>() <span class="sc">+</span></span>
<span id="cb56-21"><a href="level-parish.html#cb56-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb56-22"><a href="level-parish.html#cb56-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb56-23"><a href="level-parish.html#cb56-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">&quot;Date&quot;</span>, df<span class="sc">$</span>year, <span class="at">sep =</span> <span class="st">&quot;: &quot;</span>))</span>
<span id="cb56-24"><a href="level-parish.html#cb56-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-25"><a href="level-parish.html#cb56-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-26"><a href="level-parish.html#cb56-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot each year</span></span>
<span id="cb56-27"><a href="level-parish.html#cb56-27" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">7</span>)</span>
<span id="cb56-28"><a href="level-parish.html#cb56-28" aria-hidden="true" tabindex="-1"></a>plts <span class="ot">&lt;-</span> sum_runits_oft_prices <span class="sc">%&gt;%</span> </span>
<span id="cb56-29"><a href="level-parish.html#cb56-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>(year) <span class="sc">%&gt;%</span>  </span>
<span id="cb56-30"><a href="level-parish.html#cb56-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">future_map</span>(., <span class="at">.f =</span> f_plot, <span class="at">.options =</span> <span class="fu">furrr_options</span>(<span class="at">seed =</span> <span class="dv">123</span>))</span>
<span id="cb56-31"><a href="level-parish.html#cb56-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(<span class="st">&quot;default&quot;</span>)</span>
<span id="cb56-32"><a href="level-parish.html#cb56-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-33"><a href="level-parish.html#cb56-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Animation</span></span>
<span id="cb56-34"><a href="level-parish.html#cb56-34" aria-hidden="true" tabindex="-1"></a>years_pd <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2008</span>, end_year, <span class="dv">1</span>) </span>
<span id="cb56-35"><a href="level-parish.html#cb56-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(years_pd)) { <span class="fu">print</span>(plts[[i]]) }</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-prices-runits-parish-a"></span>
<img src="Housing_prices_book_files/figure-html/fig-prices-runits-parish-a-.gif" alt="Median 2020-adjusted house prices in the ordinary free trade by grid cells of 100m x 100m" width="672" />
<p class="caption">
Figure 3.15: Median 2020-adjusted house prices in the ordinary free trade by grid cells of 100m x 100m
</p>
</div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="level-parish.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-2"><a href="level-parish.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> dk_country_crop, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-3"><a href="level-parish.html#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sum_runits_oft_prices, </span>
<span id="cb57-4"><a href="level-parish.html#cb57-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">cut_number</span>(median_2020_kDKK_m2,</span>
<span id="cb57-5"><a href="level-parish.html#cb57-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb57-6"><a href="level-parish.html#cb57-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ordered_result =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-7"><a href="level-parish.html#cb57-7" aria-hidden="true" tabindex="-1"></a>                                <span class="at">dig.lab =</span> <span class="dv">0</span>)),</span>
<span id="cb57-8"><a href="level-parish.html#cb57-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb57-9"><a href="level-parish.html#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> capital_muni, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb57-10"><a href="level-parish.html#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">name =</span> <span class="fu">TeX</span>(<span class="st">&quot;$</span><span class="sc">\\</span><span class="st">overset{</span><span class="sc">\\</span><span class="st">textbf{Percentiles}}{(kDKK/m^2)}$&quot;</span>),</span>
<span id="cb57-11"><a href="level-parish.html#cb57-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">option =</span> <span class="st">&quot;magma&quot;</span>,</span>
<span id="cb57-12"><a href="level-parish.html#cb57-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb57-13"><a href="level-parish.html#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">my_theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-14"><a href="level-parish.html#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb57-15"><a href="level-parish.html#cb57-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-16"><a href="level-parish.html#cb57-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span>year, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-prices-runits-parish-b"></span>
<img src="Housing_prices_book_files/figure-html/fig-prices-runits-parish-b-1.png" alt="Median 2019-adjusted house prices in the ordinary free trade by grid cells of 100m x 100m" width="960" />
<p class="caption">
Figure 3.16: Median 2019-adjusted house prices in the ordinary free trade by grid cells of 100m x 100m
</p>
</div>
<p>remove one parish with non-western migrants up to 80% (NAME). There were not house prices in the ordinary free sale (only for one year); WHY?</p>
</div>
<div id="compositional-data-analysis" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Compositional data analysis</h2>
<p>Migration data usually reflected a percentage over the total population, which make them close data. We need to applu therefore CoDa framework…. Types of transformation worr working with these data (i.e. alr, clr, ilr). We can use standart statistics over these lorg-rations, mainly with ilr transformations (<span class="citation"><a href="#ref-Lloyd2012" role="doc-biblioref">Lloyd, Pawlowsky-Glahn, and Egozcue</a> (<a href="#ref-Lloyd2012" role="doc-biblioref">2012</a>)</span>)</p>
<p>balances - concept and aplications. How to obtain the best transformation (based on expert knowlegde of the data- PCA).</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="level-parish.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(compositions)</span>
<span id="cb58-2"><a href="level-parish.html#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="level-parish.html#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># CoDa (2020)</span></span>
<span id="cb58-4"><a href="level-parish.html#cb58-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> capital_prsh_ancestry_sf <span class="sc">%&gt;%</span></span>
<span id="cb58-5"><a href="level-parish.html#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb58-6"><a href="level-parish.html#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(prsh_id, pop_dan, pop_frgn_nwst, pop_frgn_wst) <span class="sc">%&gt;%</span></span>
<span id="cb58-7"><a href="level-parish.html#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dan =</span> pop_dan, </span>
<span id="cb58-8"><a href="level-parish.html#cb58-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">nwst =</span> pop_frgn_nwst,</span>
<span id="cb58-9"><a href="level-parish.html#cb58-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">wst =</span> pop_frgn_wst) <span class="sc">%&gt;%</span> </span>
<span id="cb58-10"><a href="level-parish.html#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-11"><a href="level-parish.html#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb58-12"><a href="level-parish.html#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>geometry) </span>
<span id="cb58-13"><a href="level-parish.html#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="level-parish.html#cb58-14" aria-hidden="true" tabindex="-1"></a>xc <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> </span>
<span id="cb58-15"><a href="level-parish.html#cb58-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clo</span>(<span class="at">parts =</span> <span class="fu">c</span>(<span class="st">&quot;dan&quot;</span>, <span class="st">&quot;nwst&quot;</span>, <span class="st">&quot;wst&quot;</span>),</span>
<span id="cb58-16"><a href="level-parish.html#cb58-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">total =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb58-17"><a href="level-parish.html#cb58-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">acomp</span>()</span></code></pre></div>
<p>PCA (with clr transformations). Helps to identify the variables that account the most for the variability of the results and chose the balance. ….</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="level-parish.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb59-2"><a href="level-parish.html#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="level-parish.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># PCA</span></span>
<span id="cb59-4"><a href="level-parish.html#cb59-4" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">&lt;-</span> <span class="fu">princomp</span>(xc)</span>
<span id="cb59-5"><a href="level-parish.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(pc)</span></span>
<span id="cb59-6"><a href="level-parish.html#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">coloredBiplot</span>(<span class="at">x =</span> pc,</span>
<span id="cb59-7"><a href="level-parish.html#cb59-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">pc.biplot =</span> T,</span>
<span id="cb59-8"><a href="level-parish.html#cb59-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlabs.pc =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb59-9"><a href="level-parish.html#cb59-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlabs.col =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb59-10"><a href="level-parish.html#cb59-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb59-11"><a href="level-parish.html#cb59-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="st">&quot;Comp. 1 (73%)&quot;</span>,</span>
<span id="cb59-12"><a href="level-parish.html#cb59-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">ylab =</span> <span class="st">&quot;Comp. 1 (27%)&quot;</span>)</span>
<span id="cb59-13"><a href="level-parish.html#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="level-parish.html#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Dendrogram balances</span></span>
<span id="cb59-15"><a href="level-parish.html#cb59-15" aria-hidden="true" tabindex="-1"></a>signary <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">matrix</span>( <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>,  <span class="dv">1</span>,</span>
<span id="cb59-16"><a href="level-parish.html#cb59-16" aria-hidden="true" tabindex="-1"></a>                       <span class="dv">1</span>,  <span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb59-17"><a href="level-parish.html#cb59-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ncol =</span> <span class="dv">3</span>,</span>
<span id="cb59-18"><a href="level-parish.html#cb59-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb59-19"><a href="level-parish.html#cb59-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span>
<span id="cb59-20"><a href="level-parish.html#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="fu">CoDaDendrogram</span>(<span class="at">X =</span> xc,</span>
<span id="cb59-21"><a href="level-parish.html#cb59-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">signary =</span> signary,</span>
<span id="cb59-22"><a href="level-parish.html#cb59-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb59-23"><a href="level-parish.html#cb59-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8</span>,<span class="dv">8</span>),</span>
<span id="cb59-24"><a href="level-parish.html#cb59-24" aria-hidden="true" tabindex="-1"></a>               <span class="co"># type = &quot;l&quot;,</span></span>
<span id="cb59-25"><a href="level-parish.html#cb59-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">main =</span> <span class="st">&quot;CoDa Dendrogram&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:prsh-CoDa-PCA"></span>
<img src="Housing_prices_book_files/figure-html/prsh-CoDa-PCA-1.png" alt="Biplot of clr transfomation and balance dendrogram" width="864" />
<p class="caption">
Figure 3.17: Biplot of clr transfomation and balance dendrogram
</p>
</div>
<p>In our cases, with only three variables, our balances are:</p>
<p><span class="math display">\[ b_1 = \sqrt{\frac{2}{3}} * ln(\frac{x_1 x_2}{x_3^2}) \]</span>
<span class="math display">\[ b_2 = \sqrt{\frac{1}{2}} * ln(\frac{x_1}{x_2}) \]</span>
Where <span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span>, <span class="math inline">\(x_3\)</span> are the Danes, Western, and Non-wester population in the parish.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="level-parish.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bal &lt;- balance(xc, ~pop_dan/pop_frgn_wst/pop_frgn_nwst)</span></span>
<span id="cb60-2"><a href="level-parish.html#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="level-parish.html#cb60-3" aria-hidden="true" tabindex="-1"></a>bal_sf <span class="ot">&lt;-</span> capital_prsh_ancestry_sf <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="level-parish.html#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-5"><a href="level-parish.html#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">b1 =</span> <span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">*</span> <span class="fu">log</span>( ((pop_dan <span class="sc">*</span> pop_frgn_wst)<span class="sc">^</span><span class="fl">0.5</span>) <span class="sc">/</span> (pop_frgn_nwst)),</span>
<span id="cb60-6"><a href="level-parish.html#cb60-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">b2 =</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">log</span>(pop_dan <span class="sc">/</span> pop_frgn_wst))</span></code></pre></div>
<p>We can therefore analyse the spatial autocorrelation of the balances:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="level-parish.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Moran</span></span>
<span id="cb61-2"><a href="level-parish.html#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="level-parish.html#cb61-3" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(bal_sf, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-4"><a href="level-parish.html#cb61-4" aria-hidden="true" tabindex="-1"></a>wts <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">&quot;W&quot;</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-5"><a href="level-parish.html#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="level-parish.html#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Global index</span></span>
<span id="cb61-7"><a href="level-parish.html#cb61-7" aria-hidden="true" tabindex="-1"></a>GMI_b1 <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(bal_sf<span class="sc">$</span>b1, <span class="at">listw =</span> wts) <span class="sc">%&gt;%</span></span>
<span id="cb61-8"><a href="level-parish.html#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb61-9"><a href="level-parish.html#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">balance =</span> <span class="st">&quot;b1&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-10"><a href="level-parish.html#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(balance, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb61-11"><a href="level-parish.html#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">moran_I  =</span> estimate1,</span>
<span id="cb61-12"><a href="level-parish.html#cb61-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">expectation =</span> estimate2,</span>
<span id="cb61-13"><a href="level-parish.html#cb61-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">variance =</span> estimate3)</span>
<span id="cb61-14"><a href="level-parish.html#cb61-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-15"><a href="level-parish.html#cb61-15" aria-hidden="true" tabindex="-1"></a>GMI_b2 <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(bal_sf<span class="sc">$</span>b2, <span class="at">listw =</span> wts) <span class="sc">%&gt;%</span></span>
<span id="cb61-16"><a href="level-parish.html#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb61-17"><a href="level-parish.html#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">balance =</span> <span class="st">&quot;b2&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-18"><a href="level-parish.html#cb61-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(balance, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb61-19"><a href="level-parish.html#cb61-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">moran_I  =</span> estimate1,</span>
<span id="cb61-20"><a href="level-parish.html#cb61-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">expectation =</span> estimate2,</span>
<span id="cb61-21"><a href="level-parish.html#cb61-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">variance =</span> estimate3)</span>
<span id="cb61-22"><a href="level-parish.html#cb61-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-23"><a href="level-parish.html#cb61-23" aria-hidden="true" tabindex="-1"></a>GMI <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(GMI_b1, GMI_b2) <span class="sc">%&gt;%</span></span>
<span id="cb61-24"><a href="level-parish.html#cb61-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code># # A tibble: 2 x 8
#   balance moran_I expectation variance statistic  p.value method                           alternative
#   &lt;chr&gt;     &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;                            &lt;chr&gt;      
# 1 b1        0.470    -0.00794  0.00312      8.56 5.50e-18 Moran I test under randomisation greater    
# 2 b2        0.542    -0.00794  0.00313      9.84 3.92e-23 Moran I test under randomisation greater</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="level-parish.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f_local_moran</span>(<span class="at">df =</span> bal_sf,</span>
<span id="cb63-2"><a href="level-parish.html#cb63-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">year =</span> <span class="dv">2020</span>, </span>
<span id="cb63-3"><a href="level-parish.html#cb63-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">variable =</span> <span class="st">&quot;b1&quot;</span>, </span>
<span id="cb63-4"><a href="level-parish.html#cb63-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">signif =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="Housing_prices_book_files/figure-html/prsh-CoDa-moran-local-b1-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="level-parish.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f_local_moran</span>(<span class="at">df =</span> bal_sf,</span>
<span id="cb64-2"><a href="level-parish.html#cb64-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">year =</span> <span class="dv">2020</span>, </span>
<span id="cb64-3"><a href="level-parish.html#cb64-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">variable =</span> <span class="st">&quot;b2&quot;</span>, </span>
<span id="cb64-4"><a href="level-parish.html#cb64-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">signif =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="Housing_prices_book_files/figure-html/prsh-CoDa-moran-local-b2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Spatial clusters (k-means cluster) with balances: separate Non-western from Danes and Western citizens.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="level-parish.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># based on https://www.tidymodels.org/learn/statistics/k-means/</span></span>
<span id="cb65-2"><a href="level-parish.html#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="level-parish.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the optimal number of clusters</span></span>
<span id="cb65-4"><a href="level-parish.html#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="level-parish.html#cb65-5" aria-hidden="true" tabindex="-1"></a>dat_cluster <span class="ot">&lt;-</span> bal_sf <span class="sc">%&gt;%</span> </span>
<span id="cb65-6"><a href="level-parish.html#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b1, b2) <span class="sc">%&gt;%</span> </span>
<span id="cb65-7"><a href="level-parish.html#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb65-8"><a href="level-parish.html#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>geometry)</span>
<span id="cb65-9"><a href="level-parish.html#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="level-parish.html#cb65-10" aria-hidden="true" tabindex="-1"></a>kclusts <span class="ot">&lt;-</span> </span>
<span id="cb65-11"><a href="level-parish.html#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-12"><a href="level-parish.html#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-13"><a href="level-parish.html#cb65-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">kclust =</span> <span class="fu">map</span>(k, <span class="sc">~</span><span class="fu">kmeans</span>(dat_cluster, .x)),</span>
<span id="cb65-14"><a href="level-parish.html#cb65-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">tidied =</span> <span class="fu">map</span>(kclust, tidy),</span>
<span id="cb65-15"><a href="level-parish.html#cb65-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">glanced =</span> <span class="fu">map</span>(kclust, glance),</span>
<span id="cb65-16"><a href="level-parish.html#cb65-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">augmented =</span> <span class="fu">map</span>(kclust, augment, bal_sf)</span>
<span id="cb65-17"><a href="level-parish.html#cb65-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-18"><a href="level-parish.html#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="level-parish.html#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot total within sum of squares</span></span>
<span id="cb65-20"><a href="level-parish.html#cb65-20" aria-hidden="true" tabindex="-1"></a>clusterings <span class="ot">&lt;-</span> kclusts <span class="sc">%&gt;%</span></span>
<span id="cb65-21"><a href="level-parish.html#cb65-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(glanced))</span>
<span id="cb65-22"><a href="level-parish.html#cb65-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-23"><a href="level-parish.html#cb65-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(clusterings, <span class="fu">aes</span>(k, tot.withinss)) <span class="sc">+</span></span>
<span id="cb65-24"><a href="level-parish.html#cb65-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb65-25"><a href="level-parish.html#cb65-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb65-26"><a href="level-parish.html#cb65-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="Housing_prices_book_files/figure-html/prsh-CoDa-cluster-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="level-parish.html#cb66-1" aria-hidden="true" tabindex="-1"></a>assignments <span class="ot">&lt;-</span> kclusts <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="level-parish.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(augmented)) <span class="sc">%&gt;%</span> </span>
<span id="cb66-3"><a href="level-parish.html#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>()</span>
<span id="cb66-4"><a href="level-parish.html#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="level-parish.html#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot k = 4</span></span>
<span id="cb66-6"><a href="level-parish.html#cb66-6" aria-hidden="true" tabindex="-1"></a>assignments <span class="sc">%&gt;%</span> </span>
<span id="cb66-7"><a href="level-parish.html#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(k <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb66-8"><a href="level-parish.html#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb66-9"><a href="level-parish.html#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> .cluster)) </span></code></pre></div>
<p><img src="Housing_prices_book_files/figure-html/prsh-CoDa-cluster-k4-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="level-parish.html#cb67-1" aria-hidden="true" tabindex="-1"></a>assignments <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="level-parish.html#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(k <span class="sc">==</span> <span class="dv">4</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="level-parish.html#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(.cluster) <span class="sc">%&gt;%</span> </span>
<span id="cb67-4"><a href="level-parish.html#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">ends_with</span>(<span class="st">&quot;pct&quot;</span>), <span class="at">.fns =</span> median)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-5"><a href="level-parish.html#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb67-6"><a href="level-parish.html#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>geometry)</span></code></pre></div>
<pre><code># # A tibble: 4 x 5
#   .cluster pop_dan_pct pop_frgn_wst_pct pop_frgn_nwst_pct pop_total_pct
#   &lt;fct&gt;          &lt;dbl&gt;            &lt;dbl&gt;             &lt;dbl&gt;         &lt;dbl&gt;
# 1 1               54.3             7.17             37.3            100
# 2 2               85.5             4.47              9.78           100
# 3 3               81.7             9.95              7.42           100
# 4 4               75.4             6.45             19.1            100</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="level-parish.html#cb69-1" aria-hidden="true" tabindex="-1"></a>assignments <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="level-parish.html#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(k <span class="sc">==</span> <span class="dv">4</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb69-3"><a href="level-parish.html#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.cluster, pop_dan_pct, pop_frgn_nwst_pct, pop_frgn_wst_pct) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="level-parish.html#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb69-5"><a href="level-parish.html#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span><span class="fu">c</span>(.cluster, geometry),</span>
<span id="cb69-6"><a href="level-parish.html#cb69-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;name&quot;</span>, </span>
<span id="cb69-7"><a href="level-parish.html#cb69-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-8"><a href="level-parish.html#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">gsub</span>(<span class="st">&quot;pop_&quot;</span>, <span class="st">&quot;&quot;</span>, name),</span>
<span id="cb69-9"><a href="level-parish.html#cb69-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="fu">gsub</span>(<span class="st">&quot;_pct&quot;</span>, <span class="st">&quot;&quot;</span>, name),</span>
<span id="cb69-10"><a href="level-parish.html#cb69-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="fu">gsub</span>(<span class="st">&quot;frgn_&quot;</span>, <span class="st">&quot;&quot;</span>, name))  <span class="sc">%&gt;%</span></span>
<span id="cb69-11"><a href="level-parish.html#cb69-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb69-12"><a href="level-parish.html#cb69-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">x =</span> name), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb69-13"><a href="level-parish.html#cb69-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb69-14"><a href="level-parish.html#cb69-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Percentage [%]&quot;</span>)  <span class="sc">+</span></span>
<span id="cb69-15"><a href="level-parish.html#cb69-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>.cluster) <span class="sc">+</span></span>
<span id="cb69-16"><a href="level-parish.html#cb69-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:prsh-CoDa-cluster-boxplot"></span>
<img src="Housing_prices_book_files/figure-html/prsh-CoDa-cluster-boxplot-1.png" alt="Cluster characteristics" width="576" />
<p class="caption">
Figure 3.18: Cluster characteristics
</p>
</div>
<p>Links with house prices (zoom the figure to the parishes with median values).</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="level-parish.html#cb70-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;https://github.com/javiereliomedina/ternary_maps_DK/raw/main/_bookdown_files/ternary_maps_DK_files/figure-html/fig-cap-reg-tern-pop-price-all-1.png&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-cap-reg-tern-pop-price-all"></span>
<img src="https://github.com/javiereliomedina/ternary_maps_DK/raw/main/_bookdown_files/ternary_maps_DK_files/figure-html/fig-cap-reg-tern-pop-price-all-1.png" alt="Median housing prices and popupation distribution by parish (all data)"  />
<p class="caption">
Figure 3.19: Median housing prices and popupation distribution by parish (all data)
</p>
</div>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="level-parish.html#cb71-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;https://github.com/javiereliomedina/ternary_maps_DK/raw/main/_bookdown_files/ternary_maps_DK_files/figure-html/fig-cap-reg-tern-pop-year-prsh-1.png&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:fig-cap-reg-tern-pop-price-year"></span>
<img src="https://github.com/javiereliomedina/ternary_maps_DK/raw/main/_bookdown_files/ternary_maps_DK_files/figure-html/fig-cap-reg-tern-pop-year-prsh-1.png" alt="Median housing prices and popupation distribution by parish and year"  />
<p class="caption">
Figure 3.20: Median housing prices and popupation distribution by parish and year
</p>
</div>
<p>Linear models with N &gt; 5.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="level-parish.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Link median prices (sum_runits_oft_prices) with population (balances - bal_sf)</span></span>
<span id="cb72-2"><a href="level-parish.html#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="level-parish.html#cb72-3" aria-hidden="true" tabindex="-1"></a>bal_prices <span class="ot">&lt;-</span> sum_runits_oft_prices <span class="sc">%&gt;%</span> </span>
<span id="cb72-4"><a href="level-parish.html#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Analyse only 2020 </span></span>
<span id="cb72-5"><a href="level-parish.html#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb72-6"><a href="level-parish.html#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove parish with less that 6 data</span></span>
<span id="cb72-7"><a href="level-parish.html#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_runits_oft <span class="sc">&gt;</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb72-8"><a href="level-parish.html#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select variables of interest</span></span>
<span id="cb72-9"><a href="level-parish.html#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(prsh_id,</span>
<span id="cb72-10"><a href="level-parish.html#cb72-10" aria-hidden="true" tabindex="-1"></a>         pop_dan,</span>
<span id="cb72-11"><a href="level-parish.html#cb72-11" aria-hidden="true" tabindex="-1"></a>         pop_frgn_wst,</span>
<span id="cb72-12"><a href="level-parish.html#cb72-12" aria-hidden="true" tabindex="-1"></a>         pop_frgn_nwst, </span>
<span id="cb72-13"><a href="level-parish.html#cb72-13" aria-hidden="true" tabindex="-1"></a>         pop_total_km2,</span>
<span id="cb72-14"><a href="level-parish.html#cb72-14" aria-hidden="true" tabindex="-1"></a>         median_2020_kDKK_m2) <span class="sc">%&gt;%</span> </span>
<span id="cb72-15"><a href="level-parish.html#cb72-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add balances</span></span>
<span id="cb72-16"><a href="level-parish.html#cb72-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">b1 =</span> <span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">*</span> <span class="fu">log</span>( ((pop_dan <span class="sc">*</span> pop_frgn_wst)<span class="sc">^</span><span class="fl">0.5</span>) <span class="sc">/</span> (pop_frgn_nwst)),</span>
<span id="cb72-17"><a href="level-parish.html#cb72-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">b2 =</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">log</span>(pop_dan <span class="sc">/</span> pop_frgn_wst))</span>
<span id="cb72-18"><a href="level-parish.html#cb72-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-19"><a href="level-parish.html#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Model prices</span></span>
<span id="cb72-20"><a href="level-parish.html#cb72-20" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log10</span>(median_2020_kDKK_m2) <span class="sc">~</span> b1 <span class="sc">+</span> b2, <span class="at">data =</span> bal_prices)</span>
<span id="cb72-21"><a href="level-parish.html#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code></pre></div>
<pre><code># 
# Call:
# lm(formula = log10(median_2020_kDKK_m2) ~ b1 + b2, data = bal_prices)
# 
# Residuals:
#     Min      1Q  Median      3Q     Max 
# -1.8865 -0.0442  0.0015  0.0623  1.1099 
# 
# Coefficients:
#             Estimate Std. Error t value Pr(&gt;|t|)    
# (Intercept)   1.7008     0.1197   14.21  &lt; 2e-16 ***
# b1            0.1557     0.0423    3.68  0.00035 ***
# b2           -0.1260     0.0663   -1.90  0.05971 .  
# ---
# Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
# 
# Residual standard error: 0.251 on 122 degrees of freedom
# Multiple R-squared:  0.134,   Adjusted R-squared:  0.12 
# F-statistic: 9.46 on 2 and 122 DF,  p-value: 0.000152</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="level-parish.html#cb74-1" aria-hidden="true" tabindex="-1"></a>bal_prices<span class="sc">$</span>pred1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(m1)</span>
<span id="cb74-2"><a href="level-parish.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">log10</span>(median_2020_kDKK_m2) <span class="sc">~</span> pred1, bal_prices)</span>
<span id="cb74-3"><a href="level-parish.html#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="Housing_prices_book_files/figure-html/prsh-CoDa-house-prices-lm-results-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Georgati2021" class="csl-entry">
Georgati, Marina, and Carsten Keßler. 2021. <span>“<span class="nocase">Spatially Explicit Population Projections: The case of Copenhagen, Denmark</span>.”</span> <em>AGILE: GIScience Series</em> 2 (June): 1–6. <a href="https://doi.org/10.5194/agile-giss-2-28-2021">https://doi.org/10.5194/agile-giss-2-28-2021</a>.
</div>
<div id="ref-Lloyd2012" class="csl-entry">
Lloyd, Christopher D., Vera Pawlowsky-Glahn, and Juan José Egozcue. 2012. <span>“<span class="nocase">Compositional Data Analysis in Population Studies</span>.”</span> <em>Annals of the Association of American Geographers</em> 102 (6): 1251–66. <a href="https://doi.org/10.1080/00045608.2011.652855">https://doi.org/10.1080/00045608.2011.652855</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="level-muni.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="level-CPH.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/javiereliomedina/housing_prices_book/edit/master/011_3_Capital_region_parish.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
