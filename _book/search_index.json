[["house-prices-and-characteristics.html", "Chapter 2 House prices and characteristics", " Chapter 2 House prices and characteristics We load all buildings for year-round living (BYG_ANVEND_KODE) from the the Building and Dwelling Register (BBR: 110 = Farmhouse for agricultural property. 120, 121, 122 = Detached single-family house (detached house). 130, 131, 132 = Townhouse, chain, or semi-detached house (vertical separation between the units). 140 = Multi-storey residential building (multi-family house, including two-family house (horizontal separation between the units). 150 = College. 160 = Residential building for residential institution. 190 = Second building for year-round living (NOT USED - VERY LOW NUMBER) # Buildings for year round living res_codes &lt;- tribble (~BYG_ANVEND_KODE, ~type, 110, &quot;Farmhouse&quot;, 120, &quot;Single-family house&quot;, 121, &quot;Single-family house&quot;, 122, &quot;Single-family house&quot;, 130, &quot;Semi-detached house&quot;, 131, &quot;Semi-detached house&quot;, 132, &quot;Semi-detached house&quot;, 140, &quot;Multi-storey&quot;, 150, &quot;College&quot;, 160, &quot;Residential institution&quot;, 190, &quot;Second building&quot;) %&gt;% # Convert type to factor mutate(type = factor(type)) # Function for reading residential units from a csv file: # Read residential units from BBR data # Get read residential units in an area # @param file Link to OneDrive with the data (.csv format) # @param area Area where we would get the data (default = study_area) f_res_units &lt;- function(.file, .area = study_area) { fread(.file) %&gt;% # Convert to tibble as_tibble() %&gt;% # Select only Residential houses - Buildings for year-round living filter(ENH_ANVEND_KODE %in% res_codes$BYG_ANVEND_KODE) %&gt;% # Input empty cells (buildings with only one floor) in Etagebetegn as &quot;st&quot; mutate(Etagebetegn = ifelse(Etagebetegn == &quot;&quot;, &quot;st&quot;, Etagebetegn), # Etagebetegn as ordened factor Etagebetegn = factor(Etagebetegn, c(&quot;k2&quot;, &quot;kl&quot;, &quot;st&quot;, seq(1, 36, 1)), ordered = TRUE), # Group floor levels with 5 or more floor_level = fct_other(Etagebetegn, drop = factor(seq(5, 36)), other_level = &quot;5 or more&quot;)) %&gt;% # Add residential description (type) into the dataset left_join(res_codes, by = c(&quot;ENH_ANVEND_KODE&quot; = &quot;BYG_ANVEND_KODE&quot;)) %&gt;% # Convert to sf objects st_as_sf(coords = c(&quot;etrs89koordinat_ost&quot;, &quot;etrs89koordinat_nord&quot;), crs = &quot;EPSG:25832&quot;) %&gt;% # Get only points in the study area mutate(int = st_intersects(., .area) %&gt;% lengths &gt; 0) %&gt;% filter(int == TRUE) %&gt;% # Add year of the BBR dataset mutate(BBR_year = parse_number(stringr::str_extract(.file, &quot;_[0-9]+_&quot;))) %&gt;% # Convert columns with codes (*_KODE) to factors mutate(across(.cols = ends_with(&quot;_KODE&quot;), .fns = as_factor)) } # Load all csv files (one file for each year) in the same tibble with a column indicating the year of the dataset: # Load residential units # NOTE: you may need to change the path to OneDrive - Aalborg Universitet # Read all the data together csv_files_link &lt;- list.files(path = Sys.getenv(&quot;OneDrive_BBR_link&quot;), pattern = &quot;*.csv&quot;, full.names = TRUE) plan(multisession, workers = 3) res_units &lt;- future_map_dfr(.x = csv_files_link, .f = f_res_units) plan(&quot;default&quot;) We focus our analysis to the main buildings type in Copenhagen, which are in this order: i) multi-storey residential buildings (multi-family house or two-family house), ii) detached single-family houses, iii) colleges, and iv) semi-detached houses (Figure 2.1). # Aux. function for plotting 2D kernel density maps: f &lt;- function(.data) { .data %&gt;% st_coordinates() %&gt;% as_tibble() %&gt;% ggplot() + geom_sf(data = cph_parish, fill = &quot;grey&quot;, color = &quot;grey50&quot;, size = 0.05) + geom_point(aes(X, Y), size = 0.02, shape = 16) + stat_density_2d(aes(X, Y, fill = ..level..), alpha = 0.5, h = 700, geom = &quot;polygon&quot;) + scale_fill_distiller(palette = &quot;Spectral&quot;) + theme_void() + theme(legend.position = &quot;none&quot;) + labs(title = .data$type, x = &quot;&quot;, y = &quot;&quot;) } # Plots p &lt;- res_units %&gt;% filter(BBR_year == 2019) %&gt;% # Reorder type factors by the frequency they appear mutate(type = fct_infreq(type)) %&gt;% # Split by house type group_split(type) %&gt;% map( ~ f(.)) wrap_plots(p) + annotation_scale(location = &quot;br&quot;, text_cex = 1) + annotation_north_arrow(location = &quot;br&quot;, pad_x = unit(0.70, &quot;cm&quot;), pad_y = unit(0.65, &quot;cm&quot;), which_north = &quot;true&quot;, height = unit(0.5, &quot;cm&quot;), width = unit(0.5, &quot;cm&quot;), style = north_arrow_orienteering(text_col = &quot;white&quot;, text_size = 1)) + plot_annotation(title = &quot;Residential units in 2019&quot;, theme = theme(plot.title = element_text(size = 14, colour = &quot;darkblue&quot;, face = &quot;bold&quot;), plot.caption = element_text(size = 9, colour = &quot;grey25&quot;) ) ) Figure 2.1: 2D kernel density map Then, we selected from the main residential buildings those that are on the ordinary free trade (Table 2.1). Colleges were also removed from the data analysis since they are a special type of buildings dedicated to students residences mainly outside of the free marked. # Select residential units for the study selected_res_units &lt;- c(&quot;Multi-storey&quot;, &quot;Single-family house&quot;, &quot;Semi-detached house&quot;) res_unit_oft &lt;- res_units %&gt;% # Convert to tibble as_tibble() %&gt;% # Select main residential units in the area filter(type %in% selected_res_units) %&gt;% # ordinary free trade filter(OVERDRAGELSES_KODE == &quot;1&quot;) # Table with Number of residential units res_unit_oft %&gt;% # Summarize by type or residency and year group_by(type, BBR_year) %&gt;% summarise(n = n()) %&gt;% ungroup() %&gt;% # Arrange and add row with totals arrange(BBR_year, desc(n)) %&gt;% # Pivot pivot_wider(names_from = BBR_year, values_from = n) %&gt;% adorn_totals(&quot;row&quot;) %&gt;% kbl(caption = &quot;Number of residential units in the free trade by year&quot;) %&gt;% kable_paper() %&gt;% row_spec(4, bold = TRUE) %&gt;% scroll_box(width = &quot;100%&quot;) Table 2.1: Number of residential units in the free trade by year type 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 Multi-storey 12046 14097 13730 12204 7074 5084 14224 7332 9245 9830 11649 12760 11708 11993 11486 11807 Single-family house 666 671 549 563 465 432 800 533 1036 655 697 697 715 706 663 717 Semi-detached house 268 290 280 356 256 203 306 475 501 482 522 527 1349 1254 1315 544 Total 12980 15058 14559 13123 7795 5719 15330 8340 10782 10967 12868 13984 13772 13953 13464 13068 "]]
