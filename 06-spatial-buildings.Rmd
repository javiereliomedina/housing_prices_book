# (PART) Data analysis {-}

# Spatial distribution of residential units

We focus our analysis to the main buildings type in Copenhagen, which are in this order: i) multi-storey residential buildings (multi-family house or two-family house), ii) detached single-family houses, iii) colleges, and iv) semi-detached houses. Colleges were also removed from the data analysis since they are a special type of buildings dedicated to students residences mainly outside of the ordinary free trade.         

```{r fig-sp-res-builds, fig.width = 9, fig.height = 7, cache = TRUE, dependson = "load-BBR", fig.cap = "2D kernel density map"}

# Aux. function for plotting 2D kernel density maps:
  f <- function(.data) {
    .data %>% 
      st_coordinates() %>%
      as_tibble() %>%
      ggplot() +
      geom_sf(data = cph_parish, fill = "grey", color = "grey50", size = 0.05) +
      geom_point(aes(X, Y), size = 0.02, shape = 16) +
      stat_density_2d(aes(X, Y, fill = ..level..),
                      alpha = 0.5,
                      h = 700,
                      geom = "polygon") +
      scale_fill_distiller(palette = "Spectral")  +
      theme_void() + 
      theme(legend.position = "none") +
      labs(title = .data$type,
           x = "",
           y = "") 
  }

# Plots  
  p <- res_units %>% 
    filter(BBR_year == 2019) %>%  
    # Reorder type factors by the frequency they appear 
    mutate(type = fct_infreq(type)) %>% 
    # Split by house type
    group_split(type) %>%
    map( ~ f(.))
  
  wrap_plots(p) +
    annotation_scale(location = "br", text_cex = 1) +
    annotation_north_arrow(location = "br",
                           pad_x = unit(0.70, "cm"),
                           pad_y = unit(0.65, "cm"),
                           which_north = "true",
                           height = unit(0.5, "cm"),
                           width = unit(0.5, "cm"),
                           style = north_arrow_orienteering(text_col = "white",
                                                            text_size = 1)) +
    plot_annotation(title = "Residential units in 2019",
                    theme = theme(plot.title = element_text(size = 14,
                                                            colour = "darkblue",
                                                            face = "bold"),
                                  plot.caption = element_text(size = 9,
                                                              colour = "grey25")
                    )
    ) 
  
```
