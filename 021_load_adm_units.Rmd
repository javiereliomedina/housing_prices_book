# (PART) Load data {-}

# Administrative units

The Denmark's Administrative Geographical Division ([DAGI](https://sdfe.dk/hent-data/danmarks-administrative-geografiske-inddeling/)) has been used for obtaining the administrative boundaries of Denmark. In this sense, the country is divided in approx. 2200 parishes, 98 municipalities, 5 regions, 22 judicial districts, 12 police districts, 92 constituencies and approx. 1100 postcodes. However, we focused our study in the Copenhagen (*KOMKODE = 0101*) and Frederiksberg (*KOMKODE = 0147*) communes, and we get the statistics for neighbourhood characteristics from data at at parish level.    

```{r adm-units, cache=TRUE}

# Download DAGI (scale 1:10000)
  dangeo_get_data(ftp_folder = "landinddelinger/dagi/SHAPE",
                  zip_name   = "DAGIREF_SHAPE_UTM32-EUREF89.zip")

# Codes of the communes under study (KOMKODE)
  study_area_codes <- c("0101", "0147")

# Communes polygons of Denmark, and select those in the study area
  commune_link <- paste(loc_dir, "DAGIREF_SHAPE_UTM32-EUREF89/ADM", "KOMMUNE.shp", sep = "/")
  dk_commune  <- read_sf(commune_link) %>%
    st_zm() %>% 
    st_transform(crs = "EPSG:25832")

  cph_commune <- filter(dk_commune, KOMKODE %in% study_area_codes)

# Parishes polygons of Denmark, and select those in the study area 
  parish_link <- paste(loc_dir, "DAGIREF_SHAPE_UTM32-EUREF89/ADM", "SOGN.shp", sep = "/")
  dk_parish  <- read_sf(parish_link) %>%
    st_zm() %>% 
    st_transform(crs = "EPSG:25832")

# Select those where the centroid is in the study area
  dk_parish_cent <- st_centroid(dk_parish)
  cph_parish_cent <- st_intersection(dk_parish_cent, cph_commune)

  cph_parish <- filter(dk_parish, SOGNEKODE %in% cph_parish_cent$SOGNEKODE) %>% 
    # Combine several parish features geometries into one polygon
    group_by(SOGNEKODE, SOGNENAVN) %>% 
    summarise(geometry = st_union(geometry)) %>% 
    ungroup() %>% 
    # add area of the parish (in km2)
    mutate(prsh_area_km2 = as.numeric(units::set_units(st_area(.), km^2)))

# Contour of the study area (merge the parishes in one polygon):
  study_area <- cph_parish %>%
    st_union() %>%
    st_sf() %>% 
    st_transform(crs = "EPSG:25832")

```

Some data have been aggregated to gird cells of 100 m x 100 m (i.e. population density), and thus we need to generate a grids over the study area:
```{r grids-100m, cache = TRUE, dependson = "adm-units"}

# Make grids
  grids100m <- study_area %>% 
    # Make regular grids (100m x 100m)
    st_make_grid(cellsize = 100) %>% 
    st_sf() %>% 
    # Grids only in the study area
    st_intersection(study_area) %>% 
    # Name grids as "g001", "g002", ...
    mutate(grid_ID = paste0("g", stringr::str_pad(seq(1, nrow(.), 1), 3, pad = "0")))

# Plot
  ggplot() + 
    geom_sf(data = cph_parish, fill = "grey", color = "grey50", size = 0.05) +
    geom_sf(data = grids100m, fill = NA, color = "red", size = 0.05) + 
    my_theme_map()
  
```
