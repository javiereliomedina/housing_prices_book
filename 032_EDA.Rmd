# Residential units saled as free scale

We focused our study in residential dwellings on the ordinary free trade (Table \@ref(tab:tbl-runits-oft)). **There are large differences in the number of residential units between years, why??**

**Study only one year for the moment (e.g. 2019)??**

## Housing prices 

We adjusted the housing prices for taking into account the inflation and, therefore, be able to compared them between years (@Valtersdorf2020). The indexes have been obtained from Statistic Denmark; i.e. table [EJ66: Price index for sales property (2006=100) by region, category of real property and unit](https://www.statistikbanken.dk/statbank5a/SelectVarVal/Define.asp?MainTable=EJ66&PLanguage=1&PXSId=0&wsid=cftree), and targeted for the study area (i.e. *Province Byen København*).   

$$ Pice_{2019} = Price_{i} \cdot \frac{Index_{2019}}{Index_{i}}$$

Index:

```{r price-index}

# DST table (EJ66: Price index for sales property (2006=100) by region, category of real property and unit)
  id_table <- "EJ66"
  dat_meta <- get_table_metadata(table_id = id_table, variables_only = TRUE)
  
# Values to retrieve
  variables <- list(
    # Province Byen København: region = 01 
    list(code = "OMRÅDE", values = "01"),
    # Category of real property
    list(code = "EJENDOMSKATE", values = c("0111", "2103")),
    # Index
    list(code = "TAL", values = 100),
    # From 2004 to 2019
    list(code = "Tid", values = seq(2004, 2019, 1))
    )

# Get index
  price_index <- get_data("EJ66", variables) %>% 
    # Translate into English 
    rename(region = OMRÅDE,
           category = EJENDOMSKATE,
           unit = TAL,
           date = TID, 
           value = INDHOLD)  
    
# Print table 
  price_index %>% 
    # Wide format
    pivot_wider(names_from = date, 
                values_from = value) %>% 
    select(-region, -unit) %>% 
    kbl(caption = "Price index for sale properties in Copenhagen City") %>% 
    kable_paper() %>% 
    scroll_box(width = "100%")

  
```


## Residential units by floor level

- KL - basement
- ST - ground floor
- 1  - 1st floor
- 2  - 2nd floor
- 3  - 3rd floor
- 4  - 4th floor
- 5 or more = etc.

```{r fig-runits-floor, fig.cap = "Residential units distribution by floor level"}

  res_units_oft %>% 
    group_by(floor_level, type) %>% 
    summarise(n = n()) %>%
    ungroup() %>% 
    # in percentage [%]   
    mutate(perc = 100 * n / sum(n)) %>% 
    # Reorder type levels for plotting multi-storey first
    mutate(type = factor(type)) %>%
    ggplot() +
    geom_bar(aes(y = floor_level, x = perc, fill = type), stat = "identity") +
    labs(y = "", 
         x = "Percentage [%]") +
    theme_bw() +
    theme(legend.position = "bottom",
          legend.title = element_blank()) +
    guides(fill = guide_legend(ncol = 2)) +
    scale_x_continuous(labels = scales::comma) +
    scale_fill_manual(values = c("#0072B2", "#D55E00", "#CC79A7"))
  
```

Dwelling by type codes:

- 1. Egentlig beboelse                       = Actual residence
- 2. Blandet erhverv og beboelse             = Mixed occupations and housing
- 3. Enkeltværelse                           = Single room
- E. Andet (bl.a. institutioner og erhverv)  = Other (including institutions and professions)

```{r runits-use}

  res_units %>%
    as_tibble() %>%
    group_by(BOLIGTYPE_KODE, type) %>%
    summarise(n = n())

```

**Unit area < 0??**

```{r runits-area-neg}

  res_units %>%
    as_tibble() %>%
    filter(BEBO_ARL < 0)

```

**Unit area = 0??**

```{r runits-no-area}

  res_units %>%
    as_tibble() %>%
    filter(BEBO_ARL == 0)

```

**Big houses (area > 1000)**
```{r runits-big-area}

  res_units %>%
    as_tibble() %>%
    filter(BEBO_ARL > 1000) 

```
