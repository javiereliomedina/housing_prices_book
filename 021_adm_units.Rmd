# Administrative units {#adm-units}

The Denmark's Administrative Geographical Division ([DAGI](https://sdfe.dk/hent-data/danmarks-administrative-geografiske-inddeling/)) has been used for obtaining the administrative boundaries of Denmark. In this sense, the country is divided in approx. 2200 parishes, 98 municipalities, 5 regions, 22 judicial districts, 12 police districts, 92 constituencies and approx. 1100 postcodes. However, we focused our study in the Copenhagen (*KOMKODE = 0101*) and Frederiksberg (*KOMKODE = 0147*) communes. 

```{r adm-units, fig.cap="Parishes in the study area"}
# Download DAGI (scale 1:10000)
  dangeo_get_data(ftp_folder = "landinddelinger/dagi/SHAPE",
                  zip_name   = "DAGIREF_SHAPE_UTM32-EUREF89.zip")

# Codes of the communes under study (KOMKODE)
  study_area_codes <- c("0101", "0147")

# Communes polygons of Denmark, and select those in the study area
  commune_link <- paste(loc_dir,
                        "DAGIREF_SHAPE_UTM32-EUREF89/ADM",
                        "KOMMUNE.shp",
                        sep = "/")
  dk_commune  <- read_sf(commune_link) %>%
    st_zm() %>% 
    st_transform(crs = "EPSG:25832")
  
  dk_country <- st_union(dk_commune)
  
  cph_commune <- filter(dk_commune, KOMKODE %in% study_area_codes) %>%
    select(KOMKODE, KOMNAVN) %>% 
    rename(muni_id = KOMKODE,
           muni_name = KOMNAVN) %>% 
    mutate(muni_name = gsub("KÃ¸benhavn", "Copenhagen", muni_name)) %>% 
    group_by(muni_id, muni_name) %>%
    summarise(geometry = sf::st_union(geometry)) %>%
    ungroup() %>% 
    mutate(muni_area_km2 = as.numeric(units::set_units(st_area(.), km^2)))
  
# Parishes polygons of Denmark, and select those in the study area 
  parish_link <- paste(loc_dir,
                       "DAGIREF_SHAPE_UTM32-EUREF89/ADM",
                       "SOGN.shp",
                       sep = "/")
  dk_parish  <- read_sf(parish_link) %>%
    st_zm() %>% 
    st_transform(crs = "EPSG:25832")

# Select those where the centroid is in the study area
  dk_parish_cent <- st_centroid(dk_parish)
  cph_parish_cent <- st_intersection(dk_parish_cent, cph_commune)

  cph_parish <- filter(dk_parish, SOGNEKODE %in% cph_parish_cent$SOGNEKODE) %>% 
    # Combine several parish features geometries into one polygon
    group_by(SOGNEKODE, SOGNENAVN) %>% 
    summarise(geometry = st_union(geometry)) %>% 
    ungroup() %>% 
    # add area of the parish (in km2)
    mutate(prsh_area_km2 = as.numeric(units::set_units(st_area(.), km^2)))

# Contour of the study area (merge the parishes in one polygon):
  study_area <- cph_parish %>%
    st_union() %>%
    st_sf() %>% 
    st_transform(crs = "EPSG:25832")
```

```{r fig-adm-units, fig.cap="Parishes in the study area"}

# Plot parish 
  ggplot() + 
    geom_sf(data = cph_parish, fill = "grey", color = "grey50", size = 0.05) +
    my_theme_map() +
    annotation_scale(location = "br", text_cex = 1) +
    annotation_north_arrow(location = "br",
                           pad_x = unit(1.6, "cm"),
                           pad_y = unit(0.65, "cm"),
                           which_north = "true",
                           height = unit(0.5, "cm"),
                           width = unit(0.5, "cm"),
                           style = north_arrow_orienteering(text_col = "white",
                                                            text_size = 1))
  
```

We have also created grid cells of 100m x 100m for aggregating some data at that scale (i.e. population density).   

```{r grids-100m}

# Make grids
grids100m <- study_area %>% 
  # Make regular grids (100m x 100m)
  st_make_grid(cellsize = 100) %>% 
  st_sf() %>% 
  # Select grids only in the study area
  mutate(int = st_intersects(., study_area) %>% lengths > 0) %>% 
  filter(int == TRUE) %>%
  select(-int) %>% 
  # Name grids as "g001", "g002", ...
  mutate(grid_ID = paste0("g",
                          stringr::str_pad(seq(1, nrow(.), 1), 3, pad = "0")))

# Points to estimate the potential (centroid of the grids of 100m x 100m) 
grids100m <- grids100m %>%
  # Nesting
  nest(data_poly = everything()) %>% 
  # add centroids of the grids
  mutate(data_points = map(data_poly, st_centroid))

```


```{r fig-grids-100m, fig.cap="Grid cells of 100m x 100m"}
# Plot
ggplot() + 
  geom_sf(data = cph_parish, fill = "grey", color = "grey50", size = 0.05) +
  geom_sf(data = grids100m$data_poly[[1]],
          fill = NA,
          color = "red",
          size = 0.05) + 
  my_theme_map() +
  annotation_scale(location = "br", text_cex = 1) +
  annotation_north_arrow(location = "br",
                         pad_x = unit(1.6, "cm"),
                         pad_y = unit(0.65, "cm"),
                         which_north = "true",
                         height = unit(0.5, "cm"),
                         width = unit(0.5, "cm"),
                         style = north_arrow_orienteering(text_col = "white",
                                                          text_size = 1))

```


There are therefore a total number of `r nrow(cph_parish)` parishes (Figure \@ref(fig:fig-adm-units) and `r nrow(grids100m)` grid cells (Figure \@ref(fig:fig-grids-100m)) in the study area. The statistics for neighbourhood characteristics at parish level since they are the smallest administrative units in Denmark. 
